<!DOCTYPE html>





<html>
	<head>
        <title> AI Chat </title>

        <script type="application/ld+json"></script>

<script
  async
  src="https://browser.sentry-cdn.com/7.19.0/bundle.min.js"
  integrity="sha384-ztBHD5Kyf+YJqkbZijnUhyS5dYdQDCEfB2QjYao1rVJ1qBpQn+WMbafstDcVTHnB"
  crossorigin="anonymous"
  onload="Sentry.init({ dsn: 'https://97bfbb7bc651472085dab062d23194f6@sentry.io/1460722' });"
></script>


		<meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="manifest" href="/static/manifest.json">
        <link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon">
        <script>
            // 1. Initialize UNCONDITIONALLY so the variable always exists
            // This prevents "ReferenceError: user_object is not defined"
            window.user_paid_for_no_ads = false;
            window.user_object = undefined;

            try {
                var storedUser = localStorage.getItem('user');
                // check if storedUser is valid string and not "undefined"
                if (storedUser && storedUser !== "undefined") {
                    window.user_object = JSON.parse(storedUser);

                    if (window.user_object?.userprofile2) {
                        if (window.user_object.userprofile2.locked_out_due_to_no_payment_info === false) {
                            window.user_paid_for_no_ads = true;
                        }
                    }
                }
            } catch(e) {
                console.log('error checking user login for ads removal', e);
                // Safety fallback
                window.user_object = undefined;
            }
        </script>
        
  
  <link rel="canonical" href="https://deepai.org/chat">

    <meta name="description" content="AI Chat is an AI chatbot that writes text. You can use it to write stories, messages, or programming code.">
    <meta property="og:url" content="https://deepai.org/chat">
    <meta property="og:site_name" content="DeepAI">
    <meta property="og:type" content="article">
    <meta property="og:title" content="AI Chat - DeepAI">
    <meta property="og:description" content="AI Chat is an AI chatbot that writes text. You can use it to write stories, messages, or programming code.">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@DeepAI">
    <meta name="twitter:creator" content="@DeepAI">

    <meta name="twitter:title" content="AI Chat - DeepAI">
    <meta name="twitter:description" content="AI Chat is an AI chatbot that writes text. You can use it to write stories, messages, or programming code.">
    <meta name="twitter:image" content="">

    <meta property="article:published_time" content="" />
  <script>
    // true on character/figure pages, else false
    window.characterEnabled = false;
  </script>

<!-- Below is a link to a CSS file that accounts for Cumulative Layout Shift, a new Core Web Vitals subset that Google uses to help rank your site in search -->
<!-- The file is intended to eliminate the layout shifts that are seen when ads load into the page. If you don't want to use this, simply remove this file -->
<!-- To find out more about CLS, visit https://web.dev/vitals/ -->
<style>
  body {
	--fsAddBuffer: 22px;
}
[id='deepai\.org_billboard_ATF'],
[id='deepai\.org_1x1_bouncex'],
[id='deepai\.org_header'],
[id='deepai_incontent_1'],
[id='deepai_left_siderail_1'],
[id='deepai_left_siderail_2'],
[id='deepai\.org_leaderboard_BTF'],
[id='deepai\.org_chat_billboard_ATF'],
[id='deepai\.org_chat_header'],
[id='deepai\.org_chat_leaderboard_BTF'],
[id='deepai_mobile_incontent_2'],
[id='deepai\.org_chat_dynamic'],
[id='deepai_image_incontent'] {
	display: flex;
	align-items: center;
	justify-content: center;
	flex-direction: column;
	min-height: calc(var(--height) + var(--fsAddBuffer));
	height: calc(var(--height) + var(--fsAddBuffer));
	width: 100%;
}
[id='deepai\.org_billboard_ATF'] {
		--height: 280px;
}
[id='deepai\.org_chat_billboard_ATF'] {
		--height: 280px;
}
[id='deepai\.org_chat_dynamic'] {
		--height: 250px;
}
[id='deepai\.org_chat_header'] {
		--height: 50px;
}
[id='deepai\.org_chat_leaderboard_BTF'] {
		--height: 280px;
}
[id='deepai\.org_header'] {
		--height: 100px;
}
[id='deepai\.org_leaderboard_BTF'] {
		--height: 280px;
}
[id='deepai_image_incontent'] {
		--height: 280px;
}
[id='deepai_incontent_1'] {
		--height: 280px;
}
[id='deepai_mobile_incontent_2'] {
		--height: 280px;
}
@media only screen and (min-width: 768px) {
	[id='deepai\.org_billboard_ATF'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_billboard_ATF'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_dynamic'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_header'] {
		--height: 90px;
	}
	[id='deepai\.org_chat_leaderboard_BTF'] {
		--height: 250px;
	}
	[id='deepai\.org_header'] {
		--height: 100px;
	}
	[id='deepai\.org_leaderboard_BTF'] {
		--height: 250px;
	}
	[id='deepai_image_incontent'] {
		--height: 280px;
	}
	[id='deepai_incontent_1'] {
		--height: 90px;
	}
	[id='deepai_mobile_incontent_2'] {
		display: none;
	}
}
@media only screen and (min-width: 970px) {
	[id='deepai\.org_billboard_ATF'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_billboard_ATF'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_dynamic'] {
		--height: 250px;
	}
	[id='deepai\.org_chat_header'] {
		--height: 90px;
	}
	[id='deepai\.org_chat_leaderboard_BTF'] {
		--height: 250px;
	}
	[id='deepai\.org_header'] {
		--height: 100px;
	}
	[id='deepai\.org_leaderboard_BTF'] {
		--height: 250px;
	}
	[id='deepai_image_incontent'] {
		--height: 280px;
	}
}
@media only screen and (min-width: 1360px) {
	[id='deepai_left_siderail_1'] {
		--height: 600px;
	}
}
@media only screen and (min-width: 1650px) {
	[id='deepai_left_siderail_1'] {
		--height: 250px;
	}
	[id='deepai_left_siderail_2'] {
		--height: 250px;
	}
}

</style>


<!-- Initialize freestar object structure early so header ad can register -->
<!-- For US+UK+BR users: This shim ensures no errors, but ads won't load -->
<!-- For other countries: This will be used by the full Freestar integration -->
<script data-cfasync="false" type="text/javascript">
var freestar = freestar || {};
freestar.queue = freestar.queue || [];
freestar.config = freestar.config || {};
freestar.config.enabled_slots = [];
freestar.initCallback = function () {
  (freestar.config.enabled_slots.length === 0) ? freestar.initCallbackCalled = false : freestar.newAdSlots(freestar.config.enabled_slots);
}
</script>


  

        
        <style type="text/css">@font-face{font-family:'Atkinson Hyperlegible';font-style:normal;font-weight:400;font-display:optional;src:url(https://fonts.gstatic.com/s/atkinsonhyperlegible/v11/9Bt23C1KxNDXMspQ1lPyU89-1h6ONRlW45G07JIoWQeCbGWn.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Atkinson Hyperlegible';font-style:normal;font-weight:400;font-display:optional;src:url(https://fonts.gstatic.com/s/atkinsonhyperlegible/v11/9Bt23C1KxNDXMspQ1lPyU89-1h6ONRlW45G04pIoWQeCbA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}html{background-color:#170a2c;font-family:'Atkinson Hyperlegible',sans-serif}button,input,optgroup,select,textarea{font-family:'Atkinson Hyperlegible',sans-serif;font-size:100%;line-height:1.15;margin:0}body{margin:0;padding:0;display:flex;flex-direction:column;min-height:100vh;background:linear-gradient(180deg,#7729aa -13.13%,#170a2d 0.17%,#0a061d 6.9%,rgba(10,6,30,0.99) 36.38%,#010311 98.59%)!important}a{text-decoration:none}header{height:45px;overflow:hidden;width:100%;z-index:101}header a.logo-link,footer a.logo-link{display:flex;color:white!important;cursor:pointer;margin-right:10px}header nav{display:flex;margin-left:auto;max-height:62px}header ul{list-style-type:none;margin:0;padding:0;display:flex;flex-direction:row;white-space:nowrap;align-items:center;min-width:46px;justify-content:center}header ul li{display:block;float:left;font-size:16px;color:#fff;line-height:25px}header ul li a{text-decoration:none;cursor:pointer}.drop-menu-button{display:block;width:46px;height:45px;padding:0;margin:0;border:none;background:transparent;cursor:pointer}.menu-icon{font-size:30px;font-weight:bold;cursor:pointer;vertical-align:middle;pointer-events:none}header ul li a:hover{text-decoration:none}header ul li.dropdown:hover{cursor:pointer}header .dropdown{position:unset}ul li.dropdown ul{visibility:hidden;opacity:0;display:none;position:absolute;transition:all 0.5s ease;top:auto;z-index:10;right:13px;margin:auto;margin-top:20px;width:296px;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px);backdrop-filter:blur(114px)}.show-dropdown{visibility:visible!important;opacity:1!important;display:block!important}ul li.dropdown ul a{clear:both;display:block;margin:0;margin:0px 10px;height:45px;position:relative}ul li.dropdown ul li{margin:4px 5px;cursor:pointer}.search-bar-container{background:rgba(45,40,60,1);border-radius:30px;margin:0 9px 0 9px;height:32px;width:100%;max-width:450px;border:1px solid rgba(74,66,97,1);display:flex;flex-direction:row;align-items:center}.search-bar-container img{height:17px;margin:8px}.search-bar{width:100%}.search-bar input{width:100%;height:100%;border:none;padding:0;color:white;background-color:rgba(0,0,0,0)}.loading{background:url(/static/images/loading.gif) no-repeat right center!important;background-size:contain!important}.loading-center{background:url(/static/images/loading.gif) no-repeat center center;background-size:contain;height:50px}a.button{display:flex;padding:6px 19px;font-size:14px;border-radius:45px;border:1px solid #1e79d1;vertical-align:bottom;white-space:nowrap;font-weight:bold;color:#1e79d1;margin-left:9px}a.button:active{opacity:0.9}a.button.highlighted{background-color:#a01ed1;color:white;width:auto;background:linear-gradient(94deg,#c764ec,#4a36b1);height:auto;border:none;cursor:pointer}a.button.hotline{background:transparent;color:#c764ec;width:auto;height:auto;border:1px solid #c764ec;cursor:pointer}a.login-button{border:none;color:white;cursor:pointer}input:focus,button{outline:none}footer{margin-top:auto;text-align:center}a.button.doublecolor{border-radius:8px;border-right:1px solid #e7416b;border-bottom:1px solid #e7416b;border-left:1px solid #1e79d1;border-top:1px solid #1e79d1;background:transparent;padding:0.3em;color:white;width:auto;height:auto}#social-modal{flex-direction:column;width:80vw;max-width:440px;justify-content:flex-start;align-items:center;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px);backdrop-filter:blur(114px);margin:auto;position:relative;color:white;padding-bottom:54px;position:fixed}.social-link-copy{display:flex;box-sizing:border-box;position:relative;align-items:center;justify-content:space-between;padding-right:18px;padding-left:18px;width:100%;border-radius:32px;border:1px solid rgba(255,255,255,0.13);backdrop-filter:blur(12px);height:48px;margin-top:10px}#social-link-input{flex-grow:1;border:none;background-color:transparent;font-size:14px;padding:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:white}.copy-button{background-color:transparent;border:none;cursor:pointer;padding:4px;margin-left:8px}.copy-button img{width:20px;height:20px}footer p{color:white;font-size:15px}.footer-row{display:flex;position:relative;flex-direction:row;align-items:center;justify-content:space-between;height:50px;background-color:rgba(1,0,9,0);z-index:5;bottom:0px}.bad-auth-error{display:none;justify-content:center;font-size:11px;color:#eb4f4f;text-align:left;margin-bottom:8px;margin-left:8px}.good-auth-error{display:none;justify-content:center;font-size:11px;color:#59ee7f;text-align:left;margin-bottom:8px}.leftfooter{margin-left:16px}.leftfooter a{display:flex;flex-direction:row}.leftfooter p,.logo-link p{background:linear-gradient(180deg,#fff 0%,#ebe5fb 50%,#7fabff 100%);-webkit-background-clip:text;background-clip:text;color:transparent;display:flex;flex-direction:row;font-size:19px;margin:auto;margin-left:10px}@media screen and (max-width:800px){.logo-link p{display:none}}.rightfooter{display:flex;flex-direction:row;margin-right:16px;align-items:center}.contact,.press,.legal,.feedback,.xlogo,.linkedinlogo,.instagramlogo,.tiktoklogo,.redditlogo{margin:auto;margin-left:15px;color:rgba(255,255,255,0.65)}@media screen and (max-width:800px){.feedback{display:none}}@media screen and (max-width:939px){.press{display:none}}@media screen and (max-width:950px){.legal{display:none}}.xlogo{height:19px}.instagramlogo,.redditlogo{height:25px}dialog{padding:0;border:0;border-radius:0.6rem}dialog::backdrop{background-color:rgba(0,0,0,0.4)}dialog + .backdrop{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,0.4)}dialog[open]{animation:slide-up 0.4s ease-out;display:flex}dialog{display:none;left:0;right:0;margin:auto;max-width:90vw;background-color:transparent}dialog#login-modal form{display:block;margin:20px;width:500px}dialog#subscription-modal form{display:block;margin:20px;width:600px}dialog .button.social-auth{width:48%;background:#fff;color:#1D2129;border:1px solid #999;display:inline-block;padding:0 0 0 28px;text-align:left;margin:10px 4px}dialog .button.social-auth img{vertical-align:middle;margin:6px}dialog .button.more-options{background:linear-gradient(94deg,#c764ec,#4a36b1)}dialog .other-options-signup-row{display:flex;flex-direction:row;justify-content:center;align-items:center;margin:20px}dialog .other-options-signup-line{width:30%;height:0;border:1px solid #fff;margin:3px;display:inline-block}dialog .other-options-signup{color:#fff;font-size:15px;padding:0 10px 0 10px}dialog .switch-login-signup-button{padding:0 28px;color:#fff;background:#6ec0fd;font-weight:700;font-size:.7em;border-radius:3px;box-shadow:0 2px 5px 0 rgba(0,0,0,.26);border-width:0;border-style:none;-webkit-appearance:none;height:25px;cursor:pointer;margin:10px auto;width:30%;display:block}.login-container{display:none;flex-direction:column;width:440px;justify-content:flex-start;align-items:center;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);backdrop-filter:blur(114px);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px);-ms-backdrop-filter:blur(114px);margin:auto;color:white;position:fixed}.close{position:absolute;top:0.2em;right:0.2em;padding:0.3em;line-height:0.6;background-color:transparent;border:0;font-size:2em;color:#fff;cursor:pointer}.modal-body{padding:1em;background-color:#2A282F;text-align:center;color:white}.login-header{text-align:center;font-size:36px;font-weight:600;letter-spacing:0.75px;line-height:normal;margin-top:49px;margin-bottom:0px;cursor:default;padding:0px}.share-header{text-align:center;font-size:36px;font-weight:600;letter-spacing:0.75px;line-height:normal;margin-top:54px;margin-bottom:0px}.share-subheader{text-align:center;color:darkgray;font-size:12px;line-height:18px;margin:auto;margin-top:8px;margin-bottom:24px}.out-credits-header{text-align:center;font-size:30px;font-weight:600;letter-spacing:0.75px;line-height:normal;margin-top:25px;margin-bottom:0px}.login-exit{display:flex;flex-direction:row;position:absolute;justify-content:right;right:24px;top:24px;cursor:pointer}.out-credits-exit{display:flex;flex-direction:row;position:absolute;justify-content:right;right:24px;top:24px;cursor:pointer}.oc-msg{display:none;margin:16px 25px 10px;padding:5px 10px;color:rgba(255,255,255,0.95);font-size:14px;line-height:1.6;text-align:left;font-weight:500}.oc-msg a{color:#c764ec;text-decoration:underline}.oc-section{margin:10px 25px;padding:5px}.oc-auto-topup{display:none;margin:10px 25px;padding:7px}.oc-toggle-row{margin-bottom:12px}.oc-toggle{display:flex;align-items:center;cursor:pointer;user-select:none;padding-left:0px}.oc-toggle input[type="checkbox"]{display:none}.oc-toggle-slider{position:relative;display:inline-block;width:50px;height:26px;background-color:rgba(255,255,255,0.2);border-radius:26px;transition:background-color 0.3s;margin-right:12px}.oc-toggle-slider::before{content:'';position:absolute;width:20px;height:20px;left:3px;top:3px;background-color:white;border-radius:50%;transition:transform 0.3s}.oc-toggle input[type="checkbox"]:checked + .oc-toggle-slider{background-color:#8f37ff}.oc-toggle input[type="checkbox"]:checked + .oc-toggle-slider::before{transform:translateX(24px)}.oc-toggle-label{font-size:16px;color:#fff}.oc-desc{font-size:13px;color:rgba(255,255,255,0.7);text-align:left;line-height:1.4}.oc-desc a{color:#c764ec;text-decoration:none}.please-subheader{text-align:center;color:darkgray;font-size:12px;line-height:18px;margin:auto;margin-top:8px;margin-bottom:16px}.options-container{width:270px;height:48px;display:flex;justify-content:center;align-items:center;background:rgba(142,142,142,0.05);border-radius:12px;justify-content:center;margin:auto;margin-top:6px;margin-bottom:6px;cursor:pointer}.membership-toggle{width:100%;height:36px}.login-active{display:flex;width:131px;height:40px;margin-left:4px;font-size:14px;font-weight:200;padding:0 41px 0 41px;justify-content:center;align-items:center;border-radius:10px;color:darkgray;cursor:pointer}.member-active{display:flex;width:131px;height:28px;margin-left:4px;font-size:12px;font-weight:200;padding:0 40px 0 40px;justify-content:center;align-items:center;border-radius:10px;color:darkgray;cursor:pointer}.signup{display:flex;width:131px;height:40px;padding:0 41px 0 41px;justify-content:center;align-items:center;border-radius:10px;font-size:14px;font-weight:200;color:darkgray;white-space:nowrap;text-align:center;cursor:pointer;margin-right:4px}.active{color:white;font-weight:400;background:rgba(255,255,255,0.1)}.signin-with-google{display:flex;position:relative;height:48px;width:270px;justify-content:center;align-items:center;gap:12px;border:none;border-radius:12px;color:white;font-size:14px;font-weight:400;font-family:inherit;background:rgba(255,255,255,0.1);margin:auto;margin-bottom:12px;transition:background 0s ease;cursor:pointer}.signin-with-google:hover{background:white;color:black}.button.login-with-email{display:flex;justify-content:center;background:none;border:none;white-space:nowrap;color:white;font-family:inherit;font-size:12px;font-weight:400;margin:auto;margin-bottom:48px;cursor:pointer}.email-container::before{content:"Email Address";position:absolute;z-index:1;top:10px;left:60px;font-size:9px;pointer-events:none;color:darkgray}.email-container{position:relative;display:none;margin:auto;margin-bottom:12px;width:270px;height:48px;border-radius:12px;background:rgba(142,142,142,0.02)}.email-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);pointer-events:none;color:darkgray;z-index:1;border-right:1px solid darkgray;padding-right:12px}.input-email{padding-left:58px;padding-top:22px;padding-bottom:10px;height:14px;line-height:14px;position:relative;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:transparent;color:white;width:100%}.input-email::placeholder{font-size:12px;line-height:18px}.password-container::before{content:"Enter Password";position:absolute;z-index:1;top:10px;left:60px;font-size:9px;pointer-events:none;color:darkgray}.password-container{position:relative;display:none;margin:auto;margin-bottom:12px;width:270px;height:48px}.lock-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);pointer-events:none;color:darkgray;z-index:1;border-right:1px solid darkgray;padding-right:10px}.input-password{font-size:12px;padding-left:58px;padding-top:22px;padding-bottom:10px;height:14px;line-height:14px;position:relative;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:transparent;color:white;width:100%}.input-password::placeholder{font-size:12px;line-height:18px}.reenter-password-container::before{content:"Re-enter Password";position:absolute;z-index:1;top:10px;left:60px;font-size:9px;color:darkgray;pointer-events:none}.reenter-password-container{position:relative;display:none;margin:auto;margin-bottom:12px;width:270px;height:48px}.button.login-email{display:none;flex-direction:column;background:#7000ff;border:none;width:270px;color:var(--white);font-size:14px;font-weight:500;white-space:nowrap;letter-spacing:2%;margin:auto;padding:12px;margin:auto;margin-bottom:12px;transition:background 0.2s ease;cursor:pointer;align-items:center;border-radius:12px}.button.sub-set{display:flex;flex-direction:column;align-items:center;border-radius:12px;background:#7000ff;border:none;width:270px;color:var(--white);font-size:14px;font-weight:500;white-space:nowrap;letter-spacing:2%;margin:auto;padding:12px;margin:auto;margin-bottom:12px;transition:background 0.2s ease;cursor:pointer}.button.goback{display:none;justify-content:center;background:none;border:none;white-space:nowrap;color:white;font-size:12px;font-weight:400;margin:auto;margin-bottom:24px;cursor:pointer}#forgot-password{display:none;justify-content:center;text-align:center;font-size:12px;margin:auto;margin-bottom:12px;color:white}#forgot-password:hover{background:none;cursor:default}span.click-here{color:#c549fe;cursor:pointer;margin-left:6px}.modal-body .title{font-size:22px;justify-content:center}.modal-body .subtitle{opacity:0.9}.subscription-modal-body{width:max(40vw,386px);background-color:#2A282F}.out-of-credits-modal-body{display:flex;flex-direction:column;width:80vw;max-width:440px;justify-content:flex-start;align-items:center;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);backdrop-filter:blur(114px);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px);-ms-backdrop-filter:blur(114px);margin:auto;position:relative;color:white;padding-bottom:20px;overflow-y:hidden}#out-stripe-go-button-container{height:40px;font-size:14px}.subscription-pro{display:flex;flex-direction:column}.smaller{text-align:left;font-size:12px;padding-right:70px}.stripe-signup-button{padding:8px 30px;font-size:16px;border-radius:45px;background-color:#a01ed1;color:white;width:auto;background:linear-gradient(94deg,#c764ec,#4a36b1);height:auto;border:none;cursor:pointer;vertical-align:bottom;white-space:nowrap;font-weight:bold;margin-bottom:11px}.modal-subscriptions-container{display:flex;position:relative;flex-direction:column;text-align:left;height:fit-content;border:1px solid transparent;border-radius:12px;padding:48px;padding-bottom:10px;color:#fff;overflow-y:hidden}.modal-small-subscription-container{background:rgba(142,142,142,0.02);backdrop-filter:blur(114px);-webkit-backdrop-filter:blur(114px);height:fit-content;width:426px;border:1px solid rgba(255,255,255,0.13);border-radius:12px;margin:auto}.modal-subscription-section{display:flex;flex-direction:row;justify-content:space-between;height:auto;overflow:hidden;margin:auto;width:95%}#mobile-subscription-section-id{margin-top:16px}.modal-overview{visibility:visible}.modal-subscription-title-container{display:flex;flex-direction:column;justify-content:center;align-items:center}.modal-model-title{display:flex;flex-direction:row}.modal-subscription-title{font-size:27px;margin-bottom:5px;line-height:29px}.modal-subscriptions-subheader{font-size:14px;color:#9c9b9b;font-weight:300}.pro-title{margin-left:3px;font-weight:600}.modal-subscription-price{display:flex;justify-content:center}.modal-price{font-size:30px;color:#8f37ff;font-weight:500;margin-bottom:6px}.modal-subscription-length{font-size:24px;color:#8f37ff;margin-top:6px}.modal-get-started,.mobile-get-started{display:flex;flex-direction:row;width:100%!important;height:48px;padding:5px 95px;justify-content:center;align-items:center;gap:10px;border-radius:12px;font-size:18px;text-align:center;background-color:#8f37ff;color:white;border:none;white-space:nowrap;cursor:pointer}.modal-overview{list-style-type:none;font-size:14px;line-height:38px;padding-left:0px}.get-started-container{display:none;flex-direction:column}.payment-container{display:flex;flex-direction:column}.active{color:white;font-weight:400;background:rgba(255,255,255,0.1)}.modal-see-full{display:flex;flex-direction:row;justify-content:center;align-items:center;background:none;border:none;color:white;font-size:14px;cursor:pointer;margin:auto;margin-bottom:30px;gap:4px}.promo-modal-container{width:780px;max-width:95vw}.promo-modal-container .modal-subscriptions-container{padding:32px;padding-bottom:24px}.promo-modal-container .close{position:absolute;top:12px;right:12px;background:none;border:none;color:rgba(255,255,255,0.6);font-size:28px;cursor:pointer;padding:4px 10px;line-height:1;z-index:10}.promo-modal-container .close:hover{color:#fff}.promo-modal-container .modal-subscription-title{font-size:24px;margin-bottom:24px}.promo-tiers-container{display:flex;gap:12px;justify-content:center;align-items:center;margin-bottom:24px}.promo-tier-card{position:relative;border-radius:12px;overflow:hidden;border:2px solid rgba(255,255,255,0.15)}.promo-tier-image{width:100%;height:100%;object-fit:cover;display:block}.promo-tier-overlay{position:absolute;bottom:0;left:0;right:0;padding:16px 12px;background:linear-gradient(to top,rgba(0,0,0,0.9) 0%,rgba(0,0,0,0.4) 60%,rgba(0,0,0,0) 100%);display:flex;flex-direction:column;align-items:center;gap:2px}.promo-tier-badge{font-size:15px;font-weight:600;color:#fff}.promo-tier-res{font-size:12px;color:rgba(255,255,255,0.7)}.share-button{color:#fff!important;opacity:0.65;cursor:pointer;display:flex;align-items:center;flex-direction:row}.share-button img{margin-right:4px}#social-image{margin:0 auto}.separator-bullet{margin:0 4px;color:#999}.card-list{display:flex;flex-direction:column;justify-content:center;padding:18px 10px 0}.card-list .main-list{display:flex;flex-direction:column;margin:0 auto;width:100%}.card-list-item{border-radius:8px;margin:30px auto 30px auto;width:100%;max-width:700px;cursor:pointer;display:flex;flex-direction:row;outline:none;box-shadow:0 8px 92px 20px rgb(71 28 115 / 70%)}.card-list-item .heart-link{display:flex;flex:0 1;flex-direction:column;padding:12px 0;align-items:center}.card-list-item .card-content{display:flex;flex-direction:column;background:transparent;width:100%;border-radius:0 8px 8px 0;color:black;padding:20px}.card-list-item:hover{outline:1px solid #898989}.card-list-item .tag-container{display:flex;flex-direction:row}.card-list-item .card-list-item-header{display:flex;flex-direction:row;align-items:center;margin:12px;font-size:14px;color:#999}.card-list-item .trunc-summary{margin:0 12px 12px;font-size:14px;color:#fff}.card-list-item .card-footer{display:flex;flex-direction:row;align-items:center;margin:12px;font-size:14px}.card-list-item .card-footer .author-link{color:#c764ec}.card-list-item .title{margin:0 12px 12px;font-size:15px;font-weight:500;line-height:24px;color:#fff}.dropdown-select{background-color:rgba(111,0,255,0.049);color:darkgray;padding:12px;font-size:16px;border:none;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none}.dropdown-select option{color:white;margin-top:14px}.dropdown-select option:first-child{color:darkgray}.dropdown-select option:hover{background-color:#f1f1f1}.dropdown-payment-amount::before{content:"Add credits to your account";position:absolute;z-index:1;top:10px;left:60px;font-size:8px;color:darkgray;pointer-events:none}.dropdown-payment-amount::after{color:white}.dropdown-payment-amount{position:relative;display:none;margin-bottom:12px;width:100%;height:48px}.go-dropdown{display:flex}.money-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);pointer-events:none;color:darkgray;z-index:1;border-right:1px solid darkgray;padding-right:12px}.dropdown-input-amount{font-size:12px;padding-left:58px;padding-top:22px;padding-bottom:10px;height:48px;line-height:14px;position:relative;width:100%;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(255,255,255,0.02);backdrop-filter:blur(12px)}.dropdown-icon{position:absolute;right:16px;top:50%;transform:translateY(-50%);pointer-events:none;background-color:#ffffff00;color:white;border:none;z-index:2}.dropdown-icon:hover{cursor:pointer}.nudge-popup{position:fixed;top:20px;right:-350px;width:350px;max-height:300px;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);backdrop-filter:blur(114px);transition:right 0.3s ease;z-index:1000;overflow-y:auto;visibility:hidden}.nudge-popup.active{right:20px;visibility:visible}.nudge-popup-header{display:flex;justify-content:space-between;align-items:center;background:rgba(142,142,142,0.02);color:white;border-bottom:1px solid rgba(255,255,255,0.2);padding:2px 17px}.pro-popup-header{border:none;justify-content:flex-end}.nudge-popup-header-text{display:flex;align-items:center;gap:10px}.nudge-popup-body{padding:20px}.nudge-signin-button{margin-top:12px;font-size:16px}.nudge-pro-popup{position:fixed!important;bottom:20px;right:-350px;width:350px;max-height:400px;border-radius:12px;border:1px solid rgba(255,255,255,0.13);background:rgba(142,142,142,0.02);backdrop-filter:blur(114px);transition:right 0.3s ease;z-index:2147483647!important;isolation:isolate;overflow-y:auto;visibility:hidden}.nudge-pro-popup.active{right:20px;visibility:visible}.nudge-pro-body-title{display:flex;flex-direction:column;justify-content:center;text-align:center}.nudge-pro-icon{margin-top:-20px;height:50px}.close-icon{cursor:pointer;font-size:40px;opacity:.75}.sub-terms-pro-styling{padding-left:0px;padding-top:8px;margin:auto;flex-direction:column}.sub-terms-go-styling{padding-left:0px;padding-top:8px;margin:auto;flex-direction:column}.dataset{position:relative;width:100%}#amount{-webkit-appearance:none;-moz-appearance:none}.card-list-item .title a{color:#fff}.thumbnail{width:500px;max-width:100%;margin:12px auto;height:350px;max-height:100%;box-sizing:border-box;border-radius:8px;background-size:contain;background-repeat:no-repeat;background-position:center}.middle{vertical-align:middle}.hide{display:none}.heart-link{display:flex;align-items:center;justify-content:center;color:#999!important;text-decoration:none!important;cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.heart-count{margin:4px}.heart-link:not([hearted]) .hearted-heart-icon{display:none}.heart-link[hearted] .unhearted-heart-icon{display:none}.multi-select-checkbox{display:none}a:hover,a:focus{text-decoration:none}.social-icon{display:flex;gap:26px}.social-name{font-size:14px}.icon-container{display:flex;flex-direction:column;align-items:center;gap:8px}.icon-container a{display:flex;width:58px;height:58px;border-radius:12px;background-color:#ffffff04;justify-content:center;align-items:center;transition:background-color 0.3s;margin-bottom:-8px}.icon-container a:hover{background-color:#ffffff12}.facebook a:hover{background-color:#1876f2}.reddit a:hover{background-color:#ff4400}.x a:hover{background-color:rgb(13,13,13)}.linkedin a:hover{background-color:#0a66c2}.icon-container img{width:55%;height:auto;transition:transform 0.3s}.icon-container a:hover img{transform:scale(1.1)}@media screen and (max-width:960px){header img.header-social-icon{margin-left:12px}}@media screen and (max-width:800px){.smaller{padding-right:30px}}@media screen and (max-width:600px){ul li.dropdown ul{right:2%}.contact,.press,.feedback,.legal{margin-left:10px;font-size:12px}.linkedinlogo,.instagramlogo,.tiktoklogo,.redditlogo{margin-left:10px;height:22px}.xlogo{height:18px}.smaller{padding-right:10px}dialog#login-modal form{width:100%;margin:auto}dialog#subscription-modal form{width:400px;margin:10px}.thumbnail{max-width:90%;margin:12px}dialog .button{width:80%}dialog input[type=email]{width:90%}dialog input[type=text]{width:90%}dialog input[type=password]{width:90%}dialog .button.social-auth{width:80%;display:block;margin:auto;margin-bottom:10px;text-align:left}.card-list .card-list-item{margin:4px 0}.card-list .card-list-item .card-content{width:87%}header img.deepai-logo{height:28px;margin-left:8px;width:32px;object-fit:cover;object-position:left}.sub-terms-pro-styling{margin:auto}.sub-terms-go-styling{margin:auto}}@media (max-width:500px){.social-modal-body{width:268px}.social-icon{gap:12px}#social-modal{width:98%}.social-name{font-size:12px}.promo-modal-container .modal-subscriptions-container{padding:24px 16px}.promo-modal-container .modal-subscription-title{font-size:20px;margin-bottom:16px}.promo-tier-overlay{padding:10px 8px}.promo-tier-badge{font-size:12px}.promo-tier-res{font-size:10px}}@media screen and (max-width:470px){.modal-small-subscription-container{width:96vw;height:auto}.modal-subscriptions-container{padding:34px 34px 14px 34px}.out-of-credits-modal-body{width:auto}.oc-msg{margin:16px 18px 10px}.oc-section,.oc-auto-topup{margin:10px 18px}#close-sub{margin-right:10px}dialog{max-width:100vw;width:100vw}ul li.dropdown ul{width:96%}.login-container{width:96%}.leftfooter p{display:none}}@media screen and (max-width:420px){.modal-column{width:280px}.other-modal-column{width:280px;padding-bottom:5%;margin-bottom:10px}.other-modal-column .other-box-title{padding:0.8em}.modal-column .box-title{padding:0.8em}.other-modal-column :nth-child(2){padding:0.6em}.modal-column :nth-child(2){padding:0.6em}.member-active{padding:0 35px 0 35px}}@media screen and (max-width:390px){.member-active{padding:0 30px 0 30px}.oc-msg{margin:16px 12px 10px}.oc-section,.oc-auto-topup{margin:10px 12px}}@media screen and (max-width:375px){dialog#login-modal form{width:90%;margin:auto}dialog input[type=email]{width:90%}dialog input[type=text]{width:90%}dialog input[type=password]{width:90%}dialog .button{width:90%}dialog .button.social-auth{width:90%}.member-active{padding:0 20px 0 20px}}@media screen and (max-width:425px){.subscription-modal-body{width:auto}.subscription-pro{width:100%;margin:auto}}@media screen and (max-width:320px){ul li.dropdown ul{right:10px}dialog#login-modal form{width:95%;margin:auto}dialog#subscription-modal form{width:400px;margin:10px}dialog .button{width:100%}dialog .button.social-auth{width:100%}.thumbnail{max-width:90%;margin:12px}.card-list .card-list-item .card-content{width:87%}.card-list .card-list-item{margin:4px 0}dialog .button.social-auth{width:100%;display:block}.options-container{width:260px}.signin-with-google{width:240px}.email-container{width:240px}.password-container{width:240px}.reenter-password-container{width:240px}.button.login-email{width:240px}}@media screen and (max-width:290px){.options-container{width:235px}.member-active{padding:0 12px 0 12px}dialog{margin-left:0px}}.announcement-banner{background:rgba(143,55,255,0.25);backdrop-filter:blur(10px);border:1px solid rgba(143,55,255,0.3);color:white;position:relative;box-sizing:border-box;display:none;justify-content:center;align-items:center;text-align:center;border-radius:50px;padding:10px 35px 10px 16px;margin:0 auto;max-width:fit-content}.banner-text{margin:0;padding:0;text-align:center;display:flex;align-items:center;justify-content:center}.permanent-announcement-banner{display:none;background:rgba(143,55,255,0.25);backdrop-filter:blur(10px);border:1px solid rgba(143,55,255,0.3);color:white;position:relative;box-sizing:border-box;display:inline-flex;justify-content:center;align-items:center;text-align:center;border-radius:50px;padding:8px 29.5px;margin:0 auto}.menu-perm-ad{border-radius:6px;background:rgba(143,55,255,0.25);backdrop-filter:blur(10px);border:1px solid rgba(143,55,255,0.3);color:white;padding:8px 31.5px;margin-top:6px}.sidebar-perm-ad{border-radius:10px}.image-generator-banner{padding:8px 45px}.banner-text{margin:0;padding:0;text-align:center;display:flex;flex-direction:column}.perm-banner-text{margin:0;padding:0;text-align:center;display:flex;flex-direction:column}.main-text{font-size:14px;line-height:1;color:white;font-weight:400}.image-perm-text{font-size:18px}.sub-text{font-size:14px;line-height:1.2;color:white;font-weight:400}.image-sub-perm-text{font-size:15px}.sub-perm-text{font-size:12px}.pro-link-button{display:block;text-decoration:none;color:inherit;width:100%}.announcement-banner{display:none}.dismiss-button{background:transparent;border:none;color:rgba(255,255,255,0.8);cursor:pointer;font-size:16px;line-height:16px;padding:0;margin:0;position:absolute;right:8px;top:50%;transform:translateY(calc(-50% - 1.25px));width:24px;height:24px;display:flex;align-items:center;justify-content:center;text-align:center}#successpopup,#errorpopup{visibility:hidden;min-width:250px;background-color:rgba(45,40,60,1);border-radius:45px;padding:16px;position:fixed;z-index:10001;left:50%;bottom:30px;transform:translateX(-50%);text-align:center;border:1px solid rgba(74,66,97,1);display:flex;align-items:center;justify-content:center}#successpopup{color:#fff;border-color:rgba(74,66,97,1);background-color:rgba(45,40,60,1)}#successpopup.show{visibility:visible;animation:fadein 0.5s ease-in,fadeout 0.5s ease-out 2.5s forwards}#errorpopup{color:#ee7a7a;border-color:rgba(95,49,64,1);background-color:rgba(33,17,39,1)}.errorIcon{width:16px;height:16px;margin-right:0.75rem;flex-shrink:0;opacity:0.9}#errorpopup.show{visibility:visible;animation:fadein 0.5s ease-in,fadeout 0.5s ease-out 2.5s forwards}@keyframes fadein{from{opacity:0}to{opacity:1}}@keyframes fadeout{from{opacity:1}to{opacity:0}}.privacy-modal-dialog{border:none;border-radius:12px;padding:0;max-width:650px;width:90%;height:90vh;max-height:90vh;box-shadow:0 8px 32px rgba(0,0,0,0.3);overflow:hidden}.privacy-modal-dialog[open]{display:flex;flex-direction:column;position:fixed;inset:0;margin:auto}.privacy-modal-dialog::backdrop{background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);position:fixed;inset:0}body:has(.privacy-modal-dialog[open]){overflow:hidden}.privacy-modal-close-btn{position:absolute;top:12px;right:12px;background:white;border:none;border-radius:50%;width:36px;height:36px;font-size:28px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#666;box-shadow:0 2px 8px rgba(0,0,0,0.2);transition:all 0.2s;z-index:1000}.privacy-modal-close-btn:hover{background:#f5f5f5;color:#333;transform:scale(1.1)}#privacy-modal-iframe{width:100%;flex:1;border:none;display:block;margin:0;padding:0;border-radius:12px;min-height:0}@media (max-width:600px){.privacy-modal-dialog{max-width:100%;width:100%;max-height:100vh;border-radius:0}#privacy-modal-iframe{height:100vh}}div.sticky{position:-webkit-sticky;position:sticky;top:0;z-index:10}div.left-sticky{position:fixed;top:20vh;left:0px;right:calc(100% - 320px);z-index:20;overflow:hidden}.fs-sidewall-container{z-index:9!important}@media (max-width:1650px){div.left-sticky{right:calc(100% - 180px)}}@media (min-width:1650px){div.left-sticky{right:calc(100% - 320px)}}h2,h3{font-weight:normal;font-size:20px}.chat-mode-dropdown-container{position:relative;display:inline-block}.chat-mode-dropdown-trigger{display:flex;align-items:center;justify-content:space-between;font-size:16px;color:white;background:rgba(45,40,60,1);border:none;border-radius:12px;padding:8px 14px;cursor:pointer}.chat-mode-dropdown-menu{position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:280px;height:75vh;max-height:75vh;background-color:rgba(21,16,38,1);border:1px solid rgba(51,47,66,1);border-radius:12px;z-index:10000;box-sizing:border-box;display:none;flex-direction:column;overflow:hidden}.chat-mode-dropdown-menu::-webkit-scrollbar{width:6px}.chat-mode-dropdown-menu::-webkit-scrollbar-track{background:transparent}.chat-mode-dropdown-menu::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2);border-radius:3px}.chat-mode-dropdown-menu::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.3)}.chat-mode-menu-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:2px;padding:8px 10px;border-radius:10px;background-color:transparent;color:#fff;font-size:14px;line-height:1.4;cursor:pointer;transition:background-color 0.15s}.chat-mode-menu-item:hover{background-color:rgba(45,40,60,0.8)}.chat-mode-menu-item.selected{background-color:rgba(60,55,75,1)}.chat-mode-menu-item.selected:hover{background-color:rgba(60,55,75,1)}.chat-mode-menu-item.chat-mode-locked{opacity:0.6}.chat-mode-menu-item.chat-mode-locked:hover{opacity:0.8;cursor:pointer}.chat-mode-menu-item .text-container{display:flex;flex-direction:column}.chat-mode-description{font-size:13px;color:#9F9F9F;margin-top:4px}.chat-mode-checkmark{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;margin-left:10px}.chat-history-search-wrapper{position:relative;display:flex;align-items:center}.chat-history-search-input{width:100%;padding:10px 36px 10px 12px;background:rgba(25,23,42,1);border:1px solid rgba(49,47,64,1);border-radius:5px;color:#fff;font-size:14px;outline:none;transition:border-color 0.2s ease}.chat-history-search-input::placeholder{color:rgba(159,159,159,0.8)}.chat-history-search-input:focus{outline:none}.chat-history-search-input:active{outline:none}.chat-history-search-icon{position:absolute;right:8px;width:28px;height:28px;color:rgba(159,159,159,1);display:flex;align-items:center;justify-content:center;pointer-events:none}.chat-history-search-clear{position:absolute;right:8px;width:28px;height:28px;background:none;border:none;color:rgba(159,159,159,1);cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0;transition:color 0.2s ease}.chat-history-search-clear:hover{color:rgba(255,255,255,1)}.chat-history-search-container{}:root{--compose-h:0px;--ad-clearance:0px}body{color:white}h1{text-align:center;font-size:45px;font-weight:normal;margin-bottom:0px;margin-top:70px}.figure-name{font-size:0.8em;font-weight:500;text-align:center}h2{font-size:22px;font-weight:500;text-align:center}h3{margin:19px;text-align:center;width:calc(min(100vw - 18px,841px));margin-right:auto;margin-left:auto;margin-bottom:24px;margin-top:10px}.figure{width:200px;height:200px;margin:10px;margin-top:70px;cursor:pointer;transition:transform .2s;object-fit:cover;border-radius:12px}.captioned-figure{display:inline-block}.fig-name{margin:-5px}.idea-container{display:flex;margin:auto;flex-direction:column;text-align:left;width:calc(min(100vw - 24px,867px));text-decoration:none;list-style:none}.aichat-faq{text-align:left;width:calc(min(100vw - 18px,867px));margin:auto}.idea-container p{margin-bottom:32px}.learn-more-conatiner{text-align:left;width:calc(min(100vw - 24px,867px));margin:auto;margin-bottom:42px;font-size:32px}.weaknesses-container{margin-bottom:140px}.chatbox-wrapper{width:calc(min(100vw - 45px,867px));display:flex;flex-direction:column;position:relative;margin-right:auto;margin-left:auto}.chatbox{width:calc(min(100vw - 67px,818px));display:flex;flex-direction:column;margin:0px;resize:none;background:transparent;border:none;color:white;padding:22px;font-size:18px;height:187px;overflow:auto;justify-content:space-between;margin-top:0px;padding-bottom:47px;min-height:20px}.chatbox::placeholder{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.chatbox:focus{outline:none}.outputBox{width:calc(min(100vw - 18px,818px));display:block;margin:10px;background:rgba(21,16,38,1);border-radius:12px;color:white;padding:22px;padding-top:0px;font-size:18px;border:1px solid rgba(255,255,255,0.13);margin-right:auto;margin-left:auto;overflow-x:hidden;margin-top:0px;position:relative}.editsBox{display:none;flex-direction:row;justify-content:center;width:calc(min(100vw - 18px,841px));margin:auto;margin-bottom:12px;margin-top:2px}[data-edited] .editsBox{display:flex}.chatoptionsBox{display:flex;flex-direction:row;justify-content:flex-end;position:relative;margin-bottom:-20px;bottom:30px;margin-right:16px;align-self:center;background:none;border-radius:10px}.uploadoptionsBox{display:flex;flex-direction:row;justify-content:flex-end;position:relative;margin-bottom:0px;bottom:47px;width:96.6%;align-self:center;background:none;border-radius:10px}.hiddenTextContainer{display:none}.optionsBox{display:flex;flex-direction:row;justify-content:flex-end;align-items:center;margin-top:12px;position:relative;padding:0;right:-10px;bottom:-10px}.optionsBox button{margin:0 3px}.uploadButton{display:flex;margin:0;cursor:pointer;border:none;border-radius:50%;width:41px;height:41px;color:white;background-color:rgba(45,40,60,1);z-index:4;justify-content:center;align-items:center}.expanded .uploadButton{margin-right:auto}.upload-preview-container{position:relative;flex-shrink:0;width:48px;height:48px;background:rgba(25,23,42,1);border-radius:8px;border:1px solid rgba(49,47,64,1);overflow:visible}.upload-preview-container .preview-image{width:100%;height:100%;object-fit:cover;display:block}.upload-preview-container .close-button:hover{background:rgba(255,255,255,0.15)}.text-file-indicator{width:100%;height:100%;background:transparent;font-size:9px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;justify-content:center;padding:4px;color:rgba(255,255,255,0.6)}.upload-preview-wrapper{pointer-events:none}.upload-preview-wrapper .upload-preview-container{pointer-events:auto}.copytextButton{display:flex;margin-left:6px;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(38,34,56,1);z-index:4}.summarizetextButton{display:flex;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(38,34,56,1);z-index:4}.summary .summarizetextButton{display:none}.deleteBoxButton{display:flex;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(38,34,56,1);z-index:4;margin-left:6px}.addBoxButton{display:flex;cursor:pointer;border:1px solid white;border-radius:6px;color:#101010;background:white}.deleteBoxButton,.summarizetextButton,.searchButton,.copytextButton,.expandButton,.webSummaryButton,.copyCodeButton,.livecodesButton,.uploadButton{font-size:16px}#errorpopup,#summarypopup,#copypopup,#upload-successful,#upload-unsuccessful,#upload-too-many,#big-file-type,#bad-file-type{visibility:hidden;min-width:250px;background-color:rgba(45,40,60,1);border-radius:45px;padding:16px;position:fixed;z-index:10;left:50%;bottom:30px;transform:translateX(-50%);text-align:center;border:1px solid rgba(74,66,97,1);display:flex;align-items:center;justify-content:center;color:#fff}#summarypopup,#copypopup{border-color:rgba(74,66,97,1);background-color:rgba(45,40,60,1)}#upload-successful{color:white;border-color:#8F37FF;background-color:rgba(143,55,255,0.2);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px);backdrop-filter:blur(114px)}#errorpopup,#upload-unsuccessful,#upload-too-many,#big-file-type,#bad-file-type{color:#ee7a7a;border-color:rgba(95,49,64,1);background-color:rgba(33,17,39,1)}.errorIcon{width:16px;height:16px;margin-right:0.75rem;flex-shrink:0;opacity:0.9}#errorpopup.show,#summarypopup.show,#upload-successful.show,#upload-unsuccessful.show,#copypopup.show,#upload-too-many.show,#big-file-type.show,#bad-file-type.show{visibility:visible;-webkit-animation:fadein 0.5s,fadeout 0.5s 2.5s;animation:fadein 0.5s,fadeout 0.5s 2.5s}@keyframes fadein{from{opacity:0}to{opacity:1}}@keyframes fadeout{from{opacity:1}to{opacity:0}}@-webkit-keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}@keyframes fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}@-webkit-keyframes fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}@keyframes fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}#progressContainer{width:calc(min(100vw - 18px,867px));height:10px;margin:auto;margin-top:12px;border-radius:12px;margin-bottom:12px}#deepaiProgressBar{height:10px;background:#8F37FF;border-radius:10px;width:0%}#chatSubmitButton{width:41px;height:41px;padding:0;border-radius:45px;border:none;background:#8F37FF;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;flex-grow:0}#chatStopButton{width:41px;height:41px;padding:0;border-radius:45px;border:none;background:rgba(45,40,60,1);color:white;cursor:pointer;display:none;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;flex-grow:0}.button-container{display:flex;align-items:center;justify-content:flex-end;gap:7px;width:100%}#recordButton,#attachFileButton{width:41px;height:41px;padding:0;border-radius:45px;border:none;background:rgba(45,40,60,1);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:width 0.3s ease,background-color 0.3s ease,color 0.3s ease;overflow:hidden}#attachFileButton:hover{background:rgba(60,55,75,1)}#recordButton.text{width:150px;border-radius:45px}#recordButton.recording{color:#ee7a7a;background-color:rgba(33,17,39,1)}.mic-icon{width:22px;height:22px}.fade-in{opacity:0;transition:opacity 0.2s ease-in}.fade-in.show{opacity:1}.chatEditSubmitButton{white-space:nowrap;color:white;background:#8F37FF;display:flex;margin-left:6px;border:none;cursor:pointer;border-radius:45px;padding:12px 24px;z-index:4}.chatEditCancelButton{display:flex;white-space:nowrap;color:white;margin-left:6px;cursor:pointer;border:none;border-radius:45px;padding:12px 24px;color:white;background-color:rgba(45,40,60,1);z-index:4}.cta{display:flex;align-items:center;position:absolute;margin:auto;padding:14px 24px;transition:all 0.2s ease;border:none;background:none;z-index:5}.cta-extra{margin-left:48px}.cta:before{content:"";position:absolute;top:2px;left:1px;display:block;border:1px solid rgb(255,255,255);border-radius:24px;width:48px;height:48px;transition:all 0.3s ease}.button-path{display:none}.cta:hover .button-path{display:flex}.cta:hover{cursor:pointer}.cta:hover span{color:#000000}.cta span{position:relative;font-size:18px;font-weight:500;letter-spacing:0;color:#ffffff}.cta svg{position:relative;top:-1px;margin-left:24px;fill:none;stroke-linecap:round;stroke-linejoin:round;stroke:#ffffff;stroke-width:2;transform:translateX(-32px);transition:all 0.3s ease-in-out}.cta:hover:before{width:100%;background:rgb(255,255,255)}.cta:hover svg{transform:translateX(-16px);stroke:#000000}.cta:active{transform:scale(0.95)}.idea-section{display:flex;flex-direction:column;width:calc(min(100vw - 18px,867px));margin:auto;margin-top:12px;margin-bottom:200px}.idea-row{position:relative;margin-top:84px}#idea-info-list,#str-info-list,#weak-info-list{text-align:left;display:flex;position:relative}#history-rename{display:flex;flex-direction:row;justify-content:center;align-items:center;margin:auto}#history-delete-chat,#character-edits-chat{display:flex;flex-direction:row;justify-content:center;align-items:center;width:55.35%;gap:7px}#chatSessionDeleteButton,#chatHistoryDeleteButton,#see-more-btn{right:8px;height:45px;width:50%;border:none;border-radius:32px;background-color:rgba(45,40,60,1);color:white;align-items:center;justify-content:center;padding:0 21px;cursor:pointer}#characterReportButton{color:#ee7a7a;font-size:14px;padding:8px 16px;border:none;border-radius:45px;background-color:rgba(33,17,39,1);margin:auto}#chatSessionRenameButton{margin:5px;color:#ffffff;padding:10px 17px;border-radius:32px;cursor:pointer;border:1px solid #c764ec;font-size:12px;text-align:center;background:#c764ec}#chat-editing-button{display:block;margin:auto;color:#fff;padding:16px 17px;cursor:pointer;font-size:12px;text-align:center;background:transparent;text-decoration:none;border:none;opacity:0}.response-length-options{margin-left:auto;display:flex;justify-content:center;width:calc(min(100vw - 24px,850px));margin-right:auto;align-items:center}.response-length-options input[type=radio]{margin:0px;width:0px}.response-length-options input[type=radio]:checked + label{background-color:#1f77d1;color:rgba(45,40,60,1)}.other-chat-styles{display:flex;flex-direction:row;justify-content:space-between;flex-wrap:wrap;margin:10px;width:calc(100% - 20px);max-width:890px;margin-left:auto;margin-right:auto}.learning-style{justify-content:center}.other-chat-styles a{display:flex;width:calc(33% - 12px);padding:18px 14px;align-items:center;gap:10px;border-radius:12px;border:none;background:none;justify-content:center;backdrop-filter:blur(2.10px);margin:6px;color:white;box-sizing:border-box}.other-chat-styles a:hover{background:var(--clear)}.characters-chat-link{display:block;width:50%;color:white;cursor:pointer;font-size:15px;text-align:center;margin-left:auto;margin-right:auto;margin-bottom:18px;border-radius:45px;border:none;background:rgba(45,40,60,1);padding:13.5px 0px}.chat-dropdown-box{display:block;font-size:16px;margin:auto;color:white;background:rgba(45,40,60,1);border:none;border-radius:12px;padding:0px;width:calc(min(100vw - 18px,867px));max-width:865px;min-width:200px;opacity:0;appearance:none;-moz-appearance:none;-ms-appearance:none;padding-right:30px}.chat-dropdown-box:focus{outline:none}.genius-chat-mode-title{font-size:42px;font-weight:500}.featured-chat-modals{display:flex;flex-direction:row;text-align:center;font-size:36px;font-weight:500;width:100%;height:auto;gap:24px}.genius-images{font-size:48px;font-weight:500}.genius-chat-sparkle{position:absolute;width:5%;height:auto;padding-left:6px;top:44px}.genius-mode-chat-popup-description{font-weight:400;font-size:24px;margin-bottom:48px;margin-top:-12px}.featured-chat-images,.tier-images{width:100%;height:auto}.mobile-featured-chat-images{display:none}.mobile-featured-chat-images,.tier-images{width:100%;height:auto;margin-bottom:24px}.chat-prompting{border:2px solid rgba(255,255,255,0.13);background:rgba(255,255,255,0.02);border-radius:12px;padding:12px;bottom:36%;left:34%;position:absolute;font-size:14px;width:242px;text-align:center;box-shadow:8px 14px 17px rgba(0,0,0,0.4);backdrop-filter:blur(114px);-webkit-backdrop-filter:blur(114px);-moz-backdrop-filter:blur(114px)}.try-now{height:42px;white-space:nowrap;background-color:#8f37ff;color:white;border:none;width:100%!important;font-size:14px;font-weight:400;font-family:var(--font-family-helvetica);padding:0px;margin-bottom:12px;border-radius:12px;margin-bottom:24px;cursor:pointer}.terms{font-size:14px;text-align:center;color:#BDBDBD}.exit-feature{display:flex;flex-direction:row;position:absolute;justify-content:right;right:10px;top:10px;cursor:pointer;margin:10px}@media screen and (max-width:915px){.chatoptionsBox{width:calc(min(100vw - 25px,830px));margin-right:0px}.uploadoptionsBox{width:92.6%}}.select-wrapper{position:relative;width:calc(min(100vw - 22.5px,865px));margin:0 auto}.dropdown-arrow-container{position:absolute;top:50%;right:18px;transform:translateY(-50%);pointer-events:none}.dropdown-arrow-container svg{display:block;width:100%;height:auto}@media screen and (max-width:702px){.genius-chat-mode-title{width:100%;height:auto}.exit-feature{width:14px;top:12px;right:14px;margin-bottom:8px}.genius-mode-header{font-size:12px}.genius-chat-sparkle{display:none}.featured-chat-images{display:none}.mobile-featured-chat-images{display:flex;flex-direction:column;justify-content:center}.try-now{margin-top:-90px;margin-bottom:8px;height:42px}.genius-mode-chat-popup-description{font-weight:400;font-size:12px;margin-bottom:12px;margin-top:-12px}.chat-prompting{display:none}.genius-chat-mode-title{font-size:24px;margin-top:18px}.standard-image{display:none}.terms{font-size:10px}.sidebar-ad{display:none}}.amazon-advertisement-container{display:flex;justify-content:center;max-width:100%;flex-direction:column}.inner-amazon-advertisement-container{height:33%;border:5px solid #1a1a1a;border-radius:12px;text-align:center;text-decoration:none;color:black;padding:10px;display:flex;flex-direction:column;align-items:bottom;justify-content:center;background:white}.inner-amazon-advertisement-container img{height:auto;object-fit:contain;max-height:100px;max-width:100px}.amazon-ad-image-box{width:33%}.inner-amazon-advertisement-container-info{height:100%;justify-content:center;display:inherit}.amazon-ad-text-container{width:67%;display:flex;justify-content:center;align-self:center;flex-direction:column;overflow:hidden;margin-left:20px}.amazon-ad-text-container p{margin-bottom:0px}.amazon-ad-stat-box{display:flex;flex-direction:row;justify-content:space-around}.amazon-star-rating{height:20px;margin:10px;margin-bottom:0}.amazon-advert-price{margin:10px;margin-bottom:0;color:#B63419;height:20px}.amazon-ad-prime{display:flex;align-self:end;margin:10px;margin-bottom:0;height:20px}.amazon-ad-scroll-container{width:100%;height:auto;overflow:auto}.amazon-ad-overall-container{display:flex;flex-direction:row}.webSummaryButton{float:right;display:flex;margin-left:6px;margin-top:6px;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(74,66,97,1);z-index:4}.results-wrapper{padding:0;order:1;overflow:visible}.outputBox[data-has-results="true"]{display:flex;flex-direction:column;padding-bottom:12px}.outputBox[data-has-results="true"] .results-wrapper{order:1}.outputBox[data-has-results="true"] .markdownContainer{order:2}.results-tabs{display:flex;margin-top:16px;margin-bottom:16px;padding:0;border-bottom:1px solid rgba(255,255,255,0.1)}.results-tab{display:flex;align-items:center;gap:8px;padding:10px 16px;background:transparent;border:none;border-bottom:2px solid transparent;color:#9F9F9F;font-size:16px;font-weight:500;cursor:pointer;transition:all 0.2s ease;margin-bottom:-1px}.results-tab:hover{color:#fff;background:rgba(255,255,255,0.05);border-radius:10px 10px 0 0}.results-tab.active{color:#fff;border-bottom-color:#8F37FF}.tab-icon{width:16px;height:16px;opacity:0.7}.results-tab.active .tab-icon{opacity:1}.sources-badge{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;background:#CBA8FF;color:#552896;border-radius:10px;font-size:14px;font-weight:600;min-font-size:12px}.tab-content{display:none}.tab-content.active{display:block;background:transparent}.sources-header{display:flex;align-items:center;margin-bottom:12px;padding:0}.compact-sources-grid{display:flex;gap:8px;overflow-x:visible;overflow-y:visible;padding-bottom:10px;flex-wrap:nowrap}.compact-sources-grid .compact-source-card:nth-child(n+4){display:none}.compact-source-card{position:relative;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);border-radius:12px;text-decoration:none;color:inherit;transition:all 0.2s ease;overflow:hidden;flex-shrink:0;font-size:13px;max-width:180px}.compact-source-card:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.15)}a.compact-source-card:hover{text-decoration:none}.compact-source-card:hover .source-title{text-decoration:underline}.source-card-content{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.source-favicon{width:32px;height:32px;border-radius:8px;flex-shrink:0;object-fit:contain}.source-info{flex:1;min-width:0}.source-title{font-size:13px;font-weight:500;color:#fff;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;line-height:1.4}.source-domain{font-size:12px;color:#9F9F9F;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.source-link-icon{flex-shrink:0;color:#9F9F9F;opacity:1;transition:opacity 0.2s ease;margin-left:8px}.compact-source-card:hover .source-link-icon{opacity:1}.show-more-sources-btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 16px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);border-radius:12px;color:#9F9F9F;font-size:13px;font-weight:500;cursor:pointer;transition:all 0.2s ease;text-decoration:none;flex-shrink:0;min-width:120px;white-space:nowrap;margin-top:0}.show-more-sources-btn:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.15);color:#fff}.expanded-sources-list{display:flex;flex-direction:column;gap:12px}.expanded-source-card{position:relative;padding:16px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);border-radius:12px;transition:all 0.2s ease;cursor:pointer;text-decoration:none;color:inherit;display:block}.expanded-source-card:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.15)}a.expanded-source-card:hover{text-decoration:none}.expanded-source-card:hover .expanded-title{text-decoration:underline}.expanded-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}.expanded-favicon{width:40px;height:40px;border-radius:8px;flex-shrink:0}.expanded-meta{flex:1;min-width:0}.expanded-title{font-size:15px;font-weight:500;color:#fff;margin-bottom:4px;line-height:1.4}.expanded-domain{font-size:13px;color:#9F9F9F}.expanded-link{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:rgba(255,255,255,0.08);border-radius:8px;color:#9F9F9F;flex-shrink:0;transition:all 0.2s ease}.expanded-link-icon{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:rgba(255,255,255,0.08);border-radius:8px;color:#9F9F9F;flex-shrink:0;transition:all 0.2s ease}.expanded-source-card:hover .expanded-link-icon{background:rgba(255,255,255,0.12);color:#fff}.expanded-snippet{font-size:14px;line-height:1.6;color:#E0E0E0;padding-left:52px}.outputBox .chipsBox,.outputBox .expandButton,.outputBox .resultsContainer,.outputBox .url-chip{display:none!important}.outputBox[data-has-results="true"] .optionsBox{order:3;position:relative;bottom:auto;margin-top:16px;padding:0;display:flex;flex-direction:row;justify-content:flex-end;align-items:center}@media (max-width:820px){.compact-source-card{max-width:150px}}@media (max-width:768px){.results-tabs{gap:4px;margin-top:12px;margin-bottom:12px}.results-tab{padding:8px 12px;font-size:13px}.tab-icon{width:14px;height:14px}.sources-badge{min-width:18px;height:18px;font-size:12px;padding:0 4px}.compact-sources-grid{gap:6px}.compact-source-card{min-width:130px;padding:8px 10px;font-size:12px}.source-favicon{width:24px;height:24px}.skeleton-block{width:24px;height:24px}.source-title{font-size:12px;-webkit-line-clamp:2}.source-domain{font-size:11px}.source-link-icon{opacity:1;width:12px;height:12px}.show-more-sources-btn{min-width:100px;font-size:12px;padding:8px 12px}.expanded-source-card{padding:12px}.expanded-favicon{width:28px;height:28px}.expanded-title{font-size:13px}.expanded-domain{font-size:11px}.expanded-snippet{font-size:12px;padding-left:0;margin-top:8px}.expanded-link{width:28px;height:28px}}@media (max-width:686px){.compact-sources-grid{flex-direction:column;gap:8px;align-items:center}.compact-source-card{min-width:95%;max-width:95%;width:95%;box-sizing:border-box}.show-more-sources-btn{min-width:95%;max-width:95%;width:95%;box-sizing:border-box}.source-card-content{gap:8px}}@media (max-width:480px){.results-tab{padding:8px;min-width:44px}}@media (max-width:344px){.compact-sources-grid{padding:0 4px}.compact-source-card{padding:6px 8px}.source-favicon{width:20px;height:20px}.skeleton-block{width:20px;height:20px}}.results-loading{padding:0;margin:0}.skeleton-loading{position:relative;overflow:hidden}.skeleton-loading::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,0.08) 50%,transparent 100%);transform:translateX(-100%);animation:skeleton-sweep 2s infinite;pointer-events:none;z-index:10}.skeleton-text{display:inline-block;height:16px;width:80px;background:rgba(255,255,255,0.08);border-radius:4px}.skeleton-text.short{width:60px;height:12px}.sources-badge.skeleton-text{min-width:20px;height:20px;width:20px;border-radius:10px}.skeleton-button-text{width:90px;height:14px;background:rgba(255,255,255,0.08);border-radius:4px}.skeleton-icon{width:16px;height:16px;background:rgba(255,255,255,0.08);border-radius:3px}.skeleton-block{width:32px;height:32px;background:rgba(255,255,255,0.08);border-radius:8px;flex-shrink:0}.compact-source-card.skeleton-loading:nth-child(1)::after{animation-delay:0s}.compact-source-card.skeleton-loading:nth-child(2)::after{animation-delay:0.2s}.compact-source-card.skeleton-loading:nth-child(3)::after{animation-delay:0.4s}@keyframes skeleton-sweep{0%{transform:translateX(-100%)}100%{transform:translateX(200%)}}.searchButton{display:flex;margin-left:6px;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(255,255,255,0.08);z-index:4}[data-has-results] .searchButton{display:none}.outputBox pre{background-color:rgba(255,255,255,0.08);border-radius:12px;padding:16px;overflow-x:auto;font-size:16px;line-height:1.4;white-space:pre-wrap;border:none;position:relative;margin:0px;color:#ffffff26;margin-bottom:12px;display:flex;align-items:flex-start;padding-top:24px;padding-left:24px;padding-bottom:48px;margin-top:12px}.outputBox pre *{font-family:monospace}.outputBox code{font-family:monospace;color:#aeaeae;font-size:16px}.outputBox pre::after{content:'';display:block;height:42px;margin-bottom:-30px}.outputBox .copyCodeButton{position:absolute;bottom:10px;right:10px;display:flex;font-family:'Atkinson Hyperlegible';margin-left:6px;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(74,66,97,1);z-index:4}.outputBox .livecodesButton{position:absolute;bottom:10px;right:74px;display:flex;font-family:'Atkinson Hyperlegible';margin-left:6px;cursor:pointer;border:none;border-radius:45px;padding:6px 12px;color:white;background-color:rgba(74,66,97,1);z-index:4}.outputBox .livecodesButton img{width:auto;height:18px}.outputBox strong{font-weight:bold}.outputBox a{color:#8AB4F8;cursor:pointer;text-decoration:none;transition:text-decoration 0.2s ease}.outputBox a:hover{text-decoration:underline}.outputBox a.compact-source-card,.outputBox a.expanded-source-card{text-decoration:none}.outputBox a.compact-source-card:hover,.outputBox a.expanded-source-card:hover,.outputBox a.compact-source-card:visited:hover,.outputBox a.expanded-source-card:visited:hover{text-decoration:none}.outputBox a:visited{color:#BB86FC;cursor:pointer;text-decoration:none;transition:text-decoration 0.2s ease}.outputBox a:visited:hover{text-decoration:underline}.outputBox blockquote{padding-left:10px;border-left:2px solid #aeaeae;font-style:italic;margin:0}.outputBox blockquote cite{display:block;text-align:right;color:#aeaeae;font-style:normal}.outputBox .table-container{overflow:hidden;border:1px solid #aeaeae;width:fit-content}.outputBox table{width:100%;border-collapse:collapse;margin:0}.outputBox th,.outputBox td{border:1px solid #aeaeae;padding:0.5em 1em;text-align:left}.outputBox th{font-weight:bold}.outputBox h1,.outputBox h2,.outputBox h3,.outputBox h4,.outputBox h5,.outputBox h6,.outputBox p,.outputBox ul,.outputBox ol,.outputBox li{margin:0;margin-top:7px;text-align:left;padding-top:5px;padding-bottom:5px;width:auto}.outputBox ul,.outputBox ol{padding-top:10px;padding-bottom:10px}.outputBox li{padding-top:5px;padding-bottom:5px}.outputBox ol,.outputBox ul{list-style-position:inside;padding-left:0;margin-left:0}.outputBox li{padding-left:1.15em;text-indent:-1.15em}.outputBox li>ol,.outputBox li>ul{margin-left:1.15em}.outputBox ul ul,.outputBox ul ol,.outputBox ol ul,.outputBox ol ol{padding-left:0}.outputBox li>p:first-child{display:inline}.outputBox li>p:first-child + ol,.outputBox li>p:first-child + ul{margin-top:6px}.outputBox p{white-space:pre-wrap}.outputBox img{max-width:100%;display:block;margin-left:auto;margin-right:auto;min-height:30px;margin-top:18px}.outputBox .compact-source-card img,.outputBox .expanded-source-card img{margin-top:0}img.generated-chat-image{max-height:45vh;border-radius:8px;margin:12px auto 8px}.outputBox img[src*="wolframalpha.com"]{mix-blend-mode:screen;clip-path:inset(4px 4px 4px 4px);filter:invert(1) hue-rotate(180deg) brightness(1.4)}.generic-text-ad{width:calc(min(100vw - 18px,841px));max-width:818px;margin:10px auto;padding:20px;background-color:#2a0e3a;border-radius:10px;text-align:center;position:relative;overflow:hidden;transition:background-color 0.3s ease}.generic-text-ad::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;border-radius:10px;padding:3px;background:linear-gradient(135deg,#6a0dad,#9400d3,#ff1493);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none}.generic-text-ad::after{content:"Sponsored";position:absolute;top:5px;right:5px;color:white;padding:2px 5px;font-size:12px;border-radius:3px}.generic-text-ad:hover{background-color:#3a1555}.generic-text-ad a{color:#fff;text-decoration:none;display:block;position:relative}.generic-text-ad p{margin:0;font-size:20px;font-weight:bold;line-height:1.4}.history-title-combo{display:flex;flex-direction:column;font-size:20px;font-weight:400}.history-content-subheader-row{font-size:16px;color:#9F9F9F;margin-top:8px}.history-editing,.history-manager{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-top:32px;width:calc(min(100vw - 24px,867px));max-width:865px;min-width:200px;margin:auto;margin-top:42px}.history-manager{margin-bottom:0px}#history-editing{display:none;opacity:0}#rename-chat-button{position:absolute;right:8px;height:36px;border:none;border-radius:18px;background:rgba(45,40,60,1);color:white;align-items:center;justify-content:center;padding:0 21px;cursor:pointer}.history-input-field{width:-webkit-fill-available;height:48px}.history-input-edit-container{display:flex;position:relative;align-items:center;width:55%;border-radius:32px;border:1px solid rgba(255,255,255,0.13);background:rgba(255,255,255,0.04);backdrop-filter:blur(12px)}#new-chat-title{width:80%;height:48px;border-radius:32px;border:none;padding:0px;padding-left:24px;padding-right:80px;background:transparent;font-family:"Helvetica";font-size:16px;font-weight:400;color:white}#new-chat-title::placeholder{color:#9F9F9F}.chat-mode-border{border:.5px solid #fefefe12;width:calc(min(100vw - 18px,864px));height:0px;margin:auto;margin-top:42px}#chat-mode-border{margin-bottom:42px}select.chat-dropdown-box>option{color:black}@media screen and (max-width:890px){.chatoptionsBox{width:calc(min(100vw - 25px,820px))}.outputBox{width:calc(min(100vw - 62px,818px));padding-left:22px;padding-right:22px}.history-editing{display:flex;flex-direction:column}.history-title-combo{margin-bottom:18px;width:100%}.chat-mode-border{width:94%}.history-input-edit-container{width:100%}#history-delete-chat,#character-edits-chat{width:100%}.history-manager{display:flex;flex-direction:column}#chatSessionDeleteButton,#chatHistoryDeleteButton,#see-more-btn{width:50%}}@media screen and (max-width:715px){.response-length-options{flex-direction:column}.history-editing,.history-manager,#see-more-btn,.characters-chat-link{width:calc(min(100vw - 24px,867px));margin-top:8px!important}#history-editing{margin-top:0px;margin-bottom:24px}#history-delete-chat,#character-edits-chat{flex-direction:column}.history-title-combo{box-sizing:border-box;padding-left:8px}#chatSessionDeleteButton,#chatHistoryDeleteButton{width:100%}.other-chat-styles{flex-direction:column;margin:auto;max-width:98%}.other-chat-styles a{box-sizing:border-box;margin:0px;margin-bottom:7px;width:100%}.characters-chat-link{margin-bottom:12px}}.optionsBox{display:flex}.group1,.group2{display:flex}#see-more-btn{margin:15px auto 0;padding:0;display:flex;margin-bottom:60px}.chat-dropdown-box{display:block;font-size:16px;width:100%;color:white;background:rgba(45,40,60,1);border:none;border-radius:12px;padding:13.5px 22px;appearance:none;-webkit-appearance:none;-moz-appearance:none;opacity:1}.adsbykoah{display:none;width:calc(min(100vw - 16px,864px));margin:10px auto;margin-top:0px;box-sizing:border-box}.koah-ad-filled{display:block}.koah-ad-container{background:#161027!important;color:white!important;padding:16px!important;border-radius:8px!important;border:1px solid #342F43!important;width:100%!important;box-sizing:border-box!important}.koah-ad{color:white!important;text-decoration:none!important}.koah-ad strong{color:#BE84FF!important}.koah-ad-advertiser-label{color:white!important}.koah-ad-label-text{color:rgba(255,255,255,0.7)!important}.koah-ad-cta-container{background:#281353!important;border:1px solid #442084!important;color:white!important;justify-content:center!important}.koah-ad-cta-container span{color:white!important}.koah-ad-badge{display:none}.prorata-ad{margin-top:23px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.13);background:transparent;overflow:visible;clear:both;transition:transform 0.2s ease}.prorata-ad-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-size:13px;color:rgba(255,255,255,0.5);font-weight:500}.prorata-ad-header span:first-child{text-transform:uppercase;letter-spacing:0.5px;font-size:11px}.prorata-ad img{float:left;width:140px;height:auto;border-radius:8px;margin:0px 15px 0px 0px;object-fit:cover;background:rgba(255,255,255,0.05)}.prorata-ad-content{color:rgba(255,255,255,0.8);margin:0;line-height:1.6;font-size:15px;overflow-wrap:break-word;word-wrap:break-word}.prorata-ad-content strong{color:white;font-weight:600;font-size:16px;display:inline}@media (max-width:600px){.prorata-ad,.prorata-ad-link{display:flex;flex-direction:column;gap:12px}.prorata-ad img,.prorata-ad-link img{width:120px;height:auto;margin:0;float:none;align-self:center}.prorata-ad-content{font-size:14px}.prorata-ad-content strong{font-size:15px}}.prorata-ad-audible{display:flex;gap:20px;align-items:flex-start}.prorata-ad-audible img.audible-book-cover{width:140px;height:auto;border-radius:4px;flex-shrink:0}.prorata-ad-audible-content{flex:1;min-width:0}.prorata-ad-audible-headline{margin:0 0 8px 0!important;padding:0!important;font-size:17px;line-height:1.3;color:white;font-weight:bold}.prorata-ad-audible-quote-icon{flex-shrink:0;width:20px;height:20px;display:inline-block;vertical-align:middle;margin-right:6px;padding-bottom:4px}.prorata-ad-audible-quote-icon svg{width:100%;height:100%}.prorata-ad-audible-text{color:rgba(255,255,255,0.8);font-size:16px;line-height:1.5;margin:8px 0 12px;display:flex;align-items:flex-start;gap:8px}.prorata-ad-audible-text .prorata-ad-audible-quote-icon{margin-top:2px}.prorata-ad-audible-cta{display:inline-flex;align-items:center;gap:8px;color:#b78ded!important;text-decoration:none;font-weight:500;font-size:15px;transition:color 0.2s ease,text-decoration 0.2s ease}.prorata-ad-audible-logo{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;background:#FF9900;border-radius:50%;flex-shrink:0}.prorata-ad-audible-logo svg{width:16px;height:16px}@media (max-width:640px){.prorata-ad-audible{flex-direction:column;gap:16px}.prorata-ad-audible img.audible-book-cover{width:120px;align-self:center}.prorata-ad-audible-headline{font-size:16px}.prorata-ad-audible-text{font-size:14px}.prorata-ad-audible-cta{font-size:14px}}.prorata-ad:has(.prorata-ad-link){padding:0;border:none}a.prorata-ad-link,a.prorata-ad-link:hover,a.prorata-ad-link:active,a.prorata-ad-link:visited{display:block;text-decoration:none;color:inherit;cursor:pointer;padding-top:12px;border-top:1px solid rgba(255,255,255,0.13);overflow:auto}.prorata-ad-link .prorata-ad-content,.prorata-ad-link .prorata-ad-content strong,.prorata-ad-link .prorata-ad-audible-headline,.prorata-ad-link .prorata-ad-audible-text,.prorata-ad-link .prorata-ad-header,.prorata-ad-link .prorata-ad-header span{color:inherit}.prorata-ad-link .prorata-ad-content{color:rgba(255,255,255,0.8)}.prorata-ad-link .prorata-ad-content strong{color:white}.prorata-ad-link .prorata-ad-header{color:rgba(255,255,255,0.5)}.prorata-ad-cta-text{color:#B78DED;font-weight:500;transition:color 0.2s ease,text-decoration 0.2s ease}.thrad-ad-container{width:calc(min(100vw - 16px,864px));margin:10px auto;margin-top:0;background:#161027;color:white;padding:16px;border-radius:8px;border:1px solid #342F43;box-sizing:border-box}.thrad-ad-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;font-size:14px}.thrad-ad-icon{width:36px;height:36px;border-radius:8px;object-fit:cover;flex-shrink:0}.thrad-ad-advertiser{color:white;font-weight:500}.thrad-ad-label{color:rgba(255,255,255,0.5);margin-left:auto}.thrad-ad-text{color:white;line-height:1.5;margin-bottom:12px;font-size:16px}.thrad-ad-text strong,.thrad-ad-headline{color:#BE84FF;font-weight:600}.thrad-ad-headline{text-decoration:none}.thrad-ad-headline:hover{text-decoration:underline}.thrad-ad-cta{display:inline-flex;align-items:center;justify-content:center;background:#281353;border:1px solid #442084;color:white;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:14px;font-weight:500;transition:background 0.2s}.thrad-ad-cta:hover{background:#3a1d6e}.chat-layout-container{position:relative;margin:0;padding:0}.chat-layout-container.sidebar-open .chat-sidebar{transform:translateX(0)}@media (min-width:1200px){.chat-layout-container.sidebar-open .chat-main{margin-left:270px;transition:margin-left 0.2s ease}.chat-layout-container:not(.sidebar-open) .chat-main{margin-left:0;transition:margin-left 0.2s ease}}.chat-layout-container:not(.ready-for-animation) .chat-sidebar,.chat-layout-container:not(.ready-for-animation) .chat-main,.chat-layout-container:not(.ready-for-animation) .persistent-compose-area{transition:none!important}.chat-sidebar{position:fixed;top:47px;bottom:0;width:260px;background:rgba(21,16,38,1);border:1px solid rgba(51,47,66,1);z-index:5;overflow:visible;transition:transform 0.2s ease;transform:translateX(-100%);left:0;border-radius:0 12px 12px 0;border-left:none}@media (min-width:1200px){.chat-sidebar{left:10px;border-radius:12px;border-left:1px solid rgba(51,47,66,1)}.chat-layout-container:not(.sidebar-open) .chat-sidebar{transform:translateX(calc(-100% - 10px))}}.sidebar-header{top:0;background:rgba(21,16,38,1);padding:21.5px;border-bottom:1px solid rgba(255,255,255,0.13);text-align:center;border-radius:0 12px 0 0;overflow:hidden;cursor:pointer}.sidebar-label{font-size:18px}.sidebar-toggle-container{position:fixed;top:58px;left:11px;display:flex;align-items:center;gap:10px;z-index:6}@media (min-width:1200px){.sidebar-toggle-container{left:21px}}.sidebar-toggle{width:45px;height:45px;border-radius:10px;border:none;background:rgba(45,40,60,1);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:width 0.3s ease,opacity 0.3s ease,visibility 0.3s ease,box-shadow 0.3s ease}.history-icon{width:28px;height:28px}.chat-main{position:relative;margin-left:0}.sidebar-footer{position:absolute;bottom:0;width:100%;padding:30px 16px 12px;box-sizing:border-box;background:linear-gradient(to bottom,rgba(21,16,38,0),rgba(21,16,38,0.5) 20px,rgba(21,16,38,0.9) 50%,rgba(21,16,38,1) 100%);z-index:10;border-radius:0 0 12px 0;overflow:hidden}@media (min-width:1200px){.sidebar-header{border-radius:12px 12px 0 0}.sidebar-footer{border-radius:0 0 12px 12px}}.sidebar-ad{position:absolute;bottom:50px;width:100%;padding:12px 16px;box-sizing:border-box;z-index:11}.delete-all-history-button{width:100%;background:rgba(45,40,60,1);color:#fff;border:none;border-radius:45px;padding:12px 16px;font-size:16px;cursor:pointer;text-align:center;position:relative;overflow:hidden}.delete-all-history-button::after{content:"";position:absolute;left:0;right:0;bottom:-10px;height:20px;background:linear-gradient(to bottom,transparent,rgba(0,0,0,0.2));border-radius:0 0 45px 45px;z-index:-1}.sidebar-overlay{position:fixed;top:47px;left:0;right:0;bottom:50px;background:linear-gradient(to bottom,rgba(0,0,0,0) 0%,rgba(0,0,0,0.35) 30px,rgba(0,0,0,0.35) calc(100% - 30px),rgba(0,0,0,0) 100%);opacity:0;pointer-events:none;transition:opacity 0.2s ease;z-index:4}.sidebar-overlay.active{opacity:1;pointer-events:auto}.history-heading-label{color:#9F9F9F;margin:30px 0 6px 7px;font-size:14px}.chat-history-item{position:relative;display:block;padding:8px 40px 8px 8px;color:#fff;cursor:pointer;border-radius:10px;background-color:transparent;transition:none;margin-bottom:6px}.chat-history-label{display:block;white-space:normal;word-wrap:break-word;overflow-wrap:break-word}.chat-history-dots{position:absolute;top:50%;right:8px;transform:translateY(-50%);font-size:24px;font-weight:bold;user-select:none;opacity:0}.chat-history-item-wrapper:hover .chat-history-dots{opacity:1}.chat-history-item:hover{background-color:var(--clear)}.chat-history-item.current-chat{background-color:rgba(60,55,75,1)}.chat-history-item.menu-open{background-color:var(--clear)}.chat-history-item.rename-open{background-color:var(--clear)}.chat-history-item.current-chat.rename-open{background-color:rgba(60,55,75,1)}.chat-history-item.current-chat.menu-open{background-color:rgba(60,55,75,1)}.chat-history-item.menu-open .chat-history-dots,.chat-history-item.current-chat .chat-history-dots{opacity:1}.chat-history-context-menu{position:fixed;display:none;background-color:rgba(21,16,38,1);border:1px solid rgba(51,47,66,1);border-radius:10px;padding:5px;z-index:6}.chat-history-context-menu button{display:block;width:100%;border:none;cursor:pointer;text-align:center;padding:5px 8px;background:transparent;border-radius:6px}.history-rename-btn{color:#fff;margin-bottom:5px}.history-rename-btn:hover{background:rgba(45,40,60,1)}.history-delete-btn{color:#ee7a7a}.history-delete-btn:hover{background:rgba(51,23,42,1)}.inline-rename-input{display:block;padding:6px 6px;border-radius:5px;border:1px solid rgba(74,66,97,1);background:rgba(45,40,60,1);color:#fff;width:90%;outline:none}.modal-root{position:fixed;overflow:hidden;background-color:rgba(0,0,0,0.5);left:0;top:0;width:0;height:0;opacity:0;transition:opacity 0.15s ease-out,width 0s linear 0.15s,height 0s linear 0.15s;z-index:9999}.modal-root.visible{width:100%;height:100%;opacity:1;transition:opacity 0.15s ease-out}.modal{margin:0 auto;width:100%;max-width:400px;background:rgba(21,16,38,1);border:1px solid rgba(51,47,66,1);padding:0;border-radius:12px;position:relative;top:50%;transform:translateY(-50%);max-height:85vh;overflow:auto}.title{text-align:center;font-size:20px;margin-top:1.5rem}.confirm-desc{font-size:14px;color:#bbb;text-align:center;padding:1.25rem 2rem}.modal-button-container{display:flex;flex-direction:column;justify-content:center;margin-bottom:1.5rem}.confirm-button{padding:0.6rem 1rem;background-color:transparent;margin:0.25rem 2rem;border-radius:5px;border:none;color:white;cursor:pointer}#confirm-yes-btn{color:#ee7a7a;background-color:rgba(51,23,42,1);border-radius:45px}#confirm-cancel-btn{background-color:rgba(45,40,60,1);border-radius:45px}#confirm-yes-btn:disabled{cursor:not-allowed;opacity:0.5}.confirm-input{display:block;padding:12px 12px;margin:4px auto;margin-top:0px;border-radius:12px;border:1px solid rgba(74,66,97,1);background:rgba(45,40,60,1);color:#fff;width:76%;outline:none}.pro-banner-showing .new-chat-button-container,.pro-banner-showing .sidebar-toggle-container,.pro-banner-showing .sidebar-overlay{top:100px!important}.pro-banner-showing .chat-sidebar{top:89px!important}@media (min-width:1200px){.new-chat-button-container{right:21px}}.new-chat-button{width:45px;height:45px;border-radius:10px;border:none;background:rgba(45,40,60,1);display:flex;align-items:center;justify-content:center;cursor:pointer;text-decoration:none;transition:width 0.3s ease,opacity 0.3s ease,visibility 0.3s ease,box-shadow 0.3s ease}.plus-icon{width:22px;height:22px;margin:0;display:flex;align-items:center;justify-content:center}.chat-mode-dropdown-container{width:calc(min(100vw - 22.5px,400px));max-width:865px;margin:auto}.chat-mode-dropdown-trigger{width:100%;height:45px}.chat-mode-dropdown-menu{bottom:calc(100% + 5px);width:280px;height:75vh;max-height:75vh;z-index:6;display:flex;flex-direction:column;overflow:hidden;padding:0}.chat-mode-menu-scroll{}.header-title{font-size:14px;color:#9F9F9F}.info-link{color:#9F9F9F;text-decoration:none;display:flex;align-items:center}.chat-mode-menu-item{margin-bottom:6px;margin-left:8px;margin-right:8px;padding:8px 8px;transition:none}.chat-mode-menu-item:hover{background-color:var(--clear)}.chat-mode-checkmark{display:none}.katex{font-family:'Times New Roman','Times',serif;font-size:0.7vw;overflow-x:auto;overflow-y:hidden;white-space:nowrap}.upload-preview-wrapper{position:absolute;width:96%;top:5px;left:12px;right:210px;display:flex;flex-direction:row;gap:8px;overflow-x:auto;overflow-y:hidden;scroll-behavior:smooth;pointer-events:none;background:rgba(25,23,42,1);padding:6px 0px}.upload-preview-container{position:relative;overflow:visible;flex-shrink:0;width:48px;height:48px;pointer-events:auto}.upload-preview-container .preview-image{width:48px;height:48px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.2)}.upload-preview-container .close-button{position:absolute;top:-4px;right:-6px;width:16px;height:16px;border-radius:50%;background:rgba(255,255,255,0.9);color:#333;border:none;cursor:pointer;font-size:12px;line-height:1;padding:0;display:flex;align-items:center;justify-content:center;font-weight:bold}.upload-preview-container .close-button:hover{background:rgba(255,255,255,1)}.text-file-indicator{width:48px;height:48px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:9px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex;align-items:center;justify-content:center;padding:4px;color:white}.persistent-compose-area{position:relative}.chatImageBox{display:grid;gap:8px;margin-left:20px;width:fit-content;cursor:pointer}.image-chatbox{text-align:center;display:inline-block;background:rgba(25,23,42,1);border-radius:12px;border:1px solid rgba(49,47,64,1);border-radius:12px;padding:4px;width:auto}.chat-image{padding-top:0px!important;border-radius:8px;display:none;text-align:center;width:80px;aspect-ratio:1 / 1;object-fit:cover;cursor:pointer}#imageOverlay{position:fixed;top:0;left:0;width:100vw;height:100dvh;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:9999;transform:none!important;-webkit-transform:none!important}#imageOverlay img{max-width:90%;max-height:90%;box-shadow:0 0 16px rgba(0,0,0,0.5);border-radius:4px}.preview-image{height:48px;width:48px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.2)}.close-button{background:transparent;border:none;color:white;font-size:16px;cursor:pointer;background-color:rgba(255,255,255,0.08);border-radius:20px;padding:5px 7px}#drag-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,0.3);border:5px dashed #fff;box-sizing:border-box;z-index:9999;pointer-events:none}#convo{height:auto;overflow-y:auto;padding-bottom:77px;scroll-behavior:smooth;display:block;margin-bottom:-10px;width:100%;margin-left:auto;margin-right:auto;position:relative;transition:background-image 0.3s ease;padding-top:24px}h3:has(+ .ai-disclaimer){margin-bottom:8px}.ai-disclaimer{text-align:center;margin:0 0 8px 0;font-size:13px;color:rgba(255,255,255,0.5)}.ai-disclaimer a{color:rgba(255,255,255,0.5);text-decoration:underline}.ai-disclaimer a:hover{text-decoration:underline}.persistent-compose-area{position:fixed;bottom:10px;left:0;right:0;margin:0 auto;width:calc(min(100vw - 18px,862px));max-width:862px;z-index:3;transform:none;background:rgba(25,23,42,1);border-radius:12px;border:1px solid rgba(49,47,64,1);transition:width 0.22s ease,left 0.22s ease,right 0.22s ease,margin-left 0.22s ease,max-width 0.22s ease}#persistentChatbox.chatbox{min-height:69px;max-height:25vh;height:auto;overflow-y:auto;flex:1;color:white;font-size:18px;padding:20px;padding-right:200px;margin:0;display:block;outline:none;word-wrap:break-word;line-height:1.5;white-space:pre-wrap;transition:height 0.1s;z-index:3;resize:none;box-sizing:border-box;width:100%}.expanded #persistentChatbox.chatbox{padding:20px 20px 5px}.expanded #persistentChatbox.has-thumbnail{padding:67px 20px 5px}#persistentChatbox.has-thumbnail{padding-top:67px}.persistent-compose-area .response-length-options{position:absolute;right:15px;bottom:14px;margin:0;padding:0;z-index:3;pointer-events:none}.expanded .response-length-options{position:unset;right:unset;bottom:unset;padding:unset;padding:0 10px 10px;width:unset}.persistent-compose-area .button-container{display:flex;align-items:center;gap:7px;pointer-events:none}.persistent-compose-area #chatSubmitButton,.persistent-compose-area #chatStopButton,.persistent-compose-area #recordButton,.persistent-compose-area #attachFileButton,.persistent-compose-area .uploadButton{pointer-events:auto}#convo .chatbox-wrapper:last-child{display:none}@media (min-width:1200px){.chat-layout-container.sidebar-open .chat-main{margin-left:270px;transition:margin-left 0.2s ease}.chat-layout-container:not(.sidebar-open) .chat-main{margin-left:0;transition:margin-left 0.2s ease}.chat-layout-container.sidebar-open .persistent-compose-area{left:270px;width:auto;max-width:862px;margin-left:auto;margin-right:auto}.chat-layout-container:not(.sidebar-open) .persistent-compose-area{left:0;right:0;width:calc(min(100vw - 18px,862px));max-width:862px;margin:0 auto}.chat-layout-container.sidebar-open #convo{}.chat-layout-container:not(.sidebar-open) #convo{}}.explore-aichat-modes{width:calc(min(100vw - 21px,865px));margin:auto}.chat-chips-container{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:24px}.chat-chip-image{width:35px;height:35px;border-radius:50%;margin-right:8px;vertical-align:middle}.chat-chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 16px 8px 16px;border-radius:45px;background-color:rgba(45,40,60,1);color:white;font-size:14px;text-decoration:none;white-space:nowrap;border:2px solid transparent;box-sizing:border-box}.chat-chip-with-image{padding:8px 16px 8px 9px}.hidden-chip{display:none}.chat-model-chip{cursor:pointer;transition:all 0.2s ease;gap:6px}.chat-model-chip.selected{background:linear-gradient(135deg,#8F37FF 0%,#6B28CC 100%);border:2px solid rgba(203,168,255,0.5);box-shadow:0 0 20px rgba(143,55,255,0.3)}.chat-model-chip.locked{opacity:0.7}.chat-model-chip .lock-icon{margin-left:4px}#chatMain>h1,#chatMain>h3,#chatMain .explore-aichat-modes,#chatMain .figure,#characterReportButton,footer{display:block}#chatSidebar{bottom:10px}#sidebarOverlay{bottom:10px}@media (max-width:523px){.chat-mode-dropdown-container{margin-right:56px}}.chat-main{position:relative;display:flex;flex-direction:column;margin-bottom:10px}#convo{transition:height 0.05s ease-out;flex:0 1 auto}#convo ~ .persistent-compose-area{position:absolute;bottom:-37px;left:0;right:0;z-index:3}.persistent-compose-area{flex:0 0 auto}.nav-items{display:flex;justify-content:space-between;align-items:center;width:calc(100% - 32px)}.chat-mode-section{display:flex;margin:0;width:auto;align-items:center;position:relative;z-index:50;pointer-events:auto}.chat-mode-dropdown-container{position:relative;width:auto;margin-right:0;pointer-events:auto}.chat-mode-dropdown-trigger{display:flex;align-items:center;justify-content:flex-start;height:41px;border-radius:45px;background:rgba(45,40,60,1);border:none;color:white;font-size:16px;cursor:pointer;position:relative;z-index:10;pointer-events:auto;overflow:hidden;width:fit-content;padding-left:12px;padding-right:30px;margin-left:auto;transition:width 0.15s cubic-bezier(0.2,1,0.3,1),padding 0.15s cubic-bezier(0.2,1,0.3,1)}.chat-mode-dropdown-trigger.compact{width:41px;padding-left:0;padding-right:0}#currentChatModeLabel{transition:opacity 0.15s cubic-bezier(0,0,0.58,1) 0.05s;white-space:nowrap;margin-right:6px}.chat-mode-dropdown-trigger.compact #currentChatModeLabel{opacity:0;width:0;margin:0;padding:0;position:absolute;visibility:hidden}.dropdown-caret{position:absolute;right:8.5px;top:50%;transform:translateY(-50%) rotate(180deg);width:24px;height:24px;z-index:2}.chat-mode-dropdown-trigger.open .dropdown-caret{transform:translateY(-50%) rotate(0deg)}.chat-mode-menu-header{display:flex;align-items:center;justify-content:space-between;margin:8px 8px 6px 8px;padding-bottom:6px}.header-title{font-size:14px;color:#9F9F9F}.info-link{color:#9F9F9F;text-decoration:none;display:flex;align-items:center}.chat-mode-menu-item{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;color:#fff;font-size:15px;line-height:1.4;border-radius:6px;cursor:pointer}.chat-mode-menu-item:hover{background-color:rgba(45,40,60,0.5)}.response-length-options,.button-container{pointer-events:auto;position:relative;z-index:10}.button-container>div{pointer-events:auto}#convo .chatbox-wrapper{display:block;visibility:visible;opacity:1;position:relative;height:auto;overflow:visible;pointer-events:auto;background:rgba(21,16,38,1);border-radius:12px;border:1px solid rgba(255,255,255,0.13);margin-bottom:10px;margin-left:auto;margin-right:auto;width:calc(min(100vw - 18px,862px))}#convo .chatbox-wrapper:empty,#convo .chatbox-wrapper .chatbox:empty{display:none}.chatbox-wrapper.empty-box{opacity:0;position:absolute;pointer-events:none;z-index:-1}@media (max-width:600px){.chat-mode-dropdown-trigger{width:41px;padding-left:0;padding-right:0}.chat-mode-dropdown-trigger #currentChatModeLabel{opacity:0;visibility:hidden;width:0;margin:0;padding:0}.expanded #persistentChatbox.chatbox{max-height:18vh}}@media (max-width:500px){.chatImageBox{margin-bottom:40px}}.outputBox,.chatbox-wrapper{contain:content}.new-chat-button-container{position:fixed;top:58px;right:11px;z-index:3}@media (min-width:1200px){.new-chat-button-container{right:21px}}.toggle-text{display:inline;color:white;font-size:16px;transition:opacity 0.3s ease;margin-left:8px}.sidebar-toggle,.new-chat-button{width:auto;padding:0 12px;display:flex;align-items:center;justify-content:center;border-radius:45px;transition:width 0.3s ease,opacity 0.3s ease,visibility 0.3s ease;box-shadow:none}.sidebar-toggle,.new-chat-button{flex-direction:row;justify-content:flex-start;padding:0 14px 0 10px}.sidebar-toggle .toggle-text,.new-chat-button .toggle-text{margin-left:8px}.sidebar-toggle .close-icon{position:absolute;width:22px;height:22px;opacity:0;transition:opacity 0.1s ease;z-index:2;left:50%;top:50%;transform:translate(-50%,-50%);padding-right:2px}.chat-layout-container.sidebar-open .sidebar-toggle .history-icon{opacity:0;visibility:hidden}.chat-layout-container.sidebar-open .sidebar-toggle .close-icon{opacity:1}.chat-layout-container.sidebar-open .sidebar-toggle{width:45px;padding:0;position:relative;box-shadow:none!important}.chat-layout-container.sidebar-open .sidebar-toggle .toggle-text{opacity:0;width:0;margin:0;visibility:hidden}#chatSubmitButton,#chatStopButton{width:41px;height:41px;padding:0;margin:0;border-radius:45px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;line-height:1;position:relative}#chatSubmitButton{background:#8F37FF}#chatStopButton{background:rgba(45,40,60,1);display:none}#chatSubmitButton svg,#chatStopButton svg{width:22px;height:22px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);margin:0;padding:0}#chatSubmitButton:disabled,.chatEditSubmitButton:disabled{opacity:0.5;cursor:not-allowed}.thinking-indicator{width:calc(min(100vw - 67px,819px));display:block;margin:auto;margin-bottom:10px;background:rgba(21,16,38,1);border-radius:12px;color:white;padding:22px;font-size:18px;border:1px solid rgba(51,47,66,1);overflow-x:hidden;position:relative;min-height:24px}.thinking-text{font-weight:500;opacity:0.8}.thinking-dots{display:inline-block;position:relative}.thinking-dots::after{content:'';animation:thinking-dots 1.8s infinite;display:inline-block}@keyframes thinking-dots{0%{content:'.'}33%{content:'..'}66%{content:'...'}}.markdownContainer{overflow-x:auto}.character-avatar-container{float:left;margin:-1px 10px 10px -12px}.character-avatar{width:100px;height:100px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,0.13);display:block}.outputBox.has-character-avatar{border-top-left-radius:21px}.outputBox.has-character-avatar .markdownContainer{overflow-x:visible}.loading-chat-history .chat-sidebar{top:47px!important;bottom:10px!important}.loading-chat-history #sidebarOverlay{top:10px!important;bottom:10px!important}.loading-chat-history .persistent-compose-area{opacity:1!important;visibility:visible!important}:root{--button-glow-shadow:0px 4px 8px 0px rgba(0,0,0,0.4),0px 8px 16px 0px rgba(0,0,0,0.3),0px 2px 24px 0px rgba(80,70,120,0.5)}.sidebar-toggle,.new-chat-button{box-shadow:none;transition:width 0.3s ease,opacity 0.3s ease,visibility 0.3s ease,box-shadow 0.3s ease}@media (max-width:1419px){.chat-layout-container.sidebar-open .new-chat-button{box-shadow:var(--button-glow-shadow)}.chat-layout-container.sidebar-open .sidebar-toggle{box-shadow:none}}@media (max-width:1180px){.chat-layout-container:not(.sidebar-open) .sidebar-toggle{box-shadow:var(--button-glow-shadow)}}@media (max-width:1129px){.chat-layout-container:not(.sidebar-open) .new-chat-button{box-shadow:var(--button-glow-shadow)}}.chat-layout-container.sidebar-open .sidebar-toggle{box-shadow:none}@media (min-width:1420px){.chat-layout-container.sidebar-open .new-chat-button{box-shadow:none}}body::after{content:"";position:fixed;bottom:0;left:0;width:100%;height:40px;background:linear-gradient(to bottom,transparent,rgba(1,2,5,1) 50%,rgba(1,2,5,1) 100%);z-index:2;pointer-events:none}.sidebar-toggle-container,.new-chat-button-container{opacity:1;visibility:visible;transition:opacity 0.3s ease,visibility 0.3s ease;z-index:6}.buttons-hidden .sidebar-toggle-container,.buttons-hidden .new-chat-button-container{opacity:0;visibility:hidden;pointer-events:none}.sidebar-toggle-container,.new-chat-button-container{pointer-events:auto}.fs-sticky-footer{position:fixed!important;bottom:80px!important;z-index:0!important}.fs-sticky-parent{position:fixed!important;bottom:80px!important;z-index:0!important}.fs-sticky-shifted{bottom:132px!important}.chat-history-search-container{position:absolute;top:60px;left:0;right:0;padding:12px 16px 20px;background:linear-gradient(to bottom,rgba(21,16,38,1) 0%,rgba(21,16,38,1) 30%,rgba(21,16,38,0.7) 60%,rgba(21,16,38,0) 85%);z-index:10}.chat-history-search-wrapper{position:relative;display:flex;align-items:center}.chat-history-search-input{width:100%;padding:10px 36px 10px 12px;background:rgba(25,23,42,1);border:1px solid rgba(49,47,64,1);border-radius:5px;color:#fff;font-size:14px;outline:none;transition:border-color 0.2s ease}.chat-history-search-input::placeholder{color:rgba(159,159,159,0.8)}.chat-history-search-input:focus{outline:none}.chat-history-search-input:active{outline:none}.chat-history-search-icon{position:absolute;right:8px;width:28px;height:28px;color:rgba(159,159,159,1);display:flex;align-items:center;justify-content:center;pointer-events:none}.chat-history-search-clear{position:absolute;right:8px;width:28px;height:28px;border:none;background:transparent;color:rgba(159,159,159,1);cursor:pointer;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:color 0.2s ease,opacity 0.2s ease}.chat-history-search-clear:hover{color:#fff;opacity:1}.chat-history-search-clear:active{opacity:0.8}.chat-history-search-status{margin-top:8px;font-size:13px;color:rgba(159,159,159,0.8);text-align:center;min-height:20px}.search-spinner{width:16px;height:16px;border:2px solid rgba(159,159,159,0.3);border-top-color:rgba(159,159,159,0.8);border-radius:50%;animation:spin 0.8s linear infinite;flex-shrink:0}@keyframes spin{to{transform:rotate(360deg)}}.sidebar-scroll-wrapper{position:absolute;top:60px;left:0;right:0;bottom:0;overflow-y:auto;overflow-x:hidden;scrollbar-color:rgba(45,40,60,1) transparent;scrollbar-width:thin;z-index:1}.sidebar-content{padding:16px;padding-top:80px;padding-bottom:150px;box-sizing:border-box}.chat-history-items{padding-bottom:60px}.sidebar-content .history-heading-label:first-child{margin-top:0}.history-heading-label.first-visible{margin-top:0}.chat-history-item-wrapper.search-hidden,.history-heading-label.search-hidden{display:none!important}.chat-history-search-input.searching{cursor:wait}@media (max-width:768px){.chat-history-search-container{padding:10px 12px}.chat-history-search-input{font-size:16px}}.scroll-to-bottom-btn{position:fixed;bottom:calc(16px + var(--compose-h) + var(--ad-clearance));left:50%;transform:translateX(-50%);z-index:2147483647;display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:rgba(72,64,95,1);border:1px solid rgba(128,122,144,1);cursor:pointer;transition:all 0.2s ease}.scroll-to-bottom-btn svg{width:24px;height:24px}.scroll-to-bottom-btn svg path{stroke:white;stroke-width:2.5}.scroll-to-bottom-btn:active{transform:translateX(-50%) scale(0.98)}@media (min-width:1200px){.chat-layout-container.sidebar-open .scroll-to-bottom-btn{left:calc(50% + 135px)}}#chatAttachmentInput{display:none}.persistent-compose-area div.chat-attachments-container{display:flex;flex-direction:row;flex-wrap:wrap;align-items:flex-start;gap:8px;padding:8px 12px}.persistent-compose-area div.chat-attachments-container:empty{display:none}.persistent-compose-area div.chat-attachments-container div.upload-preview-container{display:inline-flex;flex-shrink:0;width:48px;height:48px;min-width:48px;min-height:48px;max-width:48px;max-height:48px;overflow:visible}.persistent-compose-area div.chat-attachments-container div.upload-preview-container img.preview-image{width:48px;height:48px;object-fit:cover}.persistent-compose-area div.chat-attachments-container div.upload-preview-container div.text-file-indicator{width:48px;height:48px;padding:4px;box-sizing:border-box}.persistent-compose-area div.upload-preview-container.uploading{opacity:0.6}.message-attachments-grid{display:grid;gap:8px;margin:8px 0 8px 20px;width:fit-content}.message-attachment-square{width:80px;height:80px;border-radius:8px;overflow:hidden;background:rgba(25,23,42,1);border:1px solid rgba(49,47,64,1);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:border-color 0.2s ease}.message-attachment-square:hover{border-color:rgba(255,255,255,0.3)}.message-attachment-square .chat-image{width:100%;height:100%;object-fit:cover;border-radius:0;padding:0!important}.message-attachment-square .attachment-icon{font-size:24px;margin-bottom:4px}.message-attachment-square .attachment-name{font-size:9px;color:rgba(255,255,255,0.7);text-align:center;padding:0 4px;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media (max-width:500px){.message-attachments-grid{margin-bottom:40px}}</style>

        <!--  Start Google Analytics Tag -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GY2GHX2J9Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GY2GHX2J9Y');
</script>
        <!--  End Google Analytics Tag -->
    <!-- Twitter conversion tracking base code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='https://static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
twq('config','pzofp');
</script>
<!-- End Twitter conversion tracking base code -->
	</head>
	<body>

<!-- Pushdown ad should be placed right after the opening <body> tag. Note: if you have a sticky navigation bar, you may need to update CSS to accommodate this ad type. -->
<!-- Tag ID: deepai.org_header -->
<div class="sticky">
  <div align="center" data-freestar-ad="__320x50 __970x90" id="deepai.org_header">
    <script data-cfasync="false" type="text/javascript">
      if (typeof freestar !== 'undefined') {
        freestar.config.enabled_slots.push({ placementName: "deepai.org_header", slotId: "deepai.org_header" });
      }
    </script>
  </div>
</div>

<script>
function removeAdHeader() {
    var pushdown = document.getElementById("deepai.org_header");
    if(pushdown){
        // just remove the parent element
        const parentMain = pushdown.parentNode;
        if (parentMain){
            parentMain.remove();
        }
    }
}

if(window.user_paid_for_no_ads){
    removeAdHeader(); // remove element "deepai.org_header" if it exists
}else{
    try{
        var headerAd = document.getElementById("deepai.org_header");
        headerAd.setAttribute('style', 'height: 90px;');
    }catch(err){
        console.log("Error setting header ad height", err);
    }
}

</script>

<!-- end pushdown tag -->
        
        <header>
            
<style>
   :root {
  --white: rgba(255, 255, 255, 1);
  --clear: rgba(255, 255, 255, 0.06);
  --cod-gray: rgba(8, 8, 8, 1);
  --cod-gray-2: rgba(9, 9, 9, 1);
  --pink: #c549fe;
  --purple: #7000ff;
  --font-size-xxs: 24px;
  --font-size-xs: 26px;
  --font-size-s: 32px;
  --font-size-m: 40px;
  --font-size-l: 48px;
}
a.button {
  display: flex;
  flex-direction: row;
  width: 35px;
  padding: 5px 95px;
  justify-content: center;
  align-items: center;
  gap: 10px;
  border-radius: 12px;
  font-size: 18px;
  text-align: center;
  font-style: normal;
}

.nav-items {
  display: flex;
  justify-content: space-between;
  margin-left: 16px;
  margin-right: 16px;
  height: 45px;
}

.nav-buttons {
  display: flex;
  flex-direction: row;
}

.hidden-icon {
  display: none;
}

.exit {
  display: flex;
  flex-direction: row;
  position: relative;
  justify-content: right;
  right: 10px;
  top: 10px;
  cursor: pointer;
  margin: 10px;
}

a.button.login, a.button.headerbutton {
  z-index: 2;
  width: fit-content;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 12px;
  color: var(--white);
  white-space: nowrap;
  letter-spacing: 2%;
  margin-right: 12px;
  cursor: pointer;
  transition: none;
  padding: 5px 10px;
  height: 32px;
  margin-left: auto;
  font-weight: 500;
  font-size: 16px;
}

a.button.chatbutton,
a.button.imagebutton {
  background: var(--clear);
  border: none;
  color: var(--white);
  font-weight: bold;
  letter-spacing: 2%;
  margin-right: 12px;
  transition: background 0.4s ease;
  cursor: pointer;
  backdrop-filter: blur(10px);
  z-index: 2;
}

a.button.chatbutton,
a.button.imagebutton {
  display: flex;
  flex-direction: row;
  width: 240px;
  margin-right: 0px;
  justify-content: space-around;
  cursor: pointer;
  backdrop-filter: blur(10px);
  z-index: 2;
}

a.button.chatbutton:hover {
  background: var(--purple);
}
a.button.imagebutton:hover {
  background: var(--pink);
}

a.button.menu {
  background: none;
  border: none;
  width: 24px;
  padding: 0px;
  cursor: pointer;
}

.menu-icon {
    font-size: 30px;
    font-weight: bold;
    cursor: pointer;
    vertical-align: middle;
}

.dropbtn {
    color: white;
    border-radius: 10px;
    cursor: pointer;
    background: transparent;
    border: none;
    margin: auto;
}

#userIconDrop {
  display: none;
}

.usericon {
  width: 75px;
  height: 75px;
  border-radius: 12px;
  margin: auto 24px 12px 0px;
  object-fit: cover;
}

.nav-profile-section {
  display: flex;
  flex-direction: row;
  cursor: pointer;
  justify-content: center;
  padding-right: 20px;
}

.nav-usernames {
  gap: 6px;
  margin-bottom: 3px;
  margin-bottom: 6px;
}

.nav-profilename {
  margin: auto;
  margin-bottom: 0px;
  white-space: normal;
}

.nav-username {
  margin: auto;
  margin-top: 0px;
  white-space: normal;
  max-width: 170px;
  overflow-wrap: break-word;
  word-wrap: normal;
  word-break: break-word;
  font-size: 13px;
}

.nav-profile-button {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: #8f37ff;
  border: none;
  width: 77%;
  font-family: inherit;
  color: var(--white);
  white-space: nowrap;
  letter-spacing: 2%;
  margin: auto;
  padding: 12px;
  margin-top: 0px;
  transition: background 0.2s ease;
  cursor: pointer;
  border-radius: 12px;
  font-size: 18px;
}

.profile-button:hover {
  background: var(--pink);
}

#navProfileSection{
  display: none;
}

#navProfileButton{
  display: none;
}

.pages {
  margin-bottom: 12px;
}

.menu-options {
  font-size: 18px;
  font-style: normal;
  font-weight: 400;
  line-height: 52px;
  padding: 2px 0px;
}

.pages a {
  display: flex;
  flex-direction: column;
  justify-content: space-around;
  color: white;
  text-decoration: none;
  width: 77%;
  margin: auto;
  margin: 0px 10px;
  padding: 0 0 0 46px;
}

.pages a:hover {
  background-color: var(--clear);
  border-radius: 12px;
  width: auto;
}

.settings,
.logout {
  display: flex;
  flex-direction: row;
  gap: 16px;
  align-items: center;
  margin: 4px 4px 0 16px;
  background: none;
  border: none;
  height: 52px;
  font-size: 18px;
  font-family: inherit;
  color: white;
  cursor: pointer;
  width: 95%;
}

.logout {
  width: auto;
  padding: 0px 0px 0px 40px;
}

.menu-border {
  border: 1px solid rgba(255, 255, 255, 0.13);
  width: 100%;
  height: auto;
}


@media screen and (max-width: 1040px) {
  a.button.mathai {  /* Math AI disappears first */
    display: none;
  }
}

@media screen and (max-width: 980px) {
  a.button.audiogenerator { /* AI Music disappears second */
    display: none;
  }
}

@media screen and (max-width: 890px) {
  a.button.voicechat { /* Voice chat disappears third */
    display: none;
  }
}

@media screen and (max-width: 710px) {
  a.button.photoeditor { /* AI Photo Editor disappears fourth */
    display: none;
  }
}

@media screen and (max-width: 620px) {
    .hero h1 {
        font-size: 76px;
    }
    .titlesparkle {
        top: -55px;
        height: 34%;
        margin-left: -60px;
    }
}

@media screen and (max-width: 560px) {
  a.button.videogenerator {
    display: none;
  }
}

@media screen and (max-width: 500px) {
  .nav-buttons {
    justify-content: space-between;
    width: 100%;
  }
  a.button.login,  a.button.headerbutton {
    font-size: 16px;
    margin-right: 8px;
  }
  a.button.login {
    display: none;
  }

}

@media screen and (max-width: 420px) {
    .hero h1 {
        font-size: 56px;
    }
    .titlesparkle {
        top: -40px;
        margin-left: -55px;
    }
    a.button.headerbutton {
      font-size: 13px;
      margin-right: 6px;
    }
}

@media screen and (max-width: 345px) {
    .hero h1 {
        font-size: 48px;
    }
    .titlesparkle {
        top: -40px;
        margin-left: -52px;
    }
    a.button.headerbutton {
      font-size: 12px;
      margin-right: 2px;
      padding: 5px 5px;
    }
}

@media screen and (max-width: 300px) {
  .nav-buttons {
    justify-content: flex-end;
    width: 100%;
  }
  a.button.videogenerator, a.button.videogenerator { /* Note: Duplicate selector here, might want to clean up */
    display: none;
  }
  a.button.aichat {
      font-size: 14px;
  }
}


</style>

<div class="nav-items">
    <a class="logo-link" href="/">
      <svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.4781 27.6456V24.5259H10.5015V27.5763H13.4781V27.6456Z" fill="white"/>
        <path d="M33.9079 25.8433C33.8402 26.1899 33.7049 26.6058 33.5696 26.9525C33.5696 27.0218 33.502 27.0911 33.502 27.1605C33.2314 27.8537 32.8931 28.4777 32.5549 29.1016C32.2166 29.5869 31.8784 30.0722 31.5401 30.4881C31.3372 30.6961 31.2019 30.9041 30.9989 31.1121L31.0666 31.0428C30.796 31.3201 30.5254 31.5974 30.1871 31.8747C30.0518 32.0133 29.8489 32.0827 29.7136 32.2213C29.6459 32.2213 29.5783 32.2906 29.5783 32.2906C29.1724 32.5679 28.7665 32.7759 28.2929 32.9839C27.7517 33.2612 27.1429 33.4692 26.534 33.6078C25.9252 33.7465 25.2487 33.8851 24.6398 33.9545C23.8957 34.0238 23.1515 34.0238 22.3397 33.8851C18.8895 33.3999 15.9806 31.3894 14.2217 28.6163C14.6276 29.1016 15.0335 29.5176 15.507 29.8642C16.3188 30.4881 17.2659 30.9734 18.3483 31.1814C18.8219 31.3201 19.3631 31.3201 19.8366 31.3201C19.9719 31.3201 20.1072 31.3201 20.2425 31.3201C20.9867 31.3201 21.7309 31.1814 22.4074 30.9041C22.5427 30.8348 22.6103 30.8348 22.7456 30.7654C22.9486 30.6961 23.2192 30.5575 23.4221 30.4881C23.4898 30.4881 23.4898 30.4188 23.5574 30.4188C25.6546 29.2403 27.2105 27.1605 27.4811 24.526C27.5488 24.0408 27.5488 23.4861 27.5488 23.0009C29.443 23.0009 30.9989 24.1794 31.8107 25.7739C31.8784 25.9819 31.946 26.1899 32.0137 26.3979C32.0137 26.2592 32.0137 26.1899 32.0137 26.0512C32.0137 25.4966 31.946 25.0113 31.8784 24.4567C31.2019 20.7824 28.0223 18.0787 24.2339 18.0787C23.7604 18.0787 23.3545 18.148 22.8809 18.2173C22.8809 18.2173 22.8809 18.2173 22.8133 18.2173C21.4603 18.4253 20.5132 18.8413 19.0248 19.9505C18.416 20.3665 17.1983 21.4757 16.2512 22.3769C15.7776 22.8622 14.9658 22.3769 15.1011 21.6837C15.2364 21.0597 15.4394 20.3665 15.8453 19.6039C13.9511 16.9001 13.9511 13.9884 17.6718 11.4233C19.8366 9.89813 23.4221 9.48217 26.737 10.7301C28.7665 9.62083 31.6754 9.5515 34.3138 12.4632C34.5844 12.7405 34.3814 13.2258 33.9755 13.2258C33.2314 13.2258 32.2166 13.4338 31.4048 14.0577C31.4725 14.1271 31.5401 14.2657 31.6754 14.4044C34.855 18.7026 34.7873 22.7236 33.9079 25.8433Z" fill="white"/>
      </svg>
      <P style="display: none;">DeepAI</P>
    </a>
    <div class="nav-buttons">
        <a class="button headerbutton aichat" href="/chat">Chat</a>
        <a class="button headerbutton imagegenerator" href="/machine-learning-model/text2img">Image Generator</a>
        <a class="button headerbutton videogenerator" href="/video">Video</a>
        <a class="button headerbutton audiogenerator" href="/music">Music</a>
        <a class="button headerbutton voicechat" href="/voice">Voice Chat</a>
        <a class="button headerbutton photoeditor" href="/machine-learning-model/image-editor">Photo Editor</a>

        <a class="button login" id="headerLoginButton" onclick="openLogin()">Login</a>
        <nav>
            <ul>
                <li class="dropdown">
                    <button class="drop-menu-button" id="dropMenuButton">
                        <img src="/static/images/HiUser.svg" class="menu-icon dropbtn" id="userIconDrop" loading="lazy"/>
                        <img src="/static/images/IoMenu.svg" class="menu-icon dropbtn" id="sandwichIconDrop" loading="lazy"/>
                    </button>
                    <ul id="mainNavDropdown">
                        <div class="exit">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                          >
                            <path
                              d="M11.9997 10.586L16.9497 5.63599L18.3637 7.04999L13.4137 12L18.3637 16.95L16.9497 18.364L11.9997 13.414L7.04974 18.364L5.63574 16.95L10.5857 12L5.63574 7.04999L7.04974 5.63599L11.9997 10.586Z"
                              fill="white"
                            />
                          </svg>
                        </div>
                        <div id="navProfileSection" class="nav-profile-section">
                          <img class="usericon" id="navUserAvatar" alt="avatar" loading="lazy" onclick="window.location.replace('/dashboard/profile')" src="/static/images/dolphin-icon.jpeg" />
                          <div class="nav-usernames">
                            <p class="nav-profilename" id="navUserName"></p>
                            <p class="nav-username" id="navUserEmail"></p>
                          </div>
                        </div>
                        <button id="navProfileButton" class="button nav-profile-button" onclick="window.location.replace('/dashboard/profile')">Account Settings</button>
                        <div class="menu-options">
                          <div class="pages">
                            <a href="/machine-learning-model/text2img" class="ai-generators">Image Generator</a>
                            <a href="/video" class="ai-generators">Video Generator</a>
                            <a href="/music" class="ai-generators">Music Generator</a>
                            <a href="/chat" class="ai-generators">Chat</a>
                            <a href="/machine-learning-model/image-editor" class="ai-generators">Photo Editor</a>
                            <a href="/pricing" class="pricing">Pricing</a>
                            <a href="/definitions" class="glossary">Glossary</a>
                            <a href="/docs" class="apidocs">Docs</a>
                            <a href="#" onclick="openPrivacyModal(); return false;" class="privacy-choices">Your Privacy Choices <img src="/static/images/privacy-choices-icon.svg" alt="" style="height: 1em; vertical-align: -1px; margin-left: 4px;" /></a>
                            <a href="/privacy-policy" class="privacy-policy" target="_blank">Privacy Policy</a>
                          </div>
                          <div class="menu-settings">
                            <div class="menu-border"></div>
                            <button id="login-button-dropdown" onclick="openSignup()" class="logout">
                              Login
                            </button>
                          </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</div>

        </header>
        <div id="announcement-banner" class="announcement-banner">
            <a href="javascript:void(0);" onclick="openSubscription();" class="pro-link-button">
                <div class="banner-text">
                    <span class="main-text">DeepAI Pro - More Access to Better AI</span>
                </div>
            </a>
            <button id="dismiss-banner" class="dismiss-button" aria-label="Dismiss announcement"></button>
        </div>
        <script>
            // Immediately decide banner visibility to prevent CLS
            (function() {
                const banner = document.getElementById('announcement-banner');
                const bannerKey = 'proBannerDismissed';
                const dismissedData = localStorage.getItem(bannerKey);
                const pathname = window.location.pathname;

                // Check cached user object for Pro status
                let userHasPro = false;
                try {
                    const cachedUser = localStorage.getItem('user');
                    if (cachedUser) {
                        const user = JSON.parse(cachedUser);
                        userHasPro = user?.userprofile2?.user_has_deepai_pro || false;
                    }
                } catch (e) {}

                // Don't show if user has Pro or on specific pages
                if (userHasPro || pathname.includes('dashboard/') || pathname.includes('chat') || pathname.includes('/video')) {
                    return;
                }

                // Check dismissal status
                if (dismissedData) {
                    try {
                        const dismissedDate = new Date(JSON.parse(dismissedData).date);
                        const daysSinceDismissal = Math.floor((Date.now() - dismissedDate) / (1000 * 60 * 60 * 24));
                        if (daysSinceDismissal < 5) {
                            return;
                        }
                    } catch (e) {}
                }

                // Show the banner
                banner.style.display = 'inline-flex';
            })();
        </script>
        
        


<script async src="/static/js/marked.js"></script>
<script async src="/static/js/marked-highlight.js"></script>
<script async src="/static/js/highlight.js"></script>
<script async src="/static/js/maquette.js"></script>
<script async src="/static/js/katex.js"></script>
<script>
  function loadCSS(href) {
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    document.head.appendChild(link);
  }

  document.addEventListener('DOMContentLoaded', function() {
    loadCSS("/static/js/sunburst.css");
    loadCSS("/static/js/katex.css");
  });

</script>

<div class="chat-layout-container sidebar-closed" id="layoutContainer">

  <!-- Chat History Button (top left) -->
  <div class="sidebar-toggle-container">
    <button class="sidebar-toggle" id="sidebarToggle">
      <img src="/static/images/history.svg" alt="history" class="history-icon"/>
      <svg class="close-icon" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 3.5L7 11L14 18.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="toggle-text">Chat History</span>
    </button>
  </div>

  <!-- New Chat Button (top-right) -->
  <div class="new-chat-button-container">
    <a href="" class="new-chat-button">
      <svg class="plus-icon" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11 3.5L11 18.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M3.5 11L18.5 11" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="toggle-text">New Chat</span>
    </a>
  </div>

  <!-- Sidebar -->
  <aside class="chat-sidebar" id="chatSidebar">
    <!-- Sidebar header with label (only visible when open) -->
    <div class="sidebar-header">
      <span class="sidebar-label">Chat History</span>
    </div>

    <!-- Search input -->
    <div class="chat-history-search-container">
      <div class="chat-history-search-wrapper">
        <input type="text"
               class="chat-history-search-input"
               id="chatHistorySearchInput"
               placeholder="Search chats..."
               autocomplete="off"
               spellcheck="false">
        <div class="chat-history-search-icon"
             id="chatHistorySearchIcon">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="6.5" cy="6.5" r="5.5" stroke="currentColor" stroke-width="2"/>
            <path d="M10.5 10.5L14 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <button class="chat-history-search-clear"
                id="chatHistorySearchClear"
                style="display: none;"
                aria-label="Clear search">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="chat-history-search-status" id="chatHistorySearchStatus"></div>
    </div>

    <!-- Scrollable wrapper that extends full height -->
    <div class="sidebar-scroll-wrapper">
      <!-- Scrollable content -->
      <div class="sidebar-content">
        <div class="chat-history-items" id="chatHistoryList">
          <!-- Chat items go here -->
        </div>
      </div>
    </div>

    <div class="sidebar-ad">
      <div id="permanent-announcement-banner" class="permanent-announcement-banner sidebar-perm-ad">
        <a href="javascript:void(0);" onclick="openSubscription();" class="pro-link-button">
            <div class="perm-banner-text">
                <span class="main-text">Upgrade to DeepAI Pro</span>
                <span class="sub-text sub-perm-text">More access to the best AI</span>
            </div>
        </a>
      </div>
    </div>

    <!-- Footer (if needed) -->
    <div class="sidebar-footer">
      <button class="delete-all-history-button">Delete Chat History</button>
    </div>
  </aside>


  <!-- Overlay for mobile mode -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- MAIN CONTENT AREA -->
    <main class="chat-main" id="chatMain">

      

      <h1>AI Chat</h1>

      <h3>AI Chat is an AI chatbot that writes text. You can use it to write stories, messages, or programming code.</h3>
      
      <!-- AI Disclaimer -->
      <div class="ai-disclaimer">
        AI Chat can make mistakes. By messaging AI Chat, you agree to our <a href="/terms-of-service/terms-of-service" target="_blank">Terms of Service</a>, and acknowledge our <a href="/privacy-policy" target="_blank">Privacy Policy</a>.
      </div>

    <div id="copypopup">
      <span class="message">Copied!</span>
    </div>
    <div id="upload-successful">
      <span class="message">Upload Successful!</span>
    </div>
    <div id="upload-too-many">
      <span class="message">You can attach up to 10 images per message. Please remove any extra images and try again.</span>
    </div>
    <div id="bad-file-type">
      <span class="message">This file type is not supported. Please try again.</span>
    </div>
    <div id="big-file-type">
      <span class="message">This file exceeds the maximum file size of 20MB. Please select smaller files and try again.</span>
    </div>
    <div id="upload-unsuccessful">
      <span class="message">Upload Unsuccessful. Please try again.</span>
    </div>
    <div id="summarypopup">
      <span class="message">Summarizing!</span>
    </div>
    <div id="errorpopup">
      <img class="errorIcon" src="/static/images/error-icon.svg" alt="Error Icon" />
      <span class="message">An error has occurred</span>
    </div>
    <!-- Persistent Compose Area -->
    <div class="persistent-compose-area">
      <!-- Attachments container (hidden when empty) -->
      <div class="chat-attachments-container" id="chatAttachmentsContainer"></div>

      <!-- Hidden file input (triggered by attach button) -->
      <input type="file" id="chatAttachmentInput" multiple accept="image/*,.pdf,.txt,.csv,.md,.json,.docx,.xlsx,.pptx" style="display:none;position:absolute;width:0;height:0;overflow:hidden;opacity:0;pointer-events:none;">

      <textarea class="chatbox" id="persistentChatbox" placeholder="Message AI Chat..." rows="1"></textarea>
      <div class="response-length-options">
        <div class="button-container">
          <div style="display: block">
            <div class="chat-mode-section">
              <div class="chat-mode-dropdown-container">
                <!-- Dropdown trigger -->
                <button
                  id="chatModeDropdownButton"
                  class="chat-mode-dropdown-trigger"
                  type="button"
                >
                  <span id="currentChatModeLabel">Standard</span>
                  <!-- The arrow (caret)  we rotate it when .open is on the button -->
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    class="dropdown-caret"
                  >
                    <path
                      d="M7 10L12 15L17 10"
                      stroke="white"
                      stroke-width="2.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      fill="none"
                    />
                  </svg>
                </button>

                <!-- The floating menu (hidden by default) -->
                <div id="chatModeMenu" class="chat-mode-dropdown-menu" style="display:none;">
                  <!-- Well build these items in JS -->
                </div>
              </div>
            </div>
          </div>
          <button id="attachFileButton" title="Attach File" type="button">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21.44 11.05L12.25 20.24C11.1242 21.3658 9.59723 21.9983 8.005 21.9983C6.41277 21.9983 4.88584 21.3658 3.76 20.24C2.63416 19.1142 2.00166 17.5872 2.00166 15.995C2.00166 14.4028 2.63416 12.8758 3.76 11.75L12.33 3.18C13.0806 2.42975 14.0991 2.00129 15.1608 2.00129C16.2226 2.00129 17.2411 2.42975 17.9917 3.18C18.7419 3.93063 19.1704 4.94913 19.1704 6.01087C19.1704 7.07261 18.7419 8.09112 17.9917 8.84175L9.41 17.42C9.03469 17.7953 8.52544 18.0058 7.995 18.0058C7.46456 18.0058 6.95531 17.7953 6.58 17.42C6.20469 17.0447 5.99422 16.5354 5.99422 16.005C5.99422 15.4746 6.20469 14.9653 6.58 14.59L15.07 6.1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button id="recordButton" title="Speech To Text">
            <img src="/static/images/mic.svg" alt="Mic Icon" class="mic-icon">
          </button>
          <button id="chatSubmitButton" type="button" onclick="chatSubmit('', '', true)">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 3.5L11 18.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5 9.5L11 3.5L17 9.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <button id="chatStopButton" type="button" onclick="chatStop()">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="5" y="5" width="12" height="12" rx="2" fill="white"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <!--  <input type="radio" style="position: absolute; appearance: none; -webkit-appearance: none; opacity: 0;" id="short" name="responseLength" value="short" checked>-->
    <!--  <label for="short">Short</label>-->
    <!--  <input type="radio" style="position: absolute; appearance: none; -webkit-appearance: none; opacity: 0;" id="medium" name="responseLength" value="medium">-->
    <!--  <label for="medium">Medium</label>-->
    <!--  <input type="radio" style="position: absolute; appearance: none; -webkit-appearance: none; opacity: 0;" id="long" name="responseLength" value="long">-->
    <!--  <label for="long">Long</label>-->
    <!--  <input type="radio" style="position: absolute; appearance: none; -webkit-appearance: none; opacity: 0;" id="auto" name="responseLength" value="auto">-->
    <!--  <label for="auto">Auto</label>-->

    <!--  Checkbox to enable genius mode -->

    
      <div class="explore-aichat-modes">
        <div class="chat-chips-container">
          <a href="/characters" class="chat-chip" id="characters-link" style="display:none;">Chat with AI Characters!</a>

          <!-- New model selector buttons -->
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="online">
            <span>Online</span>
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="genius" data-locked="true">
            <span>Genius</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="supergenius" data-locked="true">
            <span>Super Genius</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="onlinegenius" data-locked="true">
            <span>Online Genius</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="deepseek-v3.2">
            <span>DeepSeek V3.2</span>
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="gemini-2.5-flash-lite">
            <span>Gemini 2.5 Flash Lite</span>
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="gemini-3-pro-preview" data-locked="true">
            <span>Gemini 3 Pro</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="claude-4.5-opus" data-locked="true">
            <span>Claude 4.5 Opus</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="chatgpt-4o-latest" data-locked="true">
            <span>ChatGPT 4o</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="grok-4" data-locked="true">
            <span>Grok 4</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>
          <a href="javascript:void(0)" class="chat-chip chat-model-chip" data-model="gpt-5.2" data-locked="true">
            <span>GPT-5.2</span>
            <img src="/static/images/lock-icon.png" class="lock-icon" alt="Pro" style="width: 12px; height: 12px; opacity: 0.6; position: static; transform: none; border: none; padding: 0; pointer-events: auto;">
          </a>

          <!-- Chat Presets (initially hidden) -->
          <a href="/chat/text-generator" class="chat-chip chat-preset-chip" style="display:none;">AI Text Generator</a>
          <a href="/chat/poet" class="chat-chip chat-preset-chip" style="display:none;">AI Poem Generator</a>
          <a href="/chat/storyteller" class="chat-chip chat-preset-chip" style="display:none;">AI Storyteller</a>
          <a href="/chat/chatgpt-alternative" class="chat-chip chat-preset-chip" style="display:none;">ChatGPT Alternative</a>
          <a href="/chat/gpt-chat" class="chat-chip chat-preset-chip" style="display:none;">GPT Chat</a>
          <a href="/chat/ai-code" class="chat-chip chat-preset-chip" style="display:none;">AI Code</a>
          <a href="/chat/relationships" class="chat-chip chat-preset-chip" style="display:none;">AI Relationship Coach</a>
          <a href="/chat/debate" class="chat-chip chat-preset-chip" style="display:none;">AI Debate</a>
          <a href="/chat/drunk" class="chat-chip chat-preset-chip" style="display:none;">AI Drunk Friend</a>
          <a href="/chat/translate" class="chat-chip chat-preset-chip" style="display:none;">Translate</a>
          <a href="/chat/comedian" class="chat-chip chat-preset-chip" style="display:none;">AI Comedian</a>
          <a href="/chat/proofreader" class="chat-chip chat-preset-chip" style="display:none;">AI Proofreader</a>
          <a href="/chat/movie" class="chat-chip chat-preset-chip" style="display:none;">AI Movie Critic</a>
          <a href="/chat/philosophy" class="chat-chip chat-preset-chip" style="display:none;">AI Philosophy Teacher</a>
          <a href="/chat/writer" class="chat-chip chat-preset-chip" style="display:none;">AI Writer</a>
          <a href="/chat/novelist" class="chat-chip chat-preset-chip" style="display:none;">AI Novelist</a>

          <!-- Chat Presets toggle button -->
          <a href="javascript:void(0)" class="chat-chip" id="chat-presets-toggle" onclick="toggleChatPresets()">Chat Presets</a>
        </div>
      </div>
    
    
    <!-- Messages get inserted here -->
    <form id="convo" onsubmit="return false;">
    </form>

    <!-- Scroll to Bottom Button -->
    <button id="scrollToBottomButton" class="scroll-to-bottom-btn" style="display: none;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7 10L12 15L17 10" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </main><!-- .chat-main -->
</div><!-- .chat-layout-container -->

<!-- Confirm Modal Root -->
<div id="confirm-modal-root" class="modal-root">
  <div id="confirm-modal" class="modal">
    <div id="confirm-title" class="title">Deleting a Character</div>
    <div id="confirm-desc" class="confirm-desc">
      Are you sure you want to delete this character?<br/>
      This action cannot be undone.
    </div>

    <!-- Only shown if user must type in text -->
    <input
      type="text"
      id="confirm-input"
      class="confirm-input"
      placeholder="Type here to confirm..."
      style="display: none;"
    />

    <div class="modal-button-container">
      <button id="confirm-yes-btn" class="confirm-button">
        Delete
      </button>
      <button id="confirm-cancel-btn" class="confirm-button">
        Cancel
      </button>
    </div>
  </div>
</div>


        <dialog id="login-modal" class="login-container">
            <div id="close-login" type="button" class="login-exit">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                >
                  <path
                    d="M11.9997 10.586L16.9497 5.63599L18.3637 7.04999L13.4137 12L18.3637 16.95L16.9497 18.364L11.9997 13.414L7.04974 18.364L5.63574 16.95L10.5857 12L5.63574 7.04999L7.04974 5.63599L11.9997 10.586Z"
                    fill="white"
                  />
                </svg>
            </div>
            <div style="width: 95%;">
                <h2 class="login-header" id="login-header-title">Login</h2>
                <p class="please-subheader">
                    Please sign up or login with your details
                </p>
                <div class="options-container">
                    <div class="option login-active active" id='loginToggle' onclick="toggleAuthOption('login')">
                    Login
                    </div>
                    <div class="option signup" id='signupToggle' onclick="toggleAuthOption('signup')">
                    Sign up
                    </div>
                </div>
                <button class="signin-with-google" id="social-auth-google" onclick="social_login(event, 'google')">
                    <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path
                        d="M32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C24.8366 32 32 24.8366 32 16Z"
                        fill="white"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M23.8299 16.1823C23.8299 15.615 23.779 15.0695 23.6845 14.5459H16.1499V17.6405H20.4554C20.2699 18.6405 19.7063 19.4877 18.859 20.055V22.0623H21.4445C22.9572 20.6695 23.8299 18.6186 23.8299 16.1823Z"
                        fill="#4285F4"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M16.1496 23.9995C18.3096 23.9995 20.1205 23.2832 21.4442 22.0614L18.8587 20.0541C18.1423 20.5341 17.226 20.8177 16.1496 20.8177C14.066 20.8177 12.3023 19.4104 11.6732 17.5195H9.00049V19.5923C10.3169 22.2068 13.0223 23.9995 16.1496 23.9995Z"
                        fill="#34A853"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M11.6735 17.52C11.5135 17.04 11.4226 16.5272 11.4226 16C11.4226 15.4727 11.5135 14.96 11.6735 14.48V12.4072H9.00081C8.45899 13.4872 8.1499 14.709 8.1499 16C8.1499 17.2909 8.45899 18.5127 9.00081 19.5927L11.6735 17.52Z"
                        fill="#FBBC05"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M16.1496 11.1818C17.3241 11.1818 18.3787 11.5855 19.2078 12.3782L21.5023 10.0836C20.1169 8.79273 18.306 8 16.1496 8C13.0223 8 10.3169 9.79273 9.00049 12.4073L11.6732 14.48C12.3023 12.5891 14.066 11.1818 16.1496 11.1818Z"
                        fill="#EA4335"
                    />
                    </svg>
                    Continue with Google
                </button>

                <div class="email-container" id="email-container-id">
                    <svg
                      class="email-icon"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M22 6C22 4.9 21.1 4 20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6ZM20 6L12 11L4 6H20ZM20 18H4V8L12 13L20 8V18Z"
                        fill="#7D7D7D"
                      />
                    </svg>

                    <input
                      class="input-email"
                      id="user-email"
                      type="text"
                      placeholder="Enter valid email address"
                      name="email"
                      onkeypress="authKeyPressHandler(event)"
                    />
                </div>
                <div class="password-container" id="password-container-id">
                    <svg
                      class="lock-icon"
                      xmlns="http://www.w3.org/2000/svg"
                      width="27"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M12 17C13.1 17 14 16.1 14 15C14 13.9 13.1 13 12 13C10.9 13 10 13.9 10 15C10 16.1 10.9 17 12 17ZM18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM8.9 6C8.9 4.29 10.29 2.9 12 2.9C13.71 2.9 15.1 4.29 15.1 6V8H8.9V6ZM18 20H6V10H18V20Z"
                        fill="#7D7D7D"
                      />
                    </svg>

                    <input
                      class="input-password"
                      id="user-password"
                      type="password"
                      placeholder="Enter your password"
                      name="password"
                      onkeypress="authKeyPressHandler(event)"
                    />
                </div>
                <div class="reenter-password-container" id="reenter-password-container-id">
                    <svg
                      class="lock-icon"
                      xmlns="http://www.w3.org/2000/svg"
                      width="27"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <path
                        d="M12 17C13.1 17 14 16.1 14 15C14 13.9 13.1 13 12 13C10.9 13 10 13.9 10 15C10 16.1 10.9 17 12 17ZM18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM8.9 6C8.9 4.29 10.29 2.9 12 2.9C13.71 2.9 15.1 4.29 15.1 6V8H8.9V6ZM18 20H6V10H18V20Z"
                        fill="#7D7D7D"
                      />
                    </svg>

                    <input
                      class="input-password"
                      id="confirm-user-password"
                      type="password"
                      placeholder="Re-enter your password"
                      name="password"
                    />
                      <path
                        d="M10.125 10.5C10.0757 10.5001 10.0269 10.4905 9.98145 10.4716C9.93595 10.4527 9.89464 10.425 9.8599 10.3901L1.6099 2.14013C1.54254 2.06923 1.50555 1.97482 1.5068 1.87704C1.50805 1.77925 1.54745 1.68582 1.6166 1.61667C1.68575 1.54752 1.77918 1.50812 1.87697 1.50687C1.97475 1.50561 2.06916 1.54261 2.14006 1.60997L10.3901 9.85997C10.4425 9.91241 10.4782 9.97922 10.4926 10.0519C10.5071 10.1247 10.4996 10.2 10.4713 10.2685C10.4429 10.337 10.3949 10.3956 10.3332 10.4368C10.2716 10.478 10.1991 10.5 10.125 10.5V10.5ZM5.99201 9.00005C5.01959 9.00005 4.08185 8.71223 3.20482 8.14458C2.40631 7.62895 1.68748 6.89044 1.12592 6.01177V6.00989C1.59326 5.34028 2.10514 4.77403 2.65498 4.31747C2.65995 4.31331 2.66401 4.30817 2.66689 4.30236C2.66978 4.29655 2.67143 4.29021 2.67174 4.28374C2.67204 4.27726 2.67101 4.27079 2.66869 4.26474C2.66637 4.25868 2.66282 4.25317 2.65826 4.24856L2.19139 3.78239C2.18309 3.77403 2.17195 3.76909 2.16018 3.76857C2.14841 3.76805 2.13687 3.77198 2.12787 3.77958C1.54381 4.27177 1.0017 4.87552 0.508807 5.58239C0.424007 5.7041 0.377304 5.84828 0.374633 5.99659C0.371962 6.14491 0.413444 6.29067 0.493807 6.41536C1.11279 7.38403 1.90943 8.19989 2.79724 8.77434C3.79685 9.42192 4.87264 9.75005 5.99201 9.75005C6.59622 9.74817 7.19615 9.64861 7.76857 9.4552C7.77612 9.45264 7.7829 9.4482 7.78825 9.44229C7.79361 9.43638 7.79737 9.4292 7.79917 9.42143C7.80098 9.41367 7.80077 9.40557 7.79858 9.3979C7.79638 9.39024 7.79227 9.38326 7.78662 9.37763L7.28084 8.87184C7.2692 8.86049 7.2548 8.85235 7.23906 8.84824C7.22332 8.84413 7.20678 8.84419 7.19107 8.84841C6.79937 8.94927 6.39649 9.00022 5.99201 9.00005V9.00005ZM11.504 5.59223C10.8839 4.63317 10.0793 3.81848 9.1774 3.23606C8.17967 2.59106 7.0781 2.25005 5.99201 2.25005C5.39421 2.25111 4.80084 2.35276 4.23678 2.55075C4.22926 2.55337 4.22253 2.55785 4.21723 2.56378C4.21193 2.56972 4.20822 2.5769 4.20647 2.58466C4.20471 2.59242 4.20495 2.6005 4.20718 2.60814C4.20941 2.61578 4.21354 2.62273 4.2192 2.62833L4.72428 3.13341C4.73603 3.14496 4.75063 3.15322 4.7666 3.15733C4.78256 3.16145 4.79933 3.16128 4.81521 3.15684C5.19888 3.05306 5.59456 3.00034 5.99201 3.00005C6.94568 3.00005 7.8806 3.29138 8.77053 3.86723C9.58404 4.39223 10.3113 5.13005 10.8743 6.00005C10.8747 6.00058 10.8749 6.00124 10.8749 6.00192C10.8749 6.0026 10.8747 6.00326 10.8743 6.0038C10.4656 6.64714 9.95851 7.22234 9.37146 7.70841C9.36644 7.71255 9.36233 7.71769 9.3594 7.72351C9.35647 7.72933 9.35479 7.7357 9.35446 7.7422C9.35413 7.74871 9.35516 7.75521 9.35748 7.7613C9.3598 7.76738 9.36337 7.77292 9.36795 7.77755L9.83435 8.24372C9.84261 8.25205 9.85369 8.25699 9.8654 8.25755C9.87712 8.25812 9.88862 8.25427 9.89764 8.24677C10.5244 7.71907 11.0669 7.0988 11.5064 6.40739C11.5841 6.28555 11.6252 6.14397 11.6247 5.99947C11.6243 5.85497 11.5824 5.71363 11.504 5.59223V5.59223Z"
                        fill="#7D7D7D"
                      />
                      <path
                        d="M5.99999 3.75C5.83145 3.74991 5.66344 3.76878 5.49913 3.80625C5.49083 3.80797 5.48315 3.81192 5.47691 3.81766C5.47068 3.8234 5.46611 3.83072 5.46371 3.83885C5.4613 3.84698 5.46115 3.8556 5.46326 3.86381C5.46537 3.87202 5.46966 3.87951 5.47569 3.88547L8.11452 6.52359C8.12048 6.52962 8.12796 6.53392 8.13617 6.53603C8.14438 6.53814 8.15301 6.53798 8.16114 6.53558C8.16927 6.53317 8.17659 6.52861 8.18233 6.52237C8.18807 6.51613 8.19201 6.50846 8.19374 6.50016C8.26887 6.17063 8.26879 5.82842 8.19353 5.49893C8.11826 5.16944 7.96973 4.86114 7.75897 4.59692C7.54821 4.33271 7.28064 4.11937 6.97612 3.97275C6.6716 3.82613 6.33796 3.74999 5.99999 3.75V3.75ZM3.88545 5.47641C3.87949 5.47038 3.87201 5.46608 3.8638 5.46397C3.85559 5.46186 3.84696 5.46202 3.83883 5.46443C3.83071 5.46683 3.82338 5.47139 3.81764 5.47763C3.8119 5.48387 3.80796 5.49154 3.80624 5.49984C3.72124 5.87118 3.73191 6.25801 3.83725 6.62409C3.9426 6.99017 4.13916 7.32351 4.40852 7.59287C4.67788 7.86223 5.01122 8.0588 5.3773 8.16414C5.74338 8.26948 6.13022 8.28015 6.50155 8.19516C6.50985 8.19343 6.51753 8.18949 6.52376 8.18375C6.53 8.17801 6.53456 8.17069 6.53697 8.16256C6.53937 8.15443 6.53953 8.1458 6.53742 8.13759C6.53531 8.12938 6.53101 8.1219 6.52499 8.11594L3.88545 5.47641Z"
                        fill="#7D7D7D"
                      />
                    </svg>
                </div>
                <p id="user-email-error"  class="bad-auth-error"></p>
                <button class="button login-with-email" id="switch-to-email" onclick="authOptions('moreOptions')">Or login with email</button>
                <button class="button login-email" id="login-via-email-id" onclick="login(event)">Login</button>
                <a class="forgot-password" id="forgot-password">
                    Forgot password?
                    <span href="javascript:void();" onclick="resetPassword(event)" class="click-here">Click here to reset</span>
                </a>
                <button class="button goback" id="go-back-login" onclick="authOptions('lessOptions')">Go back</button>
            </div>
        </dialog>
<dialog id="subscription-modal">
          <div id="subscription-pro-id" class="modal-small-subscription-container">
                <div class="modal-subscriptions-container">
                  <div class="modal-subscription-title-container">
                    <div class="modal-subscription-title pro-promo-title" id="subscription-title-pro-promo-id">Unlock AI power with&nbsp;</div>
                    <div class="modal-model-title">
                        <div class="modal-subscription-title" id="subscription-title-id">DeepAI</div>
                        <div class="modal-subscription-title pro-title" id="subscription-title-pro-id">PRO</div>
                    </div>
                  </div>
                  <div class="modal-subscription-price">
                      <div class="modal-price" id="subscription-price-id"> $9.99 </div>
                      <div class="modal-subscription-length" id="subscription-length-id">/month</div>
                  </div>
                    <button id="stripe-pro-button-container" class="modal-get-started" onclick="window.open(window.deepaiProLinkUrl, '_blank')">Subscribe</button>
                </div>
                <a class="modal-see-full" href="/pricing" target="_blank">
                    See Full Pricing
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="19"
                      viewBox="0 0 18 19"
                      fill="none"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M3.8248 5.44998C3.64578 5.44998 3.47409 5.52109 3.34751 5.64768C3.22092 5.77427 3.1498 5.94595 3.1498 6.12498V13.775C3.1498 14.1476 3.4522 14.45 3.8248 14.45H11.4748C11.6538 14.45 11.8255 14.3789 11.9521 14.2523C12.0787 14.1257 12.1498 13.954 12.1498 13.775V10.175C12.1498 9.99595 12.2209 9.82427 12.3475 9.69768C12.4741 9.57109 12.6458 9.49998 12.8248 9.49998C13.0038 9.49998 13.1755 9.57109 13.3021 9.69768C13.4287 9.82427 13.4998 9.99595 13.4998 10.175V13.775C13.4998 14.312 13.2865 14.8271 12.9067 15.2069C12.5269 15.5866 12.0119 15.8 11.4748 15.8H3.8248C3.28774 15.8 2.77267 15.5866 2.39291 15.2069C2.01315 14.8271 1.7998 14.312 1.7998 13.775V6.12498C1.7998 5.58791 2.01315 5.07285 2.39291 4.69308C2.77267 4.31332 3.28774 4.09998 3.8248 4.09998H8.3248C8.50383 4.09998 8.67551 4.17109 8.8021 4.29768C8.92869 4.42427 8.9998 4.59595 8.9998 4.77498C8.9998 4.954 8.92869 5.12569 8.8021 5.25227C8.67551 5.37886 8.50383 5.44998 8.3248 5.44998H3.8248Z"
                        fill="#C3CAD9"
                      />
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M5.57465 11.9777C5.63413 12.0436 5.706 12.097 5.78615 12.135C5.8663 12.1731 5.95316 12.1949 6.04176 12.1994C6.13036 12.2038 6.21897 12.1907 6.30252 12.1609C6.38606 12.131 6.4629 12.085 6.52865 12.0254L14.85 4.49605V7.02505C14.85 7.20407 14.9212 7.37576 15.0478 7.50235C15.1743 7.62893 15.346 7.70005 15.525 7.70005C15.7041 7.70005 15.8758 7.62893 16.0023 7.50235C16.1289 7.37576 16.2 7.20407 16.2 7.02505V2.97505C16.2 2.79603 16.1289 2.62434 16.0023 2.49775C15.8758 2.37116 15.7041 2.30005 15.525 2.30005H11.475C11.296 2.30005 11.1243 2.37116 10.9978 2.49775C10.8712 2.62434 10.8 2.79603 10.8 2.97505C10.8 3.15407 10.8712 3.32576 10.9978 3.45235C11.1243 3.57893 11.296 3.65005 11.475 3.65005H13.7727L5.62235 11.0246C5.55653 11.0841 5.50308 11.156 5.46505 11.2361C5.42703 11.3163 5.40517 11.4032 5.40074 11.4918C5.39631 11.5804 5.40939 11.669 5.43923 11.7525C5.46907 11.8361 5.51509 11.912 5.57465 11.9777Z"
                        fill="#C3CAD9"
                      />
                    </svg>
                </a>
                </div>
                <button id="close-sub" class="close" type="button">&times;</button>
            </div>
            </div>
        </dialog>
        <dialog id="out-of-credits-modal">
            <div class="modal-body out-of-credits-modal-body">
                <div id="close-out-of-credits" type="button" class="out-credits-exit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M11.9997 10.586L16.9497 5.63599L18.3637 7.04999L13.4137 12L18.3637 16.95L16.9497 18.364L11.9997 13.414L7.04974 18.364L5.63574 16.95L10.5857 12L5.63574 7.04999L7.04974 5.63599L11.9997 10.586Z" fill="white"/></svg>
                </div>
                <div style="width: 100%;">
                  <h2 class="out-credits-header">Out of credits</h2>
                  <div id="outOfCreditsMessage" class="oc-msg"></div>
                  <div class="oc-section">
                    <div class="dropdown-payment-amount go-dropdown">
                      <div class="dataset">
                        <select id="outOfCreditsAmountSelect" class="dropdown-select dropdown-input-amount" name="chooseAmount">
                          <option value="5" selected>$5.00 USD</option>
                          <option value="10">$10.00 USD</option>
                          <option value="20">$20.00 USD</option>
                          <option value="50">$50.00 USD</option>
                          <option value="100">$100.00 USD</option>
                          <option value="200">$200.00 USD</option>
                          <option value="500">$500.00 USD</option>
                          <option value="1000">$1000.00 USD</option>
                        </select>
                        <svg class="money-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M11.8003 10.9C9.53031 10.31 8.80031 9.7 8.80031 8.75C8.80031 7.66 9.81031 6.9 11.5003 6.9C13.2803 6.9 13.9403 7.75 14.0003 9H16.2103C16.1403 7.28 15.0903 5.7 13.0003 5.19V3H10.0003V5.16C8.06031 5.58 6.50031 6.84 6.50031 8.77C6.50031 11.08 8.41031 12.23 11.2003 12.9C13.7003 13.5 14.2003 14.38 14.2003 15.31C14.2003 16 13.7103 17.1 11.5003 17.1C9.44031 17.1 8.63031 16.18 8.52031 15H6.32031C6.44031 17.19 8.08031 18.42 10.0003 18.83V21H13.0003V18.85C14.9503 18.48 16.5003 17.35 16.5003 15.3C16.5003 12.46 14.0703 11.49 11.8003 10.9Z" fill="#7D7D7D"/></svg>
                        <svg class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.58997L12 13.17L7.41 8.58997L6 9.99997L12 16L18 9.99997L16.59 8.58997Z" fill="white"/></svg>
                      </div>
                    </div>
                    <button id="out-stripe-go-button-container" onclick="creditsCheckoutUrl('outOfCreditsAmountSelect')" class="button modal-get-started">Add Credits</button>
                  </div>
                  <div id="outOfCreditsAutoTopUp" class="oc-auto-topup">
                    <div class="oc-toggle-row">
                      <label class="oc-toggle">
                        <input type="checkbox" id="outOfCreditsAutoTopUpToggle">
                        <span class="oc-toggle-slider"></span>
                        <span class="oc-toggle-label">Enable Auto Top-Up</span>
                      </label>
                    </div>
                    <p class="oc-desc">Automatically add credits when your balance is low. Never run out again!</p>
                  </div>
                </div>
              </div>
        </dialog>

        <!-- Toast notifications -->
        <div id="successpopup">
            <span class="message">Success!</span>
        </div>
        <div id="errorpopup">
            <img class="errorIcon" src="/static/images/error-icon.svg" alt="Error Icon" />
            <span class="message">An error occurred</span>
        </div>

        <dialog id="social-modal">
            <div class="social-modal-body">
                <p class="share-header">Share</p>
                <p class="share-subheader">Share your generations with friends</p>
                <div class="social-container">
                    <div class="social-icon">
                        <div class="icon-container x">
                            <a id="x-link" target="_blank">
                            <img src="/static/images/social-x-icon.svg">

                            </a>
                            <p class="social-name">X</p>
                        </div>
                    <div class="icon-container facebook">
                        <a id="facebook-link" target="_blank">
                        <img src="/static/images/social-facebook-icon.svg">
                        </a>
                        <p class="social-name">Facebook</p>
                    </div>
                    <div class="icon-container linkedin">
                        <a id="linkedin-link" target="_blank">
                        <img src="/static/images/social-linkedin-icon.svg">
                        </a>
                        <p class="social-name">Linkedin</p>
                    </div>
                    <div class="icon-container reddit">
                        <a id="reddit-link" target="_blank">
                        <img src="/static/images/social-reddit-icon.svg">
                        </a>
                        <p class="social-name">Reddit</p>
                    </div>
                    </div>
                    <div class="social-link-copy">
                        <input type="text" id="social-link-input" readonly>
                        <button class="copy-button" onclick="navigator.clipboard.writeText(document.getElementById('social-link-input').value)">
                            <img src="/static/images/social-copy-icon.svg" alt="Copy">
                        </button>
                    </div>
                </div>
            </div>
            <button id="close-social" class="close" type="button">&times;</button>
        </dialog>

        <!-- Nudge Popup HTML (hidden by default) -->
        <div id="nudge-popup" class="nudge-popup">
            <div class="nudge-popup-header">
                <div class="nudge-popup-header-text">
                    <svg
                    width="32"
                    height="32"
                    viewBox="0 0 32 32"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    >
                    <path
                        d="M32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C24.8366 32 32 24.8366 32 16Z"
                        fill="white"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M23.8299 16.1823C23.8299 15.615 23.779 15.0695 23.6845 14.5459H16.1499V17.6405H20.4554C20.2699 18.6405 19.7063 19.4877 18.859 20.055V22.0623H21.4445C22.9572 20.6695 23.8299 18.6186 23.8299 16.1823Z"
                        fill="#4285F4"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M16.1496 23.9995C18.3096 23.9995 20.1205 23.2832 21.4442 22.0614L18.8587 20.0541C18.1423 20.5341 17.226 20.8177 16.1496 20.8177C14.066 20.8177 12.3023 19.4104 11.6732 17.5195H9.00049V19.5923C10.3169 22.2068 13.0223 23.9995 16.1496 23.9995Z"
                        fill="#34A853"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M11.6735 17.52C11.5135 17.04 11.4226 16.5272 11.4226 16C11.4226 15.4727 11.5135 14.96 11.6735 14.48V12.4072H9.00081C8.45899 13.4872 8.1499 14.709 8.1499 16C8.1499 17.2909 8.45899 18.5127 9.00081 19.5927L11.6735 17.52Z"
                        fill="#FBBC05"
                    />
                    <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M16.1496 11.1818C17.3241 11.1818 18.3787 11.5855 19.2078 12.3782L21.5023 10.0836C20.1169 8.79273 18.306 8 16.1496 8C13.0223 8 10.3169 9.79273 9.00049 12.4073L11.6732 14.48C12.3023 12.5891 14.066 11.1818 16.1496 11.1818Z"
                        fill="#EA4335"
                    />
                    </svg>
                    <h2 style="font-size: 17px;">Sign in with Google</h2>
                </div>
            <span class="close-icon" id="close-nudge-popup">&times;</span>
            </div>
            <div class="nudge-popup-body">
            <p style="margin: auto; width: 90%;">Use your Google Account to sign in to DeepAI</p>
            <button class="signin-with-google nudge-signin-button" id="social-auth-google" onclick="social_login(event, 'google')">
                Continue
            </button>
            </div>
        </div>

        <div id="nudge-pro-popup" class="nudge-pro-popup">
            <div class="nudge-popup-header pro-popup-header">
              <span class="close-icon" id="close-nudge-pro-popup">&times;</span>
            </div>
            <div class="nudge-popup-body" style="padding: 0px 25px 20px 25px;">
                <div class="nudge-pro-body-title">
                    <img class="profile-pro-icon nudge-pro-icon" src="/static/images/pro-badge.svg" />
                    <h2>Consider DeepAI Pro</h2>
                </div>
                <ul class="pro-features-list" style="list-style: none; padding: 0; margin: 0 0 20px 0;">
                  <li style="display: flex; align-items: center; margin-bottom: 10px;">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                      style="margin-right: 10px;"
                    >
                      <circle cx="12" cy="12" r="12" fill="#8f37ff" />
                      <path
                        d="M10.8333 13.8503L16.1953 8.48776L17.0207 9.3126L10.8333 15.5L7.12097 11.7877L7.94581 10.9628L10.8333 13.8503Z"
                        fill="white"
                      />
                    </svg>
                    <span>World's best value AI at $9.99 per month</span>
                  </li>
                  <li style="display: flex; align-items: center; margin-bottom: 10px;">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                      style="margin-right: 10px;"
                    >
                      <circle cx="12" cy="12" r="12" fill="#8f37ff" />
                      <path
                        d="M10.8333 13.8503L16.1953 8.48776L17.0207 9.3126L10.8333 15.5L7.12097 11.7877L7.94581 10.9628L10.8333 13.8503Z"
                        fill="white"
                      />
                    </svg>
                    <span>Smarter AI Chat</span>
                  </li>
                  <li style="display: flex; align-items: center; margin-bottom: 10px;">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                      style="margin-right: 10px;"
                    >
                      <circle cx="12" cy="12" r="12" fill="#8f37ff" />
                      <path
                        d="M10.8333 13.8503L16.1953 8.48776L17.0207 9.3126L10.8333 15.5L7.12097 11.7877L7.94581 10.9628L10.8333 13.8503Z"
                        fill="white"
                      />
                    </svg>
                    <span>Highest quality AI Images, Videos, and Music</span>
                  </li>
                  <li style="display: flex; align-items: center;">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                      style="margin-right: 10px;"
                    >
                      <circle cx="12" cy="12" r="12" fill="#8f37ff" />
                      <path
                        d="M10.8333 13.8503L16.1953 8.48776L17.0207 9.3126L10.8333 15.5L7.12097 11.7877L7.94581 10.9628L10.8333 13.8503Z"
                        fill="white"
                      />
                    </svg>
                    <span>100% Ad-free</span>
                  </li>
                </ul>
                <button id="stripe-pro-button-container" class="modal-get-started" onclick="window.open(deepaiProLinkUrl, '_blank')">
                  Subscribe
                </button>
              </div>
          </div>

        
		<footer>
			
			
			
			
		</footer>
        

        <!-- Privacy Modal -->
        <dialog id="privacy-modal-dialog" class="privacy-modal-dialog">
            <button id="privacy-modal-close-btn" class="privacy-modal-close-btn" aria-label="Close">&times;</button>
            <iframe id="privacy-modal-iframe" data-src="/privacy-choices/" title="Privacy Choices"></iframe>
        </dialog>

        <script>const app_base_url='https://api.deepai.org';const network_to_url={linkedin:'/accounts/linkedin_oauth2/login/?process=login',google:'/accounts/google/login/?process=login',};;</script>

        <script>"use strict";;;var deepaiProLinkUrl=undefined;var deepaiAddCreditsLinkUrl=undefined;var deepaiUpdateStripeCardUrl=undefined;var cookieUserReeferrer=undefined;var latestPagePathCookie=undefined;const bus={afterAuthStatusCheck:[]};function onAfterAuthStatusCheck(fn){if(!bus.afterAuthStatusCheck.includes(fn)){bus.afterAuthStatusCheck.push(fn);}}
function emitAfterAuthStatusCheck(){bus.afterAuthStatusCheck.forEach(fn=>{try{fn(undefined);}
catch(e){console.error('Error in afterAuthStatusCheck listener:',e);}});}
function setElementsStyleById(ids,style){ids.forEach(id=>{const element=document.getElementById(id);if(element){element.setAttribute('style',style);}});}
function showElementsById(ids){setElementsStyleById(ids,"display: flex;");}
function hideElementsById(ids){setElementsStyleById(ids,"display: none;");}
function logStat(statName,options){const formData=new FormData();formData.append('stat_name',statName);if(options?.type&&options?.message){formData.append('error_type',options.type);formData.append('error_message',options.message);}
if(options?.breakdown){formData.append('breakdown',options.breakdown);}
fetch(app_base_url+'/log_stat',{method:'POST',credentials:'include',body:formData}).catch(()=>{});}
function getUserObject(){try{const userStr=localStorage.getItem('user');if(userStr){return JSON.parse(userStr);}}
catch(e){console.error("Error accessing or parsing user data from localStorage",e);}
return null;}
function getUserProfile(){const userObject=getUserObject();return userObject?.userprofile2||null;}
function toggleAuthOption(toggle){const loginOption=document.getElementById("loginToggle");const signupOption=document.getElementById("signupToggle");const authGoogle=document.getElementById('social-auth-google');const emailSwitch=document.getElementById("switch-to-email");const loginEmail=document.getElementById('login-via-email-id');const userEmailError=document.getElementById('user-email-error');const reenterPwd=document.getElementById("reenter-password-container-id");if(userEmailError)
userEmailError.setAttribute('style',"display: none;");const userEmailInput=document.getElementById('user-email');if(userEmailInput)
userEmailInput.focus();if(toggle==="login"){if(loginOption&&!loginOption.classList.contains("active")){loginOption.classList.add("active");if(signupOption)
signupOption.classList.remove("active");}
const loginHeaderTitle=document.getElementById('login-header-title');if(loginHeaderTitle)
loginHeaderTitle.innerHTML="Login";if(authGoogle&&authGoogle.parentNode){const newAuthGoogle=authGoogle.cloneNode(true);newAuthGoogle.addEventListener('click',(e)=>social_login(e,'google'));authGoogle.parentNode.replaceChild(newAuthGoogle,authGoogle);}
if(emailSwitch&&emailSwitch.parentNode){const newEmailSwitch=emailSwitch.cloneNode(true);newEmailSwitch.innerHTML="Or login with email";newEmailSwitch.addEventListener('click',()=>authOptions('moreOptions'));emailSwitch.parentNode.replaceChild(newEmailSwitch,emailSwitch);}
hideElementsById(["reenter-password-container-id","user-email-error"]);if(loginEmail&&loginEmail.parentNode){const newLoginEmail=loginEmail.cloneNode(true);newLoginEmail.innerHTML="Login";newLoginEmail.removeAttribute('onclick');newLoginEmail.addEventListener('click',(e)=>login(e));loginEmail.parentNode.replaceChild(newLoginEmail,loginEmail);}}
else{if(signupOption&&!signupOption.classList.contains("active")){signupOption.classList.add("active");if(loginOption)
loginOption.classList.remove("active");}
const loginHeaderTitle=document.getElementById('login-header-title');if(loginHeaderTitle)
loginHeaderTitle.innerHTML="Signup";if(authGoogle&&authGoogle.parentNode){const newAuthGoogle=authGoogle.cloneNode(true);newAuthGoogle.addEventListener('click',(e)=>social_signup(e,'google'));authGoogle.parentNode.replaceChild(newAuthGoogle,authGoogle);}
if(emailSwitch&&emailSwitch.parentNode){const newEmailSwitch=emailSwitch.cloneNode(true);newEmailSwitch.innerHTML="Or signup with email";newEmailSwitch.addEventListener('click',()=>authOptions('moreOptions'));emailSwitch.parentNode.replaceChild(newEmailSwitch,emailSwitch);}
if(loginEmail&&loginEmail.parentNode){const newLoginEmail=loginEmail.cloneNode(true);newLoginEmail.innerHTML="Signup";newLoginEmail.removeAttribute('onclick');newLoginEmail.addEventListener('click',(e)=>signup(e));loginEmail.parentNode.replaceChild(newLoginEmail,loginEmail);}
hideElementsById(["forgot-password","user-email-error"]);const reenterPwdDisplay=(authGoogle&&authGoogle.style.display==="none")?"flex":"none";if(reenterPwd)
reenterPwd.setAttribute('style',`display: ${reenterPwdDisplay};`);}}
function authOptions(toggle){hideElementsById(['user-email-error']);const moreOptions={true:{visible:["email-container-id","password-container-id","reenter-password-container-id","login-via-email-id","forgot-password","go-back-login"],hidden:["switch-to-email","social-auth-google"]},false:{visible:["switch-to-email","social-auth-google"],hidden:["email-container-id","password-container-id","reenter-password-container-id","login-via-email-id","forgot-password","go-back-login"]}};const isMoreOptions=toggle==="moreOptions";showElementsById(moreOptions[String(isMoreOptions)].visible);hideElementsById(moreOptions[String(isMoreOptions)].hidden);const userEmailInput=document.getElementById('user-email');if(userEmailInput)
userEmailInput.focus();const loginButton=document.getElementById('login-via-email-id');if(toggle==="moreOptions"&&loginButton&&loginButton.innerHTML==="Login"){hideElementsById(["reenter-password-container-id"]);}}
function subscriptionPopupAfterAuth(){if(window.location.pathname.startsWith('/pricing')){return;}
const userProfile=getUserProfile();if(userProfile){if(!(userProfile.user_has_deepai_pro||userProfile.user_is_pay_as_you_go)){openSubscription();}}}
function openSubscribeFromGenius(tag){const modalId=tag==="image"?"genius-images-modal":"genius-chat-modal";const geniusModal=document.getElementById(modalId);if(geniusModal&&typeof geniusModal.close==='function'){geniusModal.close();openSubscription();}
else{console.warn(`Modal with ID '${modalId}' not found or is not a closeable element.`);openSubscription();}}
function toast(toastElementId,message,toastInterval=3000){const toastElement=document.getElementById(toastElementId);if(toastElement){const messageElement=toastElement.querySelector('.message');if(messageElement){const defaultMessage=messageElement.textContent;if(message){messageElement.textContent=message;}
toastElement.classList.add('show');setTimeout(()=>{toastElement.classList.remove('show');if(messageElement&&defaultMessage){messageElement.textContent=defaultMessage;}},toastInterval);}}}
try{if(!(window.location.hostname==="deepai.org"||window.location.hostname==="127.0.0.1")){window.location.href="https://deepai.org"+window.location.pathname+window.location.search;}}
catch(e){console.log("error redirecting to deepai.org: "+e);}
try{(function(window){if(window.location!==window.top?.location){if(window.top){window.top.location.href=window.location.href;}}})(window);}
catch(e){console.log('error breaking out of iframe',e);alert('DeepAI cannot be used in an iframe');window.open('https://deepai.org','_blank');window.location.href='https://openai.com/';}
fetch(app_base_url+"/favicon.ico",{method:'POST',});try{document.addEventListener("visibilitychange",(e)=>{fetch(app_base_url+"/favicon.ico",{method:'POST',});});}
catch(e){console.log("error adding visibilitychange event listener: "+e);}
function removeHeaderBackground(){const navbar=document.querySelector('header');if(navbar){navbar.style.background="";}}
function changeHeaderBackground(){const navbar=document.querySelector('header');const ad=document.getElementById('deepai.org_header');if(!navbar||!ad)
return;const navbarRect=navbar.getBoundingClientRect();const adRect=ad.getBoundingClientRect();const navbarHeight=navbarRect.height;const bodyElement=document.querySelector('body');if(!bodyElement)
return;const bodyHeight=bodyElement.getBoundingClientRect().height;const navBodyRatio=bodyHeight/navbarHeight;const shift=-100*adRect.height/navbarHeight;navbar.style.background=`linear-gradient(180deg,#7729aa ${shift + -13.13 * navBodyRatio}%,#170a2d ${shift + 0.17 * navBodyRatio}%,#0a061d ${shift + navBodyRatio * 6.9}%,rgba(10,6,30,0.99) ${shift + navBodyRatio * 36.38}%,#010311 ${shift + navBodyRatio * 98.59}%)`;}
try{localStorage.setItem("name","Hello World!");}
catch(e){console.log("Error - local storage is full. clearing local storage");try{localStorage.clear();}
catch(e2){console.log("error clearing local storage: "+e2);}}
let onCategoryPage=false;try{const reeferrerMadness=document.referrer;let localCookieUserReeferrer=localStorage.getItem('userReeferrer');if(localCookieUserReeferrer==undefined){localStorage.setItem('userReeferrer',reeferrerMadness);localCookieUserReeferrer=localStorage.getItem('userReeferrer');}
const thisLocation=window.location.pathname;let pagePathCookie=localStorage.getItem('pagePath');if(pagePathCookie==undefined){localStorage.setItem('pagePath',[thisLocation].toString());}
else if(pagePathCookie.length>100000){}
else{const newPagePathCookie=[pagePathCookie,thisLocation];localStorage.setItem('pagePath',newPagePathCookie.toString());}
const localLatestPagePathCookie=localStorage.getItem('pagePath');cookieUserReeferrer=localCookieUserReeferrer||undefined;latestPagePathCookie=localLatestPagePathCookie||undefined;}
catch(e){console.log("error in reeferrer madness: "+e);}
if(window.HTMLDialogElement&&'showModal'in HTMLDialogElement.prototype){console.log('loading dialog polyfill...');const script=document.createElement("script");script.src="/static/js/libs/dialog-polyfill.js";script.type="text/javascript";script.async=true;script.onload=function(){for(const dialog of Array.from(document.getElementsByTagName('dialog'))){dialogPolyfill.registerDialog(dialog);}};document.getElementsByTagName("head")[0].appendChild(script);}
else{console.log('not loading dialog polyfill');}
try{if(!window.localStorage||!window.sessionStorage)
(function(){const Storage=function(type){function createCookie(name,value,days){let date,expires;if(days){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toUTCString();}
else{expires="";}
document.cookie=name+"="+value+expires+"; path=/";}
function readCookie(name){const nameEQ=name+"=";const ca=document.cookie.split(';');let i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}
if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length);}}
return null;}
function setData(data){const dataStr=JSON.stringify(data);if(type=='session'){window.name=dataStr;}
else{createCookie('localStorage',dataStr,365);}}
function clearData(){if(type=='session'){window.name='';}
else{createCookie('localStorage','',365);}}
function getData(){const data=type=='session'?window.name:readCookie('localStorage');return data?JSON.parse(data):{};}
let data=getData();function numKeys(){let n=0;for(const k in data){if(data.hasOwnProperty(k)){n+=1;}}
return n;}
return{clear:function(){data={};clearData();this.length=numKeys();},getItem:function(key){key=encodeURIComponent(key);return data[key]===undefined?null:data[key];},key:function(i){let ctr=0;for(const k in data){if(ctr==i)
return decodeURIComponent(k);else
ctr++;}
return null;},removeItem:function(key){key=encodeURIComponent(key);delete data[key];setData(data);this.length=numKeys();},setItem:function(key,value){key=encodeURIComponent(key);data[key]=String(value);setData(data);this.length=numKeys();},length:0};};if(!window.localStorage)
window.localStorage=Storage('local');if(!window.sessionStorage)
window.sessionStorage=Storage('session');})();}
catch(e){console.log("error installing localstorage polyfill: "+e);}
function userIsLoggedIn(){if(user_object?.pk){return true;}
else{return false;}}
function getUserId(){if(user_object?.pk){return user_object.pk;}
else{return null;}}
async function saveDeepaiProLinkUrl(){const resp=await fetch(app_base_url+'/get_my_stripe_subscription_checkout_link',{method:'GET',credentials:'include',});const data=await resp.json();deepaiProLinkUrl=data.link;console.log("got deepaiProLinkUrl",deepaiProLinkUrl);}
async function creditsCheckoutUrl(creditsAmountSelect){const selectElement=document.getElementById(creditsAmountSelect);if(!selectElement)
return;const amount_of_credits=selectElement.value;const checkoutWindow=window.open('','_blank');const formData=new FormData();formData.append('amount_of_credits',amount_of_credits);try{const resp=await fetch(app_base_url+'/get_my_stripe_credits_checkout_link',{method:'POST',credentials:'include',body:formData});const data=await resp.json();deepaiAddCreditsLinkUrl=data.add_credits_link;console.log("got deepaiAddCreditsLinkUrl",deepaiAddCreditsLinkUrl);if(checkoutWindow){checkoutWindow.location.href=deepaiAddCreditsLinkUrl;}
else{window.location.href=deepaiAddCreditsLinkUrl;}}
catch(error){console.error("Error getting checkout URL:",error);if(checkoutWindow){checkoutWindow.close();}}}
async function saveStripeCardUpdateLink(){const resp=await fetch(app_base_url+'/get_my_stripe_card_update_link',{method:'GET',credentials:'include',});const data=await resp.json();deepaiUpdateStripeCardUrl=data.link;console.log("got deepaiUpdateStripeCardUrl",deepaiUpdateStripeCardUrl);}
function authKeyPressHandler(e){if(e.keyCode==13&&!e.shiftKey){e.preventDefault();const loginButton=document.getElementById('login-via-email-id');if(loginButton&&loginButton.innerHTML=="Login"){login(e);}
else{signup(e);}}}
async function checkAuthStatus(){const userStr=localStorage.getItem('user');if(userStr){user_object=JSON.parse(userStr);}
console.log(user_object);const dropdownSandwich=document.getElementById('sandwichIconDrop');const dropdownUser=document.getElementById('userIconDrop');const profileSecNav=document.getElementById('navProfileSection');const profileButtonNav=document.getElementById('navProfileButton');const navProfileAvatar=document.getElementById('navUserAvatar');const headerLogin=document.getElementById('headerLoginButton');const navUsername=document.getElementById('navUserName');const navUseremail=document.getElementById('navUserEmail');if(userIsLoggedIn()&&user_object){if(user_object.userprofile2?.user_has_deepai_pro){const banner=document.getElementById('announcement-banner');if(banner){banner.style.display='none';}}
showHidePermanentProAds();if(user_object.userprofile2?.user_has_deepai_pro){if(typeof user_paid_for_no_ads!=='undefined'){user_paid_for_no_ads=true;}
removeFreestarAds();}
else if(user_object.userprofile2?.locked_out_due_to_no_payment_info===false){if(typeof user_paid_for_no_ads!=='undefined'){user_paid_for_no_ads=true;}
removeFreestarAds();}
if(navProfileAvatar){navProfileAvatar.src=app_base_url+'/get_author_obj_img_url';}
saveDeepaiProLinkUrl();saveStripeCardUpdateLink();if(dropdownSandwich)
dropdownSandwich.style.display="none";if(headerLogin)
headerLogin.style.display="none";if(dropdownUser)
dropdownUser.style.display="flex";if(profileSecNav)
profileSecNav.style.display="flex";if(profileButtonNav)
profileButtonNav.style.display="flex";if(navUsername&&user_object.username)
navUsername.textContent=user_object.username;if(navUseremail&&user_object.email)
navUseremail.textContent=user_object.email;for(const signupButton of Array.from(document.getElementsByClassName('button login'))){const button=signupButton;button.setAttribute('onclick',"window.location.replace('/dashboard/profile')");button.innerHTML="My Profile";}
const signupDropdownLi=document.getElementById('signup-button-dropdown-li');if(signupDropdownLi){signupDropdownLi.setAttribute('onclick',"window.location.replace('/dashboard/profile')");signupDropdownLi.innerHTML="My Profile";}
for(const loginButton of Array.from(document.getElementsByClassName('login-button'))){const button=loginButton;button.setAttribute('onclick',"logout()");button.innerHTML="Log Out";}
const loginDropdown=document.getElementById('login-button-dropdown');if(loginDropdown){loginDropdown.setAttribute('onclick',"logout()");loginDropdown.innerHTML="Logout";}
try{if(typeof window.freestar=='object'){window.freestar.queue.push(function(){window.freestar.identity.setIdentity({email:user_object.email});});}}
catch(e){console.log('error setting freestar identity',e);}
applyCachedHeartsToHeartsOnPage();await refreshHeartsFromServer();}
emitAfterAuthStatusCheck();}
function setupIMEHandlers(element){let isComposing=false;let compositionJustEnded=false;element.addEventListener('compositionstart',()=>{isComposing=true;compositionJustEnded=false;});element.addEventListener('compositionend',()=>{isComposing=false;compositionJustEnded=true;setTimeout(()=>{compositionJustEnded=false;},50);});return{isComposing:()=>isComposing,compositionJustEnded:()=>compositionJustEnded};}
function removeFreestarAds(){try{const pushdown=document.getElementById("deepai.org_header");if(pushdown){const parentMain=pushdown.parentNode;if(parentMain&&parentMain.parentNode){parentMain.parentNode.removeChild(parentMain);}}}
catch(e){console.error('Error removing deepai.org_header parent:',e);}
try{window.freestar.deleteAdSlots();}
catch(e){console.error('Error in freestar.deleteAdSlots:',e);}
try{window.freestar.deleteVideo();}
catch(e){console.error('Error in freestar.deleteVideo:',e);}
try{window.freestar.deleteStickyFooter();}
catch(e){console.error('Error in freestar.deleteStickyFooter:',e);}}
async function auth(){try{const response=await fetch(app_base_url+"/daily-time-sync/user/",{credentials:'include'});const user=await response.json();const user_string=JSON.stringify(user);if(response.status==200){localStorage.setItem('user',user_string);user_object=JSON.parse(localStorage.getItem('user'));await checkAuthStatus();}
else{localStorage.removeItem('user');localStorage.removeItem('hearts-cache');user_object=undefined;}}
catch(e){console.log("Error validating auth",e);localStorage.removeItem('user');localStorage.removeItem('hearts-cache');user_object=undefined;}}
function mainNavDrop(){const dropdown=document.getElementById("mainNavDropdown");if(dropdown){dropdown.classList.toggle("show-dropdown");}}
const dropMenuButton=document.getElementById("dropMenuButton");if(dropMenuButton){dropMenuButton.addEventListener("click",function(event){event.stopPropagation();mainNavDrop();},false);}
window.onclick=function(event){const target=event.target;if(target.closest('.dropdown-link')||target.closest('.content-dropdown-link')){}
else if(!target.matches('.dropbtn')){const contentDropdown=document.getElementById("contentNavDropdown");if(contentDropdown&&contentDropdown.classList.contains('show-dropdown')){contentDropdown.classList.remove('show-dropdown');}
const mainDropdown=document.getElementById("mainNavDropdown");if(mainDropdown&&mainDropdown.classList.contains('show-dropdown')){mainDropdown.classList.remove('show-dropdown');}}};checkAuthStatus();auth();async function refreshHeartsFromServer(){const response=await fetch(app_base_url+"/get_my_hearted_object_ids",{credentials:'include'});const hearts=await response.json();localStorage.setItem('hearts-cache',JSON.stringify(hearts));applyCachedHeartsToHeartsOnPage();}
function applyCachedHeartsToHeartsOnPage(){const heartsCacheStr=localStorage.getItem('hearts-cache');if(!heartsCacheStr){console.log('no heart cache');return;}
const hearts_hash=JSON.parse(heartsCacheStr).hearts;for(const heartLink of Array.from(document.getElementsByClassName('heart-link'))){const link=heartLink;link.removeAttribute('hearted');const heartId=link.getAttribute('heartid');if(heartId&&hearts_hash[heartId]){link.setAttribute('hearted','hearted');}}}
async function heart(heartLink){if(!userIsLoggedIn()){openSignup(function(){heart(heartLink);});return;}
let hearts_cache;const cachedData=localStorage.getItem('hearts-cache');if(cachedData){hearts_cache=JSON.parse(cachedData);}
else{console.log('warning, hearts cache is empty. creating new hearts cache...');hearts_cache={'hearts':{}};}
let addremove;const heartCountElement=heartLink.getElementsByClassName('heart-count')[0];const oldcount=parseInt(heartCountElement.innerText)||0;const heartId=heartLink.getAttribute('heartid');if(!heartId)
return;if(heartLink.hasAttribute('hearted')){heartLink.removeAttribute('hearted');addremove='false';delete hearts_cache.hearts[heartId];let count=oldcount-1;if(count<0){count=0;}
heartCountElement.innerText=count.toString();}
else{heartLink.setAttribute('hearted','hearted');addremove='true';hearts_cache.hearts[heartId]=true;heartCountElement.innerText=(oldcount+1).toString();}
localStorage.setItem('hearts-cache',JSON.stringify(hearts_cache));const formData=new FormData();const split=heartId.split('-');const heartclass=split[0];const objid=split[1];formData.append('type',heartclass);formData.append('id',objid);formData.append('switch',addremove);const response=await fetch(app_base_url+"/add_remove_heart",{method:'POST',credentials:'include',body:formData});console.log('hearty response ',response);}
const modal=document.getElementById('login-modal');const nudgeLoginModal=document.getElementById("nudge-popup");const nudgeProModal=document.getElementById("nudge-pro-popup");let afterSignupFunction=null;const subscription_modal=document.getElementById('subscription-modal');const openSignup=function(afterSignupFunctionArg,popupHeaderText){afterSignupFunction=afterSignupFunctionArg||null;if(userIsLoggedIn()){if(afterSignupFunction){afterSignupFunction();}}
else{if(subscription_modal)
subscription_modal.close();if(modal&&!modal.open){modal.showModal();toggleAuthOption("signup");if(popupHeaderText){const header=modal.getElementsByClassName('login-header')[0];if(header)
header.innerHTML=popupHeaderText;}}}};const closeElem=document.getElementById('close');if(closeElem){closeElem.addEventListener('click',()=>{if(modal)
modal.close();authOptions('lessOptions');});}
if(modal){modal.addEventListener('cancel',()=>{modal.close();authOptions('lessOptions');});modal.addEventListener('click',(event)=>{if(event.target===modal){modal.close();authOptions('lessOptions');}});}
function getSignupCustomData(desired_username){return{'referrer':'['+(cookieUserReeferrer||'')+']'+'['+(latestPagePathCookie||'')+']','signup_page':window.location.pathname,'desired_username':desired_username};}
async function save_custom_signup_data(desired_username){const custom_signup_data=getSignupCustomData(desired_username);const response=await fetch(app_base_url+"/save_custom_signup_data",{credentials:'include',method:'POST',body:JSON.stringify(custom_signup_data),headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error("saving custom signup data HTTP status "+response.status);}
return null;}
async function signup(e){e.preventDefault();const p=document.getElementById('user-email-error');if(p){p.innerHTML='';p.setAttribute('style','display: none;');}
const user_email=document.getElementById('user-email');const user_password=document.getElementById('user-password');const confirm_user_password=document.getElementById('confirm-user-password');if(!user_email||!user_password||!confirm_user_password)
return;const user_email_value=user_email.value;const user_password_value=user_password.value;const confirm_user_password_value=confirm_user_password.value;const formData=new FormData();formData.append('email',user_email_value);formData.append('username',user_email_value);formData.append('password1',user_password_value);formData.append('password2',confirm_user_password_value);user_email.classList.add('loading');let validation_error=null;if(!user_email_value){validation_error='Email is required';}
else if(!user_password_value){validation_error='Password is required';}
else if(!confirm_user_password_value){validation_error='Password confirmation is required';}
if(validation_error&&p){p.innerHTML=validation_error;p.setAttribute('style','display: block;');user_email.classList.remove('loading');return;}
else{const user_login_type=await get_user_login_type(user_email_value);if(user_login_type.user_exists){user_email.classList.remove('loading');let message="This account already exists";if(!user_login_type.login_with_password){const name=user_login_type.login_with_social_accounts[0];message="This account exists and needs to be logged in using "+name;}
if(p){p.innerHTML=message;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}}
else{await save_custom_signup_data(null);const response=await fetch(app_base_url+"/daily-time-sync/registration/",{credentials:'include',method:'POST',body:formData});console.log(response);if(response.ok===true){user_email.classList.remove('loading');if(modal)
modal.close();if(nudgeLoginModal)
nudgeLoginModal.classList.remove("active");if(afterSignupFunction){await auth();afterSignupFunction();}
else{await auth();subscriptionPopupAfterAuth();}}
else if(response.ok===false&&p){user_email.classList.remove('loading');if(response.status===500){const signup_fail="Hmm, something went wrong. Perhaps try another email address, or try again later.";p.innerHTML=signup_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}
else if(response.status>=400){const data=await response.json();let signup_fail="Hmm, something went wrong. Perhaps try another email address, or try again later.";for(const[key,value]of Object.entries(data)){if(value[0]){signup_fail=value[0];break;}}
p.innerHTML=signup_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}}}}}
function recordNewProSubscriberConversion(callback){try{twq('event','tw-pzofp-pzoig',{value:5.00,currency:'USD',email_address:user_object?.email,phone_number:null});}
catch(e){console.log('error recording new pro subscriber conversion to twitter',e);}
try{if(!callback){callback=function(){console.log('conversion event callback');};}
gtag('event','conversion_event_subscribe_paid',{'event_callback':callback,'event_timeout':2000,});}
catch(e){console.log('error recording new pro subscriber conversion',e);if(callback)
callback();}}
const login_modal=document.getElementById('login-modal');let afterLoginFunction=null;const openLogin=function(afterLoginFunctionArg){afterLoginFunction=afterLoginFunctionArg||null;if(userIsLoggedIn()){if(afterLoginFunction){afterLoginFunction();}}
else{if(login_modal&&!login_modal.open){login_modal.showModal();toggleAuthOption("login");}}};const closeLogin=document.getElementById('close-login');if(closeLogin){closeLogin.addEventListener('click',()=>{if(login_modal)
login_modal.close();authOptions('lessOptions');});}
if(login_modal){login_modal.addEventListener('cancel',()=>{login_modal.close();authOptions('lessOptions');});login_modal.addEventListener('click',(event)=>{if(event.target===login_modal){login_modal.close();authOptions('lessOptions');}});}
let subscription_shown=false;const subscriptionMessageHandler=async(event)=>{console.log('received message: ',event.data);if(event.data=='stripe subscription success'){if(subscription_modal)
subscription_modal.close();if(nudgeProModal)
nudgeProModal.classList.remove('active');recordNewProSubscriberConversion();try{await auth();const up=user_object?.userprofile2;if(up?.user_has_deepai_pro){if(typeof user_paid_for_no_ads!=='undefined'){user_paid_for_no_ads=true;}
removeFreestarAds();const banner=document.getElementById('announcement-banner');if(banner)
banner.style.display='none';}
showHidePermanentProAds();emitAfterAuthStatusCheck();}
catch(e){console.log('Error handling subscription success:',e);}}};let subscriptionListenerAdded=false;const openSubscription=function(){if(!subscriptionListenerAdded){window.addEventListener("message",subscriptionMessageHandler,false);subscriptionListenerAdded=true;}
const showSubscriptionModal=()=>{if(subscription_modal&&!subscription_modal.open){subscription_modal.showModal();subscription_shown=true;}};if(userIsLoggedIn()&&user_object?.userprofile2?.user_has_deepai_pro){if(!user_object?.userprofile2?.user_can_use_genius_mode){openOutOfCredits();return;}
if(subscription_modal)
subscription_modal.close();if(nudgeProModal)
nudgeProModal.classList.remove('active');return;}
if(!userIsLoggedIn()){openSignup(async function(){if(user_object?.userprofile2?.user_has_deepai_pro){if(!user_object?.userprofile2?.user_can_use_genius_mode){openOutOfCredits();}
return;}
if(!deepaiProLinkUrl){await saveDeepaiProLinkUrl();}
if(deepaiProLinkUrl){const stripeWindow=window.open(deepaiProLinkUrl,'_blank');if(!stripeWindow||stripeWindow.closed||typeof stripeWindow.closed==='undefined'){showSubscriptionModal();}}});return;}
if(userIsLoggedIn()&&deepaiProLinkUrl){const stripeWindow=window.open(deepaiProLinkUrl,'_blank');if(!stripeWindow||stripeWindow.closed||typeof stripeWindow.closed==='undefined'){showSubscriptionModal();}
return;}
const userStr=localStorage.getItem('user');if(userStr){user_object=JSON.parse(userStr);}
showSubscriptionModal();};const closeSubscription=document.getElementById('close-sub');if(closeSubscription){closeSubscription.addEventListener('click',()=>{if(subscription_modal)
subscription_modal.close();});}
if(subscription_modal){subscription_modal.addEventListener('cancel',()=>{subscription_modal.close();});subscription_modal.addEventListener('click',(event)=>{if(event.target===subscription_modal){subscription_modal.close();}});}
const out_of_credits_modal=document.getElementById('out-of-credits-modal');const openOutOfCredits=function(current_balance,errorData){if(!userIsLoggedIn()){openLogin();return;}
if(!out_of_credits_modal)
return;if(!out_of_credits_modal.open){out_of_credits_modal.showModal();}
const msg=document.getElementById('outOfCreditsMessage');if(msg){msg.textContent=errorData?.message||'';msg.style.display=errorData?.message?'block':'none';}
const section=document.getElementById('outOfCreditsAutoTopUp');if(!section||!user_object?.userprofile2?.user_has_deepai_pro){if(section)
section.style.display='none';return;}
section.style.display='block';const toggle=document.getElementById('outOfCreditsAutoTopUpToggle');if(!toggle)
return;toggle.checked=errorData?.auto_top_up_enabled||false;toggle.onchange=async()=>{const previousState=!toggle.checked;const enabled=toggle.checked;try{const res=await fetch(app_base_url+'/update_auto_top_up_settings',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({enabled,min_balance:5.00})});const result=await res.json();if(result.error){toggle.checked=previousState;toast('errorpopup',result.error);}
else if(result.success){toast('successpopup',enabled?'Auto top-up enabled!':'Auto top-up disabled');}}
catch(e){console.error('Error saving auto top-up settings:',e);toggle.checked=previousState;toast('errorpopup','An error occurred. Please try again.');}};};const closeOutOfCredits=document.getElementById('close-out-of-credits');if(closeOutOfCredits){closeOutOfCredits.addEventListener('click',()=>{if(out_of_credits_modal)
out_of_credits_modal.close();});}
if(out_of_credits_modal){out_of_credits_modal.addEventListener('cancel',()=>{out_of_credits_modal.close();});out_of_credits_modal.addEventListener('click',(event)=>{if(event.target===out_of_credits_modal){out_of_credits_modal.close();}});}
async function get_user_login_type(email){const formData=new FormData();formData.append('email',email);const response=await fetch(app_base_url+"/get_user_login_type",{credentials:'include',method:'POST',body:formData});if(response.ok==true){const user_login_type=await response.json();return user_login_type;}
throw new Error("Failed to get user login type");}
async function login(e){e.preventDefault();const p=document.getElementById('user-email-error');if(p){p.innerHTML='';p.setAttribute('style','display: none;');}
const login_user_email=document.getElementById('user-email');const login_user_password=document.getElementById('user-password');if(!login_user_email||!login_user_password)
return;const login_user_email_value=login_user_email.value;const login_user_password_value=login_user_password.value;const formData=new FormData();formData.append('username',login_user_email_value);formData.append('password',login_user_password_value);if(login_user_email_value==''||login_user_password_value==''){return;}
else{login_user_email.classList.add('loading');const user_login_type=await get_user_login_type(login_user_email_value);if(!user_login_type.user_exists){login_user_email.classList.remove('loading');const login_fail="No user with this email or username was found";if(p){p.innerHTML=login_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}
return;}
if(!user_login_type.login_with_password){login_user_email.classList.remove('loading');const name=user_login_type.login_with_social_accounts[0];const login_fail="This account needs to be logged in using "+name;if(p){p.innerHTML=login_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}
return;}
const response=await fetch(app_base_url+"/daily-time-sync/login/",{credentials:'include',method:'POST',body:formData});console.log(response);if(response.ok==true){login_user_email.classList.remove('loading');if(login_modal)
login_modal.close();if(nudgeLoginModal)
nudgeLoginModal.classList.remove("active");if(afterLoginFunction){await auth();afterLoginFunction();}
else{await auth();subscriptionPopupAfterAuth();}}
else if(response.ok==false&&p){login_user_email.classList.remove('loading');if(response.status==500){const login_fail="Hmm, something went wrong. Let's try that again.";p.innerHTML=login_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}
else if(response.status==400){const login_fail="Email/password combination incorrect. Let's try that again.";p.innerHTML=login_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}
else{}}}}
function sleep_async(ms){return new Promise(resolve=>setTimeout(resolve,ms));}
async function social_auth(social_network,desired_username){const url=app_base_url+network_to_url[social_network];const openedWindow=window.open('about:blank','deepaiLogin','height=600,width=600,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=no');if(!openedWindow)
return;await save_custom_signup_data(desired_username);openedWindow.location.href=url;while(true){await sleep_async(200);if(openedWindow.closed){return;}}}
async function social_signup(e,social_network){e.preventDefault();const user_email=document.getElementById('user-email');if(!user_email)
return;user_email.classList.add('loading');const p=document.getElementById('user-email-error');if(p){p.innerHTML='';p.setAttribute('style','display: none;');}
let validation_error=null;if(validation_error&&p){p.innerHTML=validation_error;p.setAttribute('style','display: block;');user_email.classList.remove('loading');return;}
await social_auth(social_network,null);const response=await fetch(app_base_url+"/daily-time-sync/user/",{credentials:'include'});if(response.ok==true){user_email.classList.remove('loading');if(modal)
modal.close();if(nudgeLoginModal)
nudgeLoginModal.classList.remove("active");if(afterSignupFunction){await auth();afterSignupFunction();}
else{await auth();subscriptionPopupAfterAuth();}}
else{user_email.classList.remove('loading');const signup_fail="Hmm, something went wrong. You might already have an account with that email, or your passwords do not match.";if(p){p.innerHTML=signup_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}}}
async function social_login(e,social_network){e.preventDefault();await social_auth(social_network,null);const login_user_email=document.getElementById('user-email');if(!login_user_email)
return;login_user_email.classList.add('loading');const response=await fetch(app_base_url+"/daily-time-sync/user/",{credentials:'include'});if(response.ok==true){login_user_email.classList.remove('loading');if(login_modal)
login_modal.close();if(nudgeLoginModal)
nudgeLoginModal.classList.remove("active");await auth();subscriptionPopupAfterAuth();}
else{login_user_email.classList.remove('loading');const login_fail="Hmm, something went wrong. Let's try that again.";const p=document.getElementById('user-email-error');if(p){p.innerHTML=login_fail;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}}}
async function logout(){const response=await fetch(app_base_url+"/daily-time-sync/logout/",{method:'POST',credentials:'include'});localStorage.removeItem('user');localStorage.removeItem('hearts-cache');localStorage.removeItem('geniusChecked');localStorage.removeItem('onlineChecked');localStorage.removeItem('geniusVideoChecked');user_object=undefined;showHidePermanentProAds();window.location.href='/';}
async function resetPassword(e){const p=document.getElementById('user-email-error');if(p){p.innerHTML='';p.setAttribute('style','display: none;');}
const login_user_email=document.getElementById('user-email');if(!login_user_email)
return;const login_user_email_value=login_user_email.value;const formData=new FormData();formData.append('email',login_user_email_value);const response=await fetch(app_base_url+"/password_reset_trigger",{method:'POST',credentials:'include',body:formData,});console.log(response);if(response.ok==true&&p){const submission_success="Check your email inbox to reset password.";console.log(p);p.innerHTML=submission_success;p.className='good-auth-error';p.setAttribute('style','display: flex;');}
else if(response.ok==false&&p){const userEmailInput=document.getElementById("user-email");const submission_success=userEmailInput?.value?"Hmm something isn't right. Please try again or contact us.":"Please enter your email address above.";p.innerHTML=submission_success;p.className='bad-auth-error';p.setAttribute('style','display: flex;');}}
const social_modal=document.getElementById('social-modal');const openSocial=function(target_url){if(!social_modal)
return;if(!social_modal.open){social_modal.showModal();}
const x_link=document.getElementById('x-link');if(x_link){const x_link_value="https://twitter.com/intent/tweet?url="+target_url;x_link.href=x_link_value;}
const facebook_link=document.getElementById('facebook-link');if(facebook_link){const facebook_link_value="https://www.facebook.com/sharer.php?u="+target_url;facebook_link.href=facebook_link_value;}
const linkedin_link=document.getElementById('linkedin-link');if(linkedin_link){const linkedin_link_value="https://www.linkedin.com/shareArticle?mini=true&url="+target_url;linkedin_link.href=linkedin_link_value;}
const reddit_link=document.getElementById('reddit-link');if(reddit_link){const reddit_link_value="https://www.reddit.com/submit?url="+target_url;reddit_link.href=reddit_link_value;}
const social_link_input=document.getElementById('social-link-input');if(social_link_input){social_link_input.value=target_url;}};const closeSocial=document.getElementById('close-social');async function getPresignedDownloadUrl(url){const urlParts=url.split('/');const item_hash=urlParts[urlParts.length-1].split('?')[0];const item_id=urlParts[urlParts.length-2];const response=await fetch(`${app_base_url}/gallery-item-download/${item_id}/${item_hash}`,{credentials:'include'});if(!response.ok)
throw new Error(`HTTP error! status: ${response.status}`);const data=await response.json();if(!data.url)
throw new Error(data.error||'No download URL returned');return data.url;}
async function downloadFile(url,filename){try{const presignedUrl=await getPresignedDownloadUrl(url);if(!filename){const urlParts=url.split('/');filename=urlParts[urlParts.length-1].split('?')[0];}
const link=document.createElement('a');link.href=presignedUrl;link.download=filename;link.style.display='none';document.body.appendChild(link);link.click();document.body.removeChild(link);}
catch(error){console.error('Download failed:',error);window.open(url,'_blank');}}
async function shareMedia(target_url,isMusic=false){const share_url=target_url.replace('job-view','gallery-item').replace('art-image','gallery-item').replace('audio-gallery-item','gallery-item').replace('https://images.deepai.org',window.location.origin)+".html";const native_share_url=target_url.replace('gallery-item','get-media').replace('art-image','get-media').replace('https://images.deepai.org',window.location.origin)+'.html';const urlParts=target_url.split('.');const extension=urlParts[urlParts.length-1].split('?')[0].toLowerCase();const videoExtensions=['mp4','webm','mov','avi'];const audioExtensions=['mp3','wav','m4a','aac','ogg','flac'];const imageExtensions=['jpg','jpeg','png','gif','webp','svg','bmp'];let mediaType;if(isMusic||audioExtensions.includes(extension)){mediaType='music';}
else if(videoExtensions.includes(extension)){mediaType='video';}
else{mediaType='image';}
const shareMessage=mediaType==='music'?"Check out this music I generated with DeepAI!":mediaType==='video'?"Check out this video I generated with DeepAI!":"Check out this image I generated with DeepAI!";async function fetchAssetAsBlob(url){const response=await fetch(url);if(!response.ok){throw new Error('Network response was not ok');}
return response.blob();}
try{if('share'in navigator){const blob=await fetchAssetAsBlob(native_share_url);let mimeType;if(mediaType==='music'){mimeType=`audio/${extension === 'mp3' ? 'mpeg' : extension}`;}
else if(mediaType==='video'){mimeType=`video/${extension}`;}
else{mimeType=`image/${extension === 'jpg' ? 'jpeg' : extension}`;}
const filename=`deepai-${mediaType}.${extension}`;const file=new File([blob],filename,{type:mimeType});const text=mediaType==='music'?'Check out this cool music I made on DeepAI!':mediaType==='video'?'Check out this cool video I made on DeepAI!':'Check out this cool image I made on DeepAI!';await navigator.share({files:[file],title:'DeepAI',text});console.log(`${mediaType.charAt(0).toUpperCase() + mediaType.slice(1)} shared successfully`);return;}}
catch(error){console.error(`Error sharing the ${mediaType}:`,error);}
if(social_modal&&!social_modal.open){social_modal.showModal();}
if(social_modal){const message=shareMessage;const x_link=document.getElementById('x-link');if(x_link){const x_link_value="https://twitter.com/intent/tweet?url="+encodeURIComponent(share_url)+"&text="+encodeURIComponent(message);x_link.href=x_link_value;}
const facebook_link=document.getElementById('facebook-link');if(facebook_link){const facebook_link_value="https://www.facebook.com/sharer.php?u="+encodeURIComponent(share_url);facebook_link.href=facebook_link_value;}
const linkedin_link=document.getElementById('linkedin-link');if(linkedin_link){const linkedin_link_value="https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(share_url)+"&summary="+encodeURIComponent(message);linkedin_link.href=linkedin_link_value;}
const reddit_link=document.getElementById('reddit-link');if(reddit_link){const reddit_link_value="https://www.reddit.com/submit?url="+encodeURIComponent(share_url)+"&title="+encodeURIComponent(message);reddit_link.href=reddit_link_value;}
const social_link_input=document.getElementById('social-link-input');if(social_link_input){social_link_input.value=share_url;}}};if(closeSocial){closeSocial.addEventListener('click',()=>{if(social_modal)
social_modal.close();});}
if(social_modal){social_modal.addEventListener('cancel',()=>{social_modal.close();});social_modal.addEventListener('click',(event)=>{if(event.target===social_modal){social_modal.close();}});}
const privacy_modal=document.getElementById('privacy-modal-dialog');const privacy_iframe=document.getElementById('privacy-modal-iframe');const privacy_close_btn=document.getElementById('privacy-modal-close-btn');function openPrivacyModal(){if(!privacy_modal){return;}
if(privacy_iframe&&!privacy_iframe.src&&privacy_iframe.dataset.src){privacy_iframe.src=privacy_iframe.dataset.src;}
if(!privacy_modal.open){privacy_modal.showModal();}}
function closePrivacyModal(){if(privacy_modal){privacy_modal.close();}}
if(privacy_close_btn){privacy_close_btn.addEventListener('click',closePrivacyModal);}
if(privacy_modal){privacy_modal.addEventListener('cancel',closePrivacyModal);privacy_modal.addEventListener('click',(event)=>{if(event.target===privacy_modal){closePrivacyModal();}});}
function fragmentFromString(strHTML){return document.createRange().createContextualFragment(strHTML);}
function openNudgePopup(){const nudgePopup=document.getElementById("nudge-popup");if(nudgePopup)
nudgePopup.classList.add("active");}
function closeNudgePopup(){const nudgePopup=document.getElementById("nudge-popup");if(nudgePopup)
nudgePopup.classList.remove("active");}
const closeNudgePopupButton=document.getElementById("close-nudge-popup");if(closeNudgePopupButton){closeNudgePopupButton.addEventListener("click",function(event){closeNudgePopup();});}
function openNudgeProPopup(){const nudgeProPopup=document.getElementById("nudge-pro-popup");if(nudgeProPopup)
nudgeProPopup.classList.add("active");}
function closeNudgeProPopup(){const nudgeProPopup=document.getElementById("nudge-pro-popup");if(nudgeProPopup)
nudgeProPopup.classList.remove("active");}
const closeNudgeProPopupButton=document.getElementById("close-nudge-pro-popup");if(closeNudgeProPopupButton){closeNudgeProPopupButton.addEventListener("click",function(){closeNudgeProPopup();});}
function nudgeUserLogin(){if(userIsLoggedIn())
return;if(window.innerWidth<1000){return;}
const now=Date.now();const firstNudgeKey='firstLoginNudge';const lastNudgeKey='lastLoginNudge';const callCountKey='loginNudgeCallCount';const firstNudge=parseInt(localStorage.getItem(firstNudgeKey)||'',10);const lastNudge=parseInt(localStorage.getItem(lastNudgeKey)||'',10);let callCount=parseInt(localStorage.getItem(callCountKey)||'',10);if(isNaN(callCount)){callCount=0;}
callCount++;localStorage.setItem(callCountKey,callCount.toString());if(!firstNudge){localStorage.setItem(firstNudgeKey,now.toString());return;}
const FIVE_MINUTES=5*60*1000;const FOUR_HOURS=4*60*60*1000;if(now-firstNudge>=FIVE_MINUTES){if(!lastNudge){localStorage.setItem(lastNudgeKey,now.toString());openNudgePopup();return;}
if((now-lastNudge>=FOUR_HOURS)&&(callCount%4===0)){localStorage.setItem(lastNudgeKey,now.toString());openNudgePopup();}}}
function nudgeUserPro(){if(!user_object){return;}
if(user_object.userprofile2?.user_has_deepai_pro)
return;if(window.innerWidth<1000){return;}
const now=Date.now();const firstNudgeKey='firstProNudge';const lastNudgeKey='lastProNudge';const callCountKey='proNudgeCallCount';const firstNudge=parseInt(localStorage.getItem(firstNudgeKey)||'',10);const lastNudge=parseInt(localStorage.getItem(lastNudgeKey)||'',10);let callCount=parseInt(localStorage.getItem(callCountKey)||'',10);if(isNaN(callCount)){callCount=0;}
callCount++;localStorage.setItem(callCountKey,callCount.toString());if(!firstNudge){localStorage.setItem(firstNudgeKey,now.toString());return;}
const FIVE_MINUTES=5*60*1000;const FOUR_HOURS=4*60*60*1000;if(now-firstNudge>=FIVE_MINUTES){if(!lastNudge){localStorage.setItem(lastNudgeKey,now.toString());openNudgeProPopup();return;}
if((now-lastNudge>=FOUR_HOURS)&&(callCount%4===0)){localStorage.setItem(lastNudgeKey,now.toString());openNudgeProPopup();}}}
try{const bannerKey='proBannerDismissed';const banner=document.getElementById('announcement-banner');const dismissButton=document.getElementById('dismiss-banner');if(banner&&user_object){if(user_object?.userprofile2?.user_has_deepai_pro){banner.style.display='none';}}
if(dismissButton){dismissButton.addEventListener('click',function(){if(banner){banner.style.display='none';localStorage.setItem(bannerKey,JSON.stringify({date:new Date().toISOString()}));}});}}
catch(error){console.error('Error in pro banner functionality:',error);}
function showHidePermanentProAds(){try{const shouldShowProAds=!user_object?.userprofile2?.user_has_deepai_pro;document.querySelectorAll('.permanent-announcement-banner').forEach((el)=>el.style.setProperty('display',shouldShowProAds?'block':'none','important'));const sidebarContent=document.querySelector('.sidebar-content');if(sidebarContent){sidebarContent.style.setProperty('height',shouldShowProAds?'calc(100% - 177px)':'calc(100% - 120px)');}}
catch(error){console.error('Error in showHidePermanentProAds:',error);}}
showHidePermanentProAds();async function getGeoIP(){const CACHE_KEY='geoIPCache';const CACHE_DURATION_MS=60*60*1000;const now=Date.now();async function fetchFromAPI(){try{const response=await fetch(app_base_url+'/get_geo_ip',{credentials:'include'});if(!response.ok){console.error('Geo IP API request failed:',response.status);return null;}
const data=await response.json();if(data.error){console.error('Geo IP API error:',data.error);return data;}
const cacheData={data:data,timestamp:now};localStorage.setItem(CACHE_KEY,JSON.stringify(cacheData));return data;}
catch(error){console.error('Error fetching geo IP data:',error);return null;}}
try{const cachedStr=localStorage.getItem(CACHE_KEY);if(cachedStr){const cached=JSON.parse(cachedStr);const age=now-cached.timestamp;if(age<CACHE_DURATION_MS){return cached.data;}
fetchFromAPI();return cached.data;}
return await fetchFromAPI();}
catch(error){console.error('Error reading geo IP cache:',error);return await fetchFromAPI();}};</script>

        <script>const chat_style="chat";const splitterJsUrl="/static/js/splitter.js";;</script>

        <script>;var contextualAdProvider='nobody';var freestarAdsLoaded=false;const forceAdProvider=new URLSearchParams(window.location.search).get('forceAdProvider');var koahReadyCallbacks=[];var koahLoaded=false;function onKoahReady(callback){if(koahLoaded){callback();}
else{koahReadyCallbacks.push(callback);}}
var adProviderReadyCallbacks=[];var adProviderDecided=false;function onAdProviderReady(callback){if(adProviderDecided){try{callback();}
catch(e){console.error('Error in adProviderReady callback:',e);}}
else{adProviderReadyCallbacks.push(callback);}}
function notifyAdProviderReady(){adProviderDecided=true;adProviderReadyCallbacks.forEach(cb=>{try{cb();}
catch(e){console.error('Error in adProviderReady callback:',e);}});}
window.freestar=window.freestar||{};window.freestar.queue=window.freestar.queue||[];window.freestar.config=window.freestar.config||{};window.freestar.config.enabled_slots=window.freestar.config.enabled_slots||[];if(!window.freestar.initCallback){window.freestar.initCallback=function(){const config=window.freestar.config;if(config.enabled_slots.length===0){window.freestar.initCallbackCalled=false;}
else{window.freestar.newAdSlots(config.enabled_slots);}};}
(function(){const pushdown=document.getElementById("deepai.org_header");if(pushdown&&pushdown.parentNode){pushdown.parentNode.remove();console.log('Removed Freestar header ad');}})();function loadFreestarAds(){if(freestarAdsLoaded)
return;if(window.characterEnabled||window.user_paid_for_no_ads){console.log('Freestar skipped: Paid user or Character page');return;}
console.log('Loading Freestar ads');freestarAdsLoaded=true;const freestarConfig=window.freestar.config;freestarConfig.enabled_slots=freestarConfig.enabled_slots||[];if(window.location.pathname==='/'){freestarConfig.disabledProducts={videoAdhesion:true,stickyFooter:false,pushdown:true,sideWall:true,superflex:true,dynamicAds:true,googleInterstitial:true};}
else{freestarConfig.disabledProducts=freestarConfig.disabledProducts||{};}
const script=document.createElement('script');script.src='https://a.pub.network/deepai-org/pubfig.min.js';script.async=true;document.head.appendChild(script);window.freestar.queue.push(function(){window.freestar.newVideo("FreeStarVideoAdContainer_Slider_Native");});}
let geoData=undefined;getGeoIP().then(data=>{geoData=data;if(forceAdProvider&&!window.user_paid_for_no_ads){console.log(`forceAdProvider=${forceAdProvider} - ignoring geo`);contextualAdProvider=forceAdProvider;if(forceAdProvider==='koah'){loadKoahAds();}
else if(forceAdProvider==='prorata'){loadProrataAds();}
else if(forceAdProvider==='thrad'){loadThradAds();}
notifyAdProviderReady();return;}
if(geoData){const country=geoData.country_code2;const isSplitterCountry=(country==="US"||country==="GB"||country==="BR");if(!isSplitterCountry){if(!window.user_paid_for_no_ads){console.log('Rest of World: Loading Thrad ads (100%)');contextualAdProvider='thrad';loadThradAds();}
loadFreestarAds();notifyAdProviderReady();}
else{if(!window.user_paid_for_no_ads){console.log('user is in US+GB+BR, using A/B bucket assignment');(function(){const script=document.createElement('script');script.src=splitterJsUrl;script.async=true;script.onload=async function(){const bucket=await assignFairBucket();if(bucket==='A'){if(country==="US"){console.log('Bucket A (US): Loading Prorata ads');contextualAdProvider='prorata';loadProrataAds();}
else{console.log('Bucket A (Non-US): ProRata opted out, loading Freestar fallback');loadFreestarAds();}
try{if(typeof gtag!=='undefined')
gtag('event','exp_contextual_ads_variant_A');}
catch(e){}}
else{console.log('Bucket B: Loading Koah ads');contextualAdProvider='koah';loadKoahAds();try{if(typeof gtag!=='undefined')
gtag('event','exp_contextual_ads_variant_B');}
catch(e){}}
notifyAdProviderReady();};document.head.appendChild(script);})();}
else{console.log('user has paid for no ads, not loading contextual ads');notifyAdProviderReady();}}}}).catch((error)=>{console.error('Failed to load geo IP data:',error);geoData=null;});function loadProrataAds(){console.log('Prorata ads enabled - API-based integration ready');}
function loadKoahAds(){const script=document.createElement('script');script.async=true;script.type='module';script.src='https://app.koah.ai/js?token=8a686266-fd49-462b-8480-f7326a2566f7';script.onload=function(){koahLoaded=true;koahReadyCallbacks.forEach(cb=>cb());};document.head.appendChild(script);}
function loadThradAds(){console.log('Thrad ads enabled - API-based integration ready');};;"use strict";const baseChatModes=[{value:"standard",label:"Standard",locked:false},{value:"online",label:"Online",locked:false},{value:"math",label:"Math",locked:false},{value:"genius",label:"Genius",locked:true},{value:"supergenius",label:"Super Genius",locked:true},{value:"onlinegenius",label:"Online Genius",locked:true},];const additionalModels=[{value:"deepseek-v3.2",label:"DeepSeek V3.2",locked:false},{value:"chatgpt-4o-latest",label:"ChatGPT 4o Latest",locked:true},{value:"gpt-5-chat-latest",label:"GPT-5 Chat Latest",locked:true},{value:"qwen3-30b-a3b",label:"Qwen3 30B",locked:false},{value:"gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite",locked:false},{value:"gpt-5.2",label:"GPT-5.2",locked:true},{value:"gemma-3-12b-it",label:"Gemma 3 12B",locked:false},{value:"llama-3.1-8b-instant",label:"Llama 3.1 8B Instant",locked:false},{value:"qwen3-next-80b-a3b-instruct",label:"Qwen3 Next 80B",locked:true},{value:"grok-4",label:"Grok 4",locked:true},{value:"gpt-5-nano",label:"GPT-5 Nano",locked:false},{value:"gpt-oss-120b",label:"GPT OSS 120B",locked:false},{value:"claude-4.5-opus",label:"Claude 4.5 Opus",locked:true},{value:"llama-4-scout",label:"Llama 4 Scout",locked:false},{value:"llama-3.3-70b-instruct",label:"Llama 3.3 70B Instruct",locked:false},{value:"grok-code-fast-1",label:"Grok Code Fast 1",locked:true},{value:"gpt-oss-20b",label:"GPT OSS 20B",locked:false},{value:"llama-4-maverick",label:"Llama 4 Maverick",locked:true},{value:"gpt-5-mini",label:"GPT-5 Mini",locked:true},{value:"gpt-4o",label:"GPT-4o",locked:true},{value:"claude-3.5-sonnet-v2",label:"Claude 3.5 Sonnet V2",locked:true},{value:"gemma2-9b-it",label:"Gemma2 9B",locked:false},{value:"qwen3-235b-a22b-thinking",label:"Qwen3 235B Thinking",locked:true},{value:"deepseek-r1-distill-llama-70b",label:"DeepSeek R1 Distill Llama 70B",locked:true},{value:"claude-sonnet-4",label:"Claude Sonnet 4",locked:true},{value:"claude-3.5-haiku",label:"Claude 3.5 Haiku",locked:true},{value:"claude-3.7-sonnet",label:"Claude 3.7 Sonnet",locked:true},{value:"claude-opus-4",label:"Claude Opus 4",locked:true},{value:"claude-opus-4-1",label:"Claude Opus 4.1",locked:true},{value:"deepseek-reasoner",label:"DeepSeek Reasoner",locked:true},{value:"deepseek-v3",label:"DeepSeek V3",locked:true},{value:"deepseek-v3.1-terminus",label:"DeepSeek V3.1 Terminus",locked:true},{value:"gemini-3-pro-preview",label:"Gemini 3 Pro",locked:true},{value:"gpt-4.1",label:"GPT-4.1",locked:true},{value:"gpt-4.1-mini",label:"GPT-4.1 Mini",locked:true},{value:"gpt-4.1-nano",label:"GPT-4.1 Nano",locked:false},{value:"gpt-4o-mini",label:"GPT-4o mini",locked:true},{value:"grok-3",label:"Grok 3",locked:true},{value:"grok-3-mini",label:"Grok 3 Mini",locked:true},{value:"kimi-k2",label:"Kimi K2",locked:true},{value:"kimi-k2-0905",label:"Kimi K2 0905",locked:true},{value:"kimi-k2-instruct",label:"Kimi K2 Instruct",locked:true},{value:"o3",label:"o3",locked:true},{value:"o3-mini",label:"o3 Mini",locked:true},{value:"o4-mini",label:"o4 Mini",locked:true},{value:"qwen3-32b",label:"Qwen3 32B",locked:true},{value:"qwen3-coder",label:"Qwen3 Coder",locked:true},];const allChatModes=[...baseChatModes,...additionalModels];const modelState={selectedModel:'',listeners:new Set(),setModel(model){this.selectedModel=model;sessionStorage.setItem("selectedChatMode",model);this.notifyListeners(model);},getModel(){if(!this.selectedModel){const storedMode=sessionStorage.getItem("selectedChatMode");if(storedMode){const mode=allChatModes.find(m=>m.value===storedMode);if(mode&&mode.locked&&!getUserHasPro()){this.selectedModel=getDefaultModel();sessionStorage.setItem("selectedChatMode",this.selectedModel);}
else{this.selectedModel=storedMode;}}
else{this.selectedModel=getDefaultModel();}}
return this.selectedModel;},subscribe(listener){this.listeners.add(listener);return()=>this.listeners.delete(listener);},notifyListeners(model){this.listeners.forEach(listener=>listener(model));}};function getUserHasPro(){return user_object?.userprofile2?.user_can_use_genius_mode||false;}
function getDefaultModel(){return getUserHasPro()?"genius":"standard";}
function findModelByValue(value){return allChatModes.find(m=>m.value===value);}
function isModelLocked(value){const mode=findModelByValue(value);return mode?.locked||false;}
function initializeModelPicker(options){const menu=document.getElementById(options.menuId);const triggerBtn=document.getElementById(options.triggerBtnId);const currentLabel=document.getElementById(options.currentLabelId);if(!menu||!triggerBtn||!currentLabel){console.error('Model picker elements not found');return;}
let allMenuItems=[];let scrollContainer;let previousFocus=null;function populateMenu(){if(!menu)
return;menu.innerHTML='';allMenuItems=[];const searchContainer=document.createElement("div");searchContainer.className="chat-history-search-container";searchContainer.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 16px 16px 25px;
      background: linear-gradient(
        to bottom,
        rgba(21,16,38,1) 0%,
        rgba(21,16,38,1) 55%,
        rgba(21,16,38,0.95) 70%,
        rgba(21,16,38,0.7) 80%,
        rgba(21,16,38,0.3) 90%,
        rgba(21,16,38,0) 100%
      );
      z-index: 2;
      pointer-events: auto;
    `;searchContainer.innerHTML=`
      <div class="chat-history-search-wrapper">
        <input type="text" class="chat-history-search-input" id="modelSearchInput" placeholder="Search models..." autocomplete="off" spellcheck="false">
        <div class="chat-history-search-icon">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="6.5" cy="6.5" r="5.5" stroke="currentColor" stroke-width="2"></circle>
            <path d="M10.5 10.5L14 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
          </svg>
        </div>
        <button class="chat-history-search-clear" id="modelSearchClear" style="display: none;" aria-label="Clear search">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
          </svg>
        </button>
      </div>
    `;scrollContainer=document.createElement("div");scrollContainer.className="chat-mode-menu-scroll";scrollContainer.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 68px 8px 8px 8px;
      display: flex;
      flex-direction: column;
    `;menu.appendChild(scrollContainer);menu.appendChild(searchContainer);const searchInput=menu.querySelector("#modelSearchInput");const clearButton=menu.querySelector("#modelSearchClear");const searchIcon=menu.querySelector(".chat-history-search-icon");const savedMode=modelState.getModel();const canUseGenius=getUserHasPro();allChatModes.forEach((mode)=>{const item=document.createElement("div");item.className="chat-mode-menu-item";if(mode.value===savedMode){item.classList.add('selected');}
const shouldBeLocked=mode.locked&&!canUseGenius;if(shouldBeLocked){item.classList.add('chat-mode-locked');}
if(shouldBeLocked){const lockIcon=document.createElement("img");lockIcon.src="/static/images/lock-icon.png";lockIcon.style.cssText='width: 16px; height: 16px; margin-right: 8px; opacity: 0.6;';lockIcon.alt="Pro subscription required";item.appendChild(lockIcon);}
const modelName=document.createElement("span");modelName.textContent=mode.label;modelName.style.cssText='flex: 1;';item.appendChild(modelName);if(mode.locked){const geniusBadge=document.createElement("span");geniusBadge.innerHTML=' Genius';geniusBadge.style.cssText='background-color: #CBA8FF; color: #552896; padding: 3px 8px; border-radius: 12px; font-size: 12px; white-space: nowrap; flex-shrink: 0;';item.appendChild(geniusBadge);}
item.addEventListener("click",(e)=>{if(mode.locked&&!canUseGenius){e.stopPropagation();openSubscription();return;}
modelState.setModel(mode.value);currentLabel.textContent=mode.label;menu.querySelectorAll('.chat-mode-menu-item').forEach(el=>el.classList.remove('selected'));item.classList.add('selected');menu.style.display='none';triggerBtn.classList.remove('open');triggerBtn.classList.remove('menu-below');if(previousFocus instanceof HTMLElement&&previousFocus!==document.body)
previousFocus.focus();previousFocus=null;if(options.onSelect){options.onSelect(mode.value);}});scrollContainer.appendChild(item);allMenuItems.push({element:item,mode});});if(searchInput&&clearButton&&searchIcon){searchInput.addEventListener("input",(e)=>{const query=e.target.value.toLowerCase();filterMenuItems(query);clearButton.style.display=query.length>0?"flex":"none";searchIcon.style.display=query.length>0?"none":"flex";});clearButton.addEventListener("click",()=>{searchInput.value="";filterMenuItems("");clearButton.style.display="none";searchIcon.style.display="flex";});searchInput.addEventListener("keydown",(e)=>{if(e.key==="Escape"){menu.style.display='none';triggerBtn.classList.remove('open');triggerBtn.classList.remove('menu-below');if(previousFocus instanceof HTMLElement&&previousFocus!==document.body)
previousFocus.focus();previousFocus=null;}});}}
function filterMenuItems(query){allMenuItems.forEach(({element,mode})=>{const matches=mode.label.toLowerCase().includes(query)||mode.value.toLowerCase().includes(query);element.style.display=matches?'flex':'none';});}
if(triggerBtn.dataset.pickerBound==='true'){populateMenu();return;}
triggerBtn.dataset.pickerBound='true';menu.addEventListener('click',(e)=>{e.stopPropagation();},{capture:false});triggerBtn.addEventListener("pointerdown",()=>{const opening=!(triggerBtn.classList.contains('open')||menu.style.display==='flex');if(opening)
previousFocus=document.activeElement;});const onTriggerClick=(e)=>{e.stopPropagation();const isOpen=menu.style.display==='flex';if(isOpen){menu.style.display='none';triggerBtn.classList.remove('open');triggerBtn.classList.remove('menu-below');if(previousFocus instanceof HTMLElement&&previousFocus!==document.body)
previousFocus.focus();previousFocus=null;}
else{populateMenu();if(document.getElementById('heroChatBox')){menu.style.bottom='auto';menu.style.top='calc(100% + 8px)';triggerBtn.classList.add('menu-below');}
else{menu.style.top='auto';menu.style.bottom='calc(100% + 8px)';triggerBtn.classList.remove('menu-below');}
menu.style.display='flex';triggerBtn.classList.add('open');setTimeout(()=>{const rect=menu.getBoundingClientRect();const buttonRect=triggerBtn.getBoundingClientRect();if(document.getElementById('heroChatBox')){if(rect.bottom>window.innerHeight){const availableHeight=window.innerHeight-buttonRect.bottom-20;menu.style.height=`${Math.min(availableHeight, 600)}px`;}}
else{if(rect.top<0){const availableHeight=buttonRect.top-20;menu.style.height=`${Math.min(availableHeight, 600)}px`;}}
const searchInput=menu.querySelector("#modelSearchInput");searchInput?.focus();},10);}};triggerBtn.addEventListener('click',onTriggerClick,{capture:false});if(!menu.__outsideListenerBound){const outsideClickHandler=(e)=>{const isOpen=menu.style.display==='flex'||triggerBtn.classList.contains('open');if(!isOpen)
return;const t=e.target;if(menu.contains(t)||triggerBtn.contains(t))
return;menu.style.display='none';triggerBtn.classList.remove('open');triggerBtn.classList.remove('menu-below');const clickedFocusable=!!t.closest('a,button,input,textarea,select,[tabindex]:not([tabindex="-1"])');if(!clickedFocusable&&previousFocus instanceof HTMLElement&&previousFocus!==document.body)
previousFocus.focus();previousFocus=null;};document.addEventListener("click",outsideClickHandler);menu.__outsideListenerBound=true;}
const savedMode=modelState.getModel();const selectedMode=findModelByValue(savedMode);if(selectedMode){currentLabel.textContent=selectedMode.label;}
modelState.subscribe((model)=>{const mode=findModelByValue(model);if(mode&&currentLabel){currentLabel.textContent=mode.label;}});}
const ModelConfig={initializeModelPicker,getDefaultModel,getSelectedModel:()=>modelState.getModel(),setSelectedModel:(model)=>modelState.setModel(model),isModelLocked};;;async function uploadChatAttachment(file){const formData=new FormData();formData.append('file',file);const response=await fetch(app_base_url+'/chat_attachments/upload',{method:'POST',credentials:'include',body:formData,});const data=await response.json();if(!data.success||!data.attachment){throw new Error(data.error||'Upload failed');}
return data.attachment;}
async function getChatAttachment(uuid){const response=await fetch(app_base_url+`/chat_attachments/get?uuid=${encodeURIComponent(uuid)}`,{method:'GET',credentials:'include',});const data=await response.json();if(!data.success||!data.attachment){throw new Error(data.error||'Failed to get attachment');}
return data.attachment;}
function formatFileSize(bytes){if(bytes===0)
return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return Math.round((bytes/Math.pow(k,i))*100)/100+' '+sizes[i];}
function getFileTypeIcon(contentType){if(contentType.startsWith('image/'))
return'';if(contentType==='application/pdf')
return'';if(contentType.startsWith('text/'))
return'';if(contentType.includes('word')||contentType.includes('document'))
return'';if(contentType.includes('spreadsheet')||contentType.includes('excel'))
return'';if(contentType.includes('presentation')||contentType.includes('powerpoint'))
return'';return'';}
function createAttachmentPreview(attachment){const preview=document.createElement('div');preview.className='upload-preview-container';preview.setAttribute('data-attachment-uuid',attachment.uuid);preview.setAttribute('data-file-name',attachment.original_filename);preview.title=attachment.original_filename;if(attachment.content_type.startsWith('image/')&&attachment.download_url){const img=document.createElement('img');img.className='preview-image';img.src=attachment.download_url;img.alt=attachment.original_filename;preview.appendChild(img);}
else{const indicator=document.createElement('div');indicator.className='text-file-indicator';indicator.textContent=attachment.original_filename;preview.appendChild(indicator);}
const closeButton=document.createElement('button');closeButton.className='close-button';closeButton.innerHTML='';closeButton.onclick=(e)=>{e.preventDefault();e.stopPropagation();preview.remove();};preview.appendChild(closeButton);return preview;}
function createUploadingPreview(file,tempId){const preview=document.createElement('div');preview.className='upload-preview-container uploading';preview.setAttribute('data-temp-id',tempId);preview.setAttribute('data-file-name',file.name);preview.title=file.name;const indicator=document.createElement('div');indicator.className='text-file-indicator uploading-indicator';indicator.textContent='...';preview.appendChild(indicator);return preview;}
function getCurrentAttachmentUUIDs(){const container=document.getElementById('chatAttachmentsContainer');if(!container)
return[];const previews=container.querySelectorAll('[data-attachment-uuid]');const uuids=[];previews.forEach((el)=>{const uuid=el.getAttribute('data-attachment-uuid');if(uuid)
uuids.push(uuid);});return uuids;}
function getAllConversationAttachmentUUIDs(){const allUUIDs=[];const seen=new Set();document.querySelectorAll('.chatbox-wrapper[data-attachment-uuids]').forEach((wrapper)=>{const uuidsJson=wrapper.getAttribute('data-attachment-uuids');if(uuidsJson){try{const uuids=JSON.parse(uuidsJson);uuids.forEach(uuid=>{if(!seen.has(uuid)){seen.add(uuid);allUUIDs.push(uuid);}});}
catch(e){console.error('Failed to parse attachment UUIDs:',e);}}});getCurrentAttachmentUUIDs().forEach(uuid=>{if(!seen.has(uuid)){seen.add(uuid);allUUIDs.push(uuid);}});return allUUIDs;}
function clearAttachments(){const container=document.getElementById('chatAttachmentsContainer');if(container){container.innerHTML='';}}
function createMessageAttachmentItem(attachment){const container=document.createElement('div');container.className='message-attachment-square';container.setAttribute('data-attachment-uuid',attachment.uuid);container.title=attachment.original_filename;if(attachment.content_type.startsWith('image/')&&attachment.download_url){const img=document.createElement('img');img.src=attachment.download_url;img.alt=attachment.original_filename;img.className='chat-image';img.style.display='block';container.appendChild(img);}
else{const icon=document.createElement('div');icon.className='attachment-icon';icon.textContent=getFileTypeIcon(attachment.content_type);container.appendChild(icon);const name=document.createElement('div');name.className='attachment-name';name.textContent=attachment.original_filename;container.appendChild(name);}
if(!attachment.content_type.startsWith('image/')&&attachment.download_url){container.style.cursor='pointer';container.onclick=()=>window.open(attachment.download_url,'_blank');}
return container;}
async function renderMessageAttachments(uuids){if(!uuids||uuids.length===0)
return null;const attachmentPromises=uuids.map(uuid=>getChatAttachment(uuid).catch(err=>{console.error(`Failed to load attachment ${uuid}:`,err);return null;}));const attachments=await Promise.all(attachmentPromises);const validAttachments=attachments.filter((a)=>a!==null);return renderMessageAttachmentsFromData(validAttachments);}
function renderMessageAttachmentsFromData(attachments){if(!attachments||attachments.length===0)
return null;const grid=document.createElement('div');grid.className='message-attachments-grid';const cols=Math.min(attachments.length,3);grid.style.gridTemplateColumns=`repeat(${cols}, 80px)`;for(const attachment of attachments){grid.appendChild(createMessageAttachmentItem(attachment));}
return grid;};const characterEnabled=Boolean(window.characterEnabled);const THRAD_API_KEY='sk_1a87affa7f37493888bb8c8d3adbd537EkTrjHFs0K7VIfyuMSy9wg';const THRAD_ENDPOINT='https://ssp.thrads.ai/api/v1/ssp/bid-request';const THRAD_DEBUG_MODE=new URLSearchParams(window.location.search).get('THRAD_DEBUG_MODE')==='true';function toggleChips(){const hiddenChips=document.querySelectorAll('.hidden-chip');const moreChip=document.getElementById('more-chip');for(let i=0;i<hiddenChips.length;i++){hiddenChips[i].style.display='inline-flex';}
if(moreChip){moreChip.style.display='none';}}
function toggleChatPresets(){const modelChips=document.querySelectorAll('.chat-model-chip');const presetChips=document.querySelectorAll('.chat-preset-chip');const toggleButton=document.getElementById('chat-presets-toggle');const presetsVisible=presetChips[0]&&presetChips[0].style.display!=='none';if(presetsVisible){modelChips.forEach(chip=>chip.style.display='inline-flex');presetChips.forEach(chip=>chip.style.display='none');if(toggleButton)
toggleButton.textContent='Chat Presets';}
else{modelChips.forEach(chip=>chip.style.display='none');presetChips.forEach(chip=>chip.style.display='inline-flex');if(toggleButton)
toggleButton.textContent='AI Models';}}
const createButton=(innerText,attributes,onClick)=>{const button=document.createElement("button");button.textContent=innerText;for(const[attr,value]of Object.entries(attributes)){button.setAttribute(attr,value);}
button.addEventListener("click",onClick);return button;};const newDeleteButton=()=>createButton("Delete",{class:'deleteBoxButton',type:'button'},function(event){event.stopPropagation();let deletable=this.closest(".chatbox-wrapper, .outputBox");if(!deletable)
return console.error('delete button is outside of a chatbox or outputbox');detachMaquetteProjectors(deletable);deletable.remove();const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.focus();}
try{saveChatHistory();}
catch(e){console.log("Error saving chat history after deleting message",e);}
chatModifiedSinceLoad=true;});const newSummarizeButton=()=>createButton("Summarize",{class:'summarizetextButton',id:'sumButtonId'},(event)=>{let outputElement=event.target.closest(".outputBox");if(!outputElement)
return console.error('summarize button is outside of an outputbox');let outputText=getTextFromDiv(outputElement).replace(/[\*#]+/g,'');var summarizePrompt="Summarize the following text: ";var combinedText=summarizePrompt+outputText;summarizeSubmit(combinedText);toast('summarypopup');});const newCopyTextButton=()=>createButton("Copy",{class:'copytextButton',type:'button'},(event)=>{let outputElement=event.target.closest(".outputBox");if(!outputElement)
return console.error('copy text button is outside of an outputbox');let outputText=getTextFromDiv(outputElement);navigator.clipboard.writeText(outputText);toast('copypopup');});const newDownloadButton=(imageUrl)=>createButton("Download",{class:'copytextButton',type:'button'},(event)=>{const a=document.createElement('a');a.href=imageUrl;a.download='';document.body.appendChild(a);a.click();document.body.removeChild(a);});async function dataUrlToBlob(dataUrl){const response=await fetch(dataUrl);return await response.blob();}
async function maybeHandleImageTool(fsPayload,outputBox){try{const obj=JSON.parse(fsPayload);const fc=obj&&obj.function_call;if(!fc||(fc.name!=='generate_image'&&fc.name!=='edit_image'))
return false;let args={};try{args=JSON.parse(fc.arguments||'{}');}
catch{}
const prompt=(args?.prompt||'').toString().trim();if(!prompt)
return false;const md=outputBox.querySelector('.markdownContainer');if(!md)
return false;const hiddenTextContainer=outputBox.querySelector('.hiddenTextContainer');if(hiddenTextContainer){hiddenTextContainer.textContent='';delete hiddenTextContainer.dataset.newContent;}
const isEditMode=fc.name==='edit_image';const spinner=document.createElement('div');spinner.className='results-loading';spinner.innerHTML=`<div style="margin-top:18px;"><span class="thinking-text">${isEditMode ? 'Editing image' : 'Generating image'}</span>`+`<span class="thinking-dots"></span></div>`;outputBox.insertBefore(spinner,md);const fd=new FormData();fd.append('text',prompt);let endpoint='text2img';if(isEditMode){const convo=document.getElementById('convo');const images=convo?convo.querySelectorAll('.generated-chat-image, .chat-image'):null;if(!images||images.length===0){spinner.remove();console.error('No image found to edit.');const errorDiv=document.createElement('div');errorDiv.style.color='red';errorDiv.textContent='Error: No image found to edit. Please generate or upload an image first.';md.appendChild(errorDiv);return true;}
const numImages=Math.min(Math.max(1,parseInt(args?.num_input_images||args?.num_images)||1),3);const recentImages=Array.from(images).slice(-numImages);const imageKeys=['image','image2','image3'];for(let i=0;i<recentImages.length;i++){const img=recentImages[i];const imageKey=imageKeys[i];if(!img.src)
continue;if(img.src.startsWith('data:')){try{const blob=await dataUrlToBlob(img.src);fd.append(imageKey,blob,`${imageKey}.png`);}
catch(error){spinner.remove();console.error(`Failed to convert data URL to blob for ${imageKey}:`,error);const errorDiv=document.createElement('div');errorDiv.style.color='red';errorDiv.textContent='Error: Failed to process image. Please try again.';md.appendChild(errorDiv);return true;}}
else{fd.append(imageKey,img.src);}}
const selectedMode=sessionStorage.getItem("selectedChatMode")||"standard";if(typeof ModelConfig!=='undefined'&&ModelConfig.isModelLocked(selectedMode)){fd.append('image_generator_version','genius');}
endpoint='image-editor';}
else{const aspectRatioMap={'16:9':[832,448],'4:3':[768,576],'1:1':[640,640],'3:4':[576,768],'9:16':[448,832],};const aspectRatio=(args?.aspect_ratio||'1:1').toString().trim();const[width,height]=aspectRatioMap[aspectRatio]||[640,640];fd.append('width',width.toString());fd.append('height',height.toString());fd.append('image_generator_version','hd');fd.append('quality','true');}
imageAbortController=new AbortController();const resp=await fetch(`${app_base_url}/api/${endpoint}`,{method:'POST',headers:{'api-key':generateTryitApiKey()},body:fd,credentials:'include',signal:imageAbortController.signal,});const json=await resp.json();spinner.remove();if(resp.status===401||json?.status==='anonymous try it exceeded'){console.error('Anonymous try-it limit exceeded:',json);openSubscription();const errorDiv=document.createElement('div');errorDiv.style.color='red';errorDiv.textContent='You have reached the anonymous limit. Please log in to continue using image generation.';md.appendChild(errorDiv);return true;}
const url=json?.share_url||json?.output_url;if(!url){console.error('No image URL returned from API:',json);const errorDiv=document.createElement('div');errorDiv.style.color='red';errorDiv.textContent='Error: Image generation failed. Please try again.';md.appendChild(errorDiv);return true;}
const img=document.createElement('img');img.src=url;img.className='generated-chat-image';md.appendChild(img);const options=outputBox.querySelector('.optionsBox');if(options){options.innerHTML='';const downloadButton=newDownloadButton(url);const deleteButton=newDeleteButton();const group1=document.createElement('div');group1.className='group1';const group2=document.createElement('div');group2.className='group2';group1.appendChild(downloadButton);group2.appendChild(deleteButton);options.appendChild(group1);options.appendChild(group2);}
imageAbortController=null;const loggedIn=typeof window.userIsLoggedIn==='function'&&window.userIsLoggedIn();const payload=loggedIn?{type:'generated_image',prompt,url}:{type:'generated_image',prompt};outputBox.dataset.generatedImage=JSON.stringify(payload);if(isEditMode){const attachmentsContainer=document.getElementById('chatAttachmentsContainer');if(attachmentsContainer){attachmentsContainer.innerHTML='';}}
try{await saveChatHistory();}
catch{}
return true;}
catch(e){console.error('Error in maybeHandleImageTool:',e);imageAbortController=null;return false;}}
async function handleFileUpload(inputFiles){const attachmentsContainer=document.getElementById('chatAttachmentsContainer');if(!attachmentsContainer){console.error("Chat attachments container not found.");return;}
const files=Array.from(inputFiles);if(!files.length)
return;const currentCount=getCurrentAttachmentUUIDs().length;if(currentCount+files.length>10){toast('upload-too-many');return;}
const MAX_FILE_SIZE=100*1024*1024;for(const file of files){if(file.size>MAX_FILE_SIZE){toast('big-file-type',`File "${file.name}" exceeds 100MB limit`);return;}}
for(const file of files){const tempId=`temp-${Date.now()}-${Math.random()}`;const uploadingPreview=createUploadingPreview(file,tempId);attachmentsContainer.appendChild(uploadingPreview);try{const attachment=await uploadChatAttachment(file);const actualPreview=createAttachmentPreview(attachment);uploadingPreview.replaceWith(actualPreview);}
catch(error){console.error('Failed to upload attachment:',error);toast('upload-unsuccessful');uploadingPreview.remove();}}
const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.focus();}}
const ALLOWED_MIME_TYPES=new Set(['image/png','image/jpeg','image/webp','image/gif','image/avif','application/pdf','application/vnd.openxmlformats-officedocument.wordprocessingml.document','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/vnd.openxmlformats-officedocument.presentationml.presentation','text/plain','text/csv','text/markdown','application/json',]);const isAllowedFile=(file)=>ALLOWED_MIME_TYPES.has(file.type);window.addEventListener('paste',(event)=>{if(characterEnabled)
return;const files=[];let rejected=false;for(const item of Array.from(event.clipboardData.items)){if(item.kind!=='file')
continue;const file=item.getAsFile();if(file&&isAllowedFile(file)){files.push(file);}
else{rejected=true;}}
if(rejected)
toast('bad-file-type');if(files.length){event.preventDefault();void handleFileUpload(files);}});const dragOverlay=document.createElement('div');dragOverlay.id='drag-overlay';dragOverlay.style.display='none';document.body.appendChild(dragOverlay);window.addEventListener('dragover',(event)=>{if(characterEnabled)
return;event.preventDefault();dragOverlay.style.display='block';});window.addEventListener('dragleave',(event)=>{if(characterEnabled)
return;if(event.relatedTarget===null||!document.body.contains(event.relatedTarget)){dragOverlay.style.display='none';}});window.addEventListener('drop',(event)=>{dragOverlay.style.display='none';if(characterEnabled)
return;event.preventDefault();const dtFiles=Array.from(event.dataTransfer.files);const accepted=[];let rejected=false;dtFiles.forEach(file=>{if(isAllowedFile(file)){accepted.push(file);}
else{rejected=true;}});if(rejected)
toast('bad-file-type');if(accepted.length)
void handleFileUpload(accepted);});const attachBtn=document.getElementById('attachFileButton');const attachInput=document.getElementById('chatAttachmentInput');if(attachBtn&&attachInput){attachBtn.addEventListener('click',()=>attachInput.click());attachInput.addEventListener('change',()=>{if(attachInput.files?.length){void handleFileUpload(attachInput.files);}
attachInput.value='';});}
const newSaveNGoButton=()=>createButton("Save & Go",{class:"chatEditSubmitButton",disabled:"true"},(event)=>{let chatboxWrapper=event.target.closest('.chatbox-wrapper');const imgElement=chatboxWrapper?.querySelector('.chat-image');handleImageAndSubmit(chatboxWrapper,imgElement);});const newCancelEditButton=()=>createButton("Cancel",{class:"chatEditCancelButton"},(event)=>{let chatboxWrapper=event.target.closest('.chatbox-wrapper');let chatbox=chatboxWrapper.firstElementChild;chatbox.value=chatBoxUneditedText[chatboxWrapper.id];delete chatboxWrapper.dataset.edited;const textarea=chatboxWrapper.querySelector('textarea');if(textarea){adjustTextareaHeight(textarea);}});function handleImageAndSubmit(chatboxWrapper,imgElements){const imgArray=imgElements instanceof NodeList?Array.from(imgElements):(imgElements?[imgElements]:[]);const attachmentsContainer=document.getElementById('chatAttachmentsContainer');if(imgArray.length>0&&attachmentsContainer){let processedCount=0;imgArray.forEach((imgElement,index)=>{const attachmentContainer=imgElement.closest('[data-attachment-uuid]');const existingUUID=attachmentContainer?.getAttribute('data-attachment-uuid');if(existingUUID){getChatAttachment(existingUUID).then((attachment)=>{const preview=createAttachmentPreview(attachment);attachmentsContainer.appendChild(preview);}).catch((err)=>{console.error('Failed to get existing attachment:',err);}).finally(()=>{processedCount++;if(processedCount===imgArray.length){chatReSubmit(chatboxWrapper);}});}
else{if(imgElement.src.startsWith('data:')){dataUrlToBlob(imgElement.src).then((blob)=>{const tempFile=new File([blob],`regenerate_image_${index}.png`,{type:blob.type,lastModified:Date.now()});return uploadChatAttachment(tempFile);}).then((attachment)=>{const preview=createAttachmentPreview(attachment);attachmentsContainer.appendChild(preview);}).catch((err)=>{console.error('Failed to upload image for regeneration:',err);}).finally(()=>{processedCount++;if(processedCount===imgArray.length){chatReSubmit(chatboxWrapper);}});}
else{fetch(imgElement.src).then(res=>res.blob()).then((blob)=>{const tempFile=new File([blob],`regenerate_image_${index}.png`,{type:blob.type,lastModified:Date.now()});return uploadChatAttachment(tempFile);}).then((attachment)=>{const preview=createAttachmentPreview(attachment);attachmentsContainer.appendChild(preview);}).catch((err)=>{console.error('Failed to fetch and upload image:',err);}).finally(()=>{processedCount++;if(processedCount===imgArray.length){chatReSubmit(chatboxWrapper);}});}}});}
else{chatReSubmit(chatboxWrapper);}}
const newRegenerateButton=()=>createButton("Regenerate",{class:'deleteBoxButton',type:'button'},function(event){event.stopPropagation();let chatboxWrapper=this.closest(".chatbox-wrapper");if(!chatboxWrapper)
return console.error('Regenerate button is outside of a chatbox');const imgElements=chatboxWrapper.querySelectorAll('.chat-image');handleImageAndSubmit(chatboxWrapper,imgElements);});function newChatBox(content=""){let temp=document.createElement("template");temp.innerHTML+=`
        <div class="chatbox-wrapper" id="${uuidv4().slice(-10)}">
            <textarea class="chatbox" placeholder="Edit Message..." rows="10" cols="50"></textarea>
            <div class="chatImageBox"><!-- images go here --></div>
            <div class="chatoptionsBox"><!-- buttons go here --></div>
            <div class="uploadoptionsBox"><!-- upload buttons go here --></div>
            <div class="editsBox"><!--save & go, cancel buttons--></div>
        </div>`;let chatboxWrapper=temp.content.firstElementChild;let chatbox=chatboxWrapper.querySelector('textarea');chatbox.textContent=content;chatboxWrapper.querySelector('.chatoptionsBox').append(newRegenerateButton(),newDeleteButton());if(content){chatboxWrapper.querySelector('.editsBox').append(newSaveNGoButton(),newCancelEditButton());chatbox.addEventListener("focus",textAreaFocusHandler);chatbox.addEventListener("blur",textAreaBlurHandler);chatboxWrapper.addEventListener("keypress",editedtextAreaKeyPressHandler);}
else{chatboxWrapper.addEventListener("keypress",textAreaKeyPressHandler);optimizeChatPromptBox(chatboxWrapper);}
return chatboxWrapper;}
function textAreaKeyPressHandler(e){if(e.keyCode==13&&!e.shiftKey){e.preventDefault();chatSubmit('','',true);}}
function editedtextAreaKeyPressHandler(e){if(e.keyCode==13&&!e.shiftKey){e.preventDefault();let chatboxWrapper=e.target.closest('.chatbox-wrapper');chatReSubmit(chatboxWrapper);}}
const newOutputBox=(content="")=>{let temp=document.createElement("template");let[messageText,messageJSON]=content.includes('\u001C')?content.split('\u001C'):[content,undefined];console.log("new outputbox",{messageText,messageJSON});temp.innerHTML+=`
        <div class="outputBox" id="${uuidv4().slice(-10)}">
            <div class="markdownContainer"></div>
            <span data-new-content="true" class="hiddenTextContainer"></span>
        </div>`;const outputBox=temp.content.querySelector('.outputBox');const hiddenTextContainer=outputBox.querySelector('.hiddenTextContainer');hiddenTextContainer.textContent=messageText;if(messageJSON){try{const parsed=JSON.parse(messageJSON);if(parsed&&parsed.type==='generated_image'){outputBox.dataset.generatedImage=messageJSON;const md=outputBox.querySelector('.markdownContainer');if(parsed.url){md.innerHTML=`<img src="${parsed.url}" class="generated-chat-image">`;hiddenTextContainer.textContent='';hiddenTextContainer.removeAttribute('data-new-content');outputBox.dataset.imageNeedsButtons='true';outputBox.dataset.imageUrl=parsed.url;}
else{md.innerHTML=`<p style="color:#888;margin:12px 0 0;">Image not saved; log in before generating to save future images.</p>`;hiddenTextContainer.textContent='';hiddenTextContainer.removeAttribute('data-new-content');}}
else{const results=drawResults(parsed);if(results){const markdownContainer=outputBox.querySelector('.markdownContainer');outputBox.insertBefore(results,markdownContainer);outputBox.dataset.hasResults='true';}}}
catch(e){console.error("failed to attach JSON payload",e);}}
const optionsBox=document.createElement('div');optionsBox.className='optionsBox';const group1=document.createElement('div');group1.className='group1';const group2=document.createElement('div');group2.className='group2';if(outputBox.dataset.imageNeedsButtons==='true'){const imageUrl=outputBox.dataset.imageUrl;group1.append(newDownloadButton(imageUrl));group2.append(newDeleteButton());delete outputBox.dataset.imageNeedsButtons;delete outputBox.dataset.imageUrl;}
else{group1.append(newCopyTextButton());group2.append(newSummarizeButton(),newDeleteButton());}
optionsBox.append(group1,group2);outputBox.appendChild(optionsBox);if(characterEnabled){const figureImg=document.querySelector('.figure');if(figureImg){outputBox.classList.add('has-character-avatar');const markdownContainer=outputBox.querySelector('.markdownContainer');const avatarContainer=document.createElement('div');avatarContainer.className='character-avatar-container';const img=document.createElement('img');img.src=figureImg.src;img.alt=figureImg.alt||'Character';img.className='character-avatar';avatarContainer.appendChild(img);markdownContainer.insertBefore(avatarContainer,markdownContainer.firstChild);}}
return temp.content.firstElementChild;};let chatBoxUneditedText={};const maxChips=3;function concatUint8Array(arrayOne,arrayTwo){var mergedArray=new Uint8Array(arrayOne.length+arrayTwo.length);mergedArray.set(arrayOne);mergedArray.set(arrayTwo,arrayOne.length);return mergedArray;}
function Utf8ArrayToStr(array){let out="";const len=array.length;for(let i=0;i<len;){const c=array[i++];if((c>>7)===0){out+=String.fromCharCode(c);}
else if((c>>5)===0x6){const char2=array[i++];out+=String.fromCharCode(((c&0x1F)<<6)|(char2&0x3F));}
else if((c>>4)===0xE){const char2=array[i++];const char3=array[i++];out+=String.fromCharCode(((c&0x0F)<<12)|((char2&0x3F)<<6)|(char3&0x3F));}
else if((c>>3)===0x1E){const char2=array[i++];const char3=array[i++];const char4=array[i++];const codePoint=(((c&0x07)<<18)|((char2&0x3F)<<12)|((char3&0x3F)<<6)|(char4&0x3F))-0x10000;out+=String.fromCharCode((codePoint>>10)+0xD800,(codePoint&0x3FF)+0xDC00);}}
return out;}
function getFullChatHistoryObject(){const chatHistory=[];const allElements=document.querySelectorAll(".chatbox-wrapper, .outputBox");Array.from(allElements).forEach(element=>{if(element.classList.contains('chatbox-wrapper')){const textarea=element.querySelector('textarea');if(textarea){const chatBoxText=textarea.value.trim();if(chatBoxText){const message={"role":"user","content":chatBoxText};const attachmentData=element.getAttribute('data-attachment-uuids');if(attachmentData){try{message.attachment_uuids=JSON.parse(attachmentData);}
catch(e){console.error('Failed to parse attachment UUIDs:',e);}}
chatHistory.push(message);}}}
else if(element.classList.contains('outputBox')){let outputBoxText=getTextFromDiv(element);let outputBoxJSON=getJSONFromDiv(element);chatHistory.push({"role":"assistant","content":outputBoxJSON?outputBoxText+'\u001C'+outputBoxJSON:outputBoxText});}});return chatHistory;}
function getChatHistoryObject(){const chatHistory=getFullChatHistoryObject();chatHistory.splice(0,chatHistory.length-30);return chatHistory;}
function textAreaFocusHandler(event){let chatboxWrapper=event.target.closest('.chatbox-wrapper');if(!chatboxWrapper){console.error("textAreaFocusHandler: Could not find '.chatbox-wrapper' for target:",event.target);return;}
if(!chatboxWrapper.id){console.error("textAreaFocusHandler: chatboxWrapper is missing an ID:",chatboxWrapper);return;}
if(!chatboxWrapper.dataset.edited){chatboxWrapper.dataset.edited='true';const firstChild=chatboxWrapper.firstElementChild;const valueToStore=firstChild&&typeof firstChild.value==='string'?firstChild.value:'';chatBoxUneditedText[chatboxWrapper.id]=valueToStore;const saveButton=chatboxWrapper.querySelector('.chatEditSubmitButton');if(saveButton){const textarea=chatboxWrapper.querySelector('.chatbox');if(textarea){const currentText=typeof textarea.value==='string'?textarea.value.trim():'';const originalStoredValue=chatBoxUneditedText[chatboxWrapper.id];const originalText=typeof originalStoredValue==='string'?originalStoredValue.trim():'';saveButton.disabled=!currentText||currentText===originalText;}
else{console.error("textAreaFocusHandler: Could not find '.chatbox' textarea inside wrapper:",chatboxWrapper);}}}}
function textAreaBlurHandler(event){let chatboxWrapper=event.target.closest('.chatbox-wrapper');if(event.relatedTarget&&event.relatedTarget.classList.contains("chatEditSubmitButton")){return;}
if(chatBoxUneditedText[chatboxWrapper.id]===chatboxWrapper.firstElementChild.value){delete chatboxWrapper.dataset.edited;}}
function toast(toastElementId,message,toastInterval=3000){const toastElement=document.getElementById(toastElementId);if(toastElement){const messageElement=toastElement.querySelector('.message');if(messageElement){const defaultMessage=messageElement.textContent;if(message){messageElement.textContent=message;}
toastElement.classList.add("show");setTimeout(()=>{toastElement.classList.remove("show");messageElement.textContent=defaultMessage;},toastInterval);}
else{console.warn(`Message element not found in ${toastElementId}.`);}}
else{console.warn(`Element with ID ${toastElementId} not found.`);}}
let abortController=null;let imageAbortController=null;function drawResults(webSearchResults){let resultsCount=webSearchResults.length;if(!resultsCount)
return null;let temp=document.createElement('template');temp.innerHTML+=`
    <div class='results-wrapper'>
      <div class='results-tabs'>
        <button class='results-tab active' data-tab='results'>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tab-icon">
            <path d="M2 4h12M2 8h12M2 12h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Web Results</span>
        </button>
        <button class='results-tab' data-tab='sources'>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tab-icon">
            <circle cx="4" cy="4" r="2" fill="currentColor"/>
            <circle cx="12" cy="4" r="2" fill="currentColor"/>
            <circle cx="4" cy="12" r="2" fill="currentColor"/>
            <circle cx="12" cy="12" r="2" fill="currentColor"/>
          </svg>
          <span>Sources</span>
          <span class='sources-badge'>${resultsCount}</span>
        </button>
      </div>

      <div class='tab-content active' data-content='results'>
        <div class='compact-sources-grid'></div>
      </div>

      <div class='tab-content' data-content='sources'>
        <div class='expanded-sources-list'></div>
      </div>
    </div>`;let compactGrid=temp.content.querySelector('.compact-sources-grid');let expandedList=temp.content.querySelector('.expanded-sources-list');let tabs=temp.content.querySelectorAll('.results-tab');let tabContents=temp.content.querySelectorAll('.tab-content');let resultsWrapper=temp.content.querySelector('.results-wrapper');const maxVisible=3;webSearchResults.slice(0,maxVisible).forEach(({url,title},index)=>{const hostname=new URL(url).hostname;const domain=hostname.replace('www.','');const truncatedTitle=title.length>50?title.substring(0,50)+'...':title;const sourceCard=document.createElement('a');sourceCard.className='compact-source-card';sourceCard.href=url;sourceCard.target='_blank';sourceCard.innerHTML=`
      <div class='source-card-content'>
        <img src='https://www.google.com/s2/favicons?sz=64&domain=${hostname}' class='source-favicon' alt='favicon'>
        <div class='source-info'>
          <div class='source-title'></div>
          <div class='source-domain'></div>
        </div>
      </div>
      <svg class="source-link-icon" width="14" height="14" viewBox="0 0 14 14" fill="none">
        <path d="M10.5 7.5L10.5 10.5C10.5 11.0523 10.0523 11.5 9.5 11.5L3.5 11.5C2.94772 11.5 2.5 11.0523 2.5 10.5L2.5 4.5C2.5 3.94772 2.94772 3.5 3.5 3.5L6.5 3.5M8 2.5L11.5 2.5M11.5 2.5L11.5 6M11.5 2.5L6.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>`;sourceCard.querySelector('.source-title').textContent=truncatedTitle;sourceCard.querySelector('.source-domain').textContent=domain;compactGrid.append(sourceCard);});if(resultsCount>maxVisible){const remainingCount=resultsCount-maxVisible;const showMoreBtn=document.createElement('button');showMoreBtn.className='show-more-sources-btn';showMoreBtn.textContent=`+ ${remainingCount} source${remainingCount > 1 ? 's' : ''}`;showMoreBtn.setAttribute('data-switch-to-sources','true');compactGrid.append(showMoreBtn);}
webSearchResults.forEach(({description,title,url,aiSnippets},index)=>{const hostname=new URL(url).hostname;const domain=hostname.replace('www.','');const expandedCard=document.createElement('a');expandedCard.className='expanded-source-card';expandedCard.href=url;expandedCard.target='_blank';expandedCard.dataset.aiSnippets=aiSnippets;expandedCard.innerHTML=`
      <div class='expanded-header'>
        <img src='https://www.google.com/s2/favicons?sz=64&domain=${hostname}' class='expanded-favicon' alt='favicon'>
        <div class='expanded-meta'>
          <div class='expanded-title'></div>
          <div class='expanded-domain'></div>
        </div>
        <div class='expanded-link-icon'>
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M10.5 7.5L10.5 10.5C10.5 11.0523 10.0523 11.5 9.5 11.5L3.5 11.5C2.94772 11.5 2.5 11.0523 2.5 10.5L2.5 4.5C2.5 3.94772 2.94772 3.5 3.5 3.5L6.5 3.5M8 2.5L11.5 2.5M11.5 2.5L11.5 6M11.5 2.5L6.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>`;expandedCard.querySelector('.expanded-title').textContent=title;expandedCard.querySelector('.expanded-domain').textContent=domain;if(aiSnippets&&aiSnippets.trim()){const snippetDiv=document.createElement('div');snippetDiv.className='expanded-snippet';snippetDiv.textContent=aiSnippets;expandedCard.appendChild(snippetDiv);}
expandedList.append(expandedCard);});tabs.forEach(tab=>{tab.addEventListener('click',function(){const tabName=this.getAttribute('data-tab');tabs.forEach(t=>t.classList.remove('active'));this.classList.add('active');tabContents.forEach(content=>{const contentTab=content.getAttribute('data-content');if(contentTab===tabName){content.classList.add('active');}
else{content.classList.remove('active');}});const outputBox=resultsWrapper.closest('.outputBox');const markdownContainer=outputBox?.querySelector('.markdownContainer');if(markdownContainer){if(tabName==='sources'){markdownContainer.style.display='none';}
else{markdownContainer.style.display='block';}}});});resultsWrapper.addEventListener('click',(e)=>{const target=e.target;if(target.classList.contains('show-more-sources-btn')||target.closest('.show-more-sources-btn')){const sourcesTab=resultsWrapper.querySelector('[data-tab="sources"]');if(sourcesTab)
sourcesTab.click();}});return temp.content;}
function createWebSearchLoadingPlaceholder(){const placeholder=document.createElement('div');placeholder.className='results-wrapper results-loading';placeholder.innerHTML=`
    <!-- Use the actual tab structure -->
    <div class='results-tabs'>
      <button class='results-tab active' data-tab='results'>
        <div class='tab-icon skeleton-icon'></div>
        <span class='skeleton-text'></span>
      </button>
      <button class='results-tab' data-tab='sources'>
        <div class='tab-icon skeleton-icon'></div>
        <span class='skeleton-text'></span>
        <span class='sources-badge skeleton-text'></span>
      </button>
    </div>

    <div class='tab-content active' data-content='results'>
      <div class='compact-sources-grid'>
        <!-- Use actual chip structure with skeleton loading on each card -->
        <a class='compact-source-card skeleton-loading'>
          <div class='source-card-content'>
            <div class='source-favicon skeleton-block'></div>
            <div class='source-info'>
              <div class='source-title skeleton-text'></div>
              <div class='source-domain skeleton-text short'></div>
            </div>
          </div>
        </a>
        <a class='compact-source-card skeleton-loading'>
          <div class='source-card-content'>
            <div class='source-favicon skeleton-block'></div>
            <div class='source-info'>
              <div class='source-title skeleton-text'></div>
              <div class='source-domain skeleton-text short'></div>
            </div>
          </div>
        </a>
        <a class='compact-source-card skeleton-loading'>
          <div class='source-card-content'>
            <div class='source-favicon skeleton-block'></div>
            <div class='source-info'>
              <div class='source-title skeleton-text'></div>
              <div class='source-domain skeleton-text short'></div>
            </div>
          </div>
        </a>
        <!-- Add skeleton for show more button -->
        <button class='show-more-sources-btn skeleton-loading'>
          <span class='skeleton-text skeleton-button-text'></span>
        </button>
      </div>
    </div>
  `;return placeholder;}
function copyCodeSnippetToClipboard(event){const button=event.target;const codeElement=button.parentNode.querySelector('code');navigator.clipboard.writeText(codeElement.textContent);toast("copypopup");}
async function livecodesButtonClicked(event){const targetElement=event.target.tagName==='IMG'?event.target.parentElement:event.target;const code=targetElement.nextElementSibling.textContent;const languageMatch=targetElement.nextElementSibling.className.match(/language-(\w+)/);const language=languageMatch?languageMatch[1]:'javascript';try{if(!window.livecodes){await loadLiveCodesSDK();}
const config={title:'DeepAI Code Snippet',tools:{enabled:['console'],active:'console',status:'open'}};if(language==='html'){config.markup={language:'html',content:code};config.activeEditor='markup';}
else if(language==='css'){config.style={language:'css',content:code};config.activeEditor='style';}
else{config.script={language:language,content:code};config.activeEditor='script';}
const playgroundUrl=window.livecodes.getPlaygroundUrl({config,params:{console:'open'}});window.open(playgroundUrl,'_blank').focus();}
catch(error){console.error('LiveCodes integration error:',error);}}
function loadLiveCodesSDK(){return new Promise((resolve,reject)=>{if(window.livecodes){resolve();return;}
const script=document.createElement('script');script.src='https://cdn.jsdelivr.net/npm/livecodes@0.10.0/livecodes.umd.js';script.onload=()=>window.livecodes?resolve():reject(new Error('LiveCodes SDK not found'));script.onerror=()=>reject(new Error('Failed to load LiveCodes SDK'));document.head.appendChild(script);});}
let projector=null;function detachMaquetteProjectors(element){if(!projector)
return;const containers=element.querySelectorAll('.markdownContainer[data-projected]');containers.forEach((container)=>{const renderFn=container._maquetteRenderFn;if(renderFn){try{projector.detach(renderFn);}
catch(e){}
delete container._maquetteRenderFn;}});if(element.classList.contains('markdownContainer')&&element.hasAttribute('data-projected')){const renderFn=element._maquetteRenderFn;if(renderFn){try{projector.detach(renderFn);}
catch(e){}
delete element._maquetteRenderFn;}}}
let isCurrentlyStreaming=false;let pendingMarkdownUpdate=false;function updateMarkDown(){const convo=document.getElementById('convo');const librariesLoaded=typeof marked!=='undefined'&&typeof hljs!=='undefined'&&typeof maquette!=='undefined';if(!librariesLoaded){console.log("Error: 'marked', 'highlight.js', or 'maquette' library not loaded. Falling back to plain text.");const outputBoxes=convo.querySelectorAll(".outputBox");outputBoxes.forEach(box=>{const hiddenContainer=box.querySelector('.hiddenTextContainer');const markdownContainer=box.querySelector('.markdownContainer');if(hiddenContainer&&markdownContainer&&hiddenContainer.dataset.newContent){markdownContainer.textContent=hiddenContainer.textContent||'';delete hiddenContainer.dataset.newContent;}});pendingMarkdownUpdate=false;return;}
const{h,createProjector}=maquette;if(!projector){projector=createProjector();}
const mathExtension={name:'math',level:'inline',start(src){return src.match(/\\\[|\\\(/)?.index;},tokenizer(src){let displayMatch=src.match(/^\\\[([\s\S]+?)\\\]/);if(displayMatch){return{type:'math',raw:displayMatch[0],text:displayMatch[1].trim(),display:true};}
let inlineMatch=src.match(/^\\\(([\s\S]+?)\\\)/);if(inlineMatch){return{type:'math',raw:inlineMatch[0],text:inlineMatch[1].trim(),display:false};}},renderer(token){try{return katex.renderToString(token.text,{displayMode:token.display,throwOnError:false,trust:true});}
catch(e){console.error('KaTeX rendering error:',e);return token.raw;}}};marked.use({extensions:[mathExtension]});const renderer=new marked.Renderer();renderer.code=function(code,language){const sanitizedLanguage=language?language.replace(/[^a-zA-Z0-9-]/g,''):'';return`<pre>
          <button class="copyCodeButton" onclick="copyCodeSnippetToClipboard(event)">Copy</button>
          <button onclick="livecodesButtonClicked(event)" class="livecodesButton">Run</button>
          <code class="${sanitizedLanguage ? `language-${sanitizedLanguage}` : ''}">${hljs.highlightAuto(code).value}</code>
      </pre>`;};renderer.html=function(html){return html.replace(/</g,'&lt;').replace(/>/g,'&gt;');};renderer.link=function(href,title,text){if(/^\[.*\]$/.test(text)){const linkText=text.slice(1,-1);return`<a href="${href}" title="${title}" target="_blank" style="color: #a9a9a9; font-size: 0.8em; vertical-align: super; padding: 0; margin-left: 0px; text-decoration: none;">${linkText}</a>`;}
else{return`<a href="${href}" title="${title}" target="_blank">${text}</a>`;}};marked.setOptions({renderer,breaks:true,gfm:true});const outputBoxes=convo.querySelectorAll(".outputBox");let currentTextLength=0;outputBoxes.forEach(box=>{let hiddenContainer=box.querySelector('.hiddenTextContainer');if(!hiddenContainer||!hiddenContainer.dataset.newContent)
return null;if(hiddenContainer.textContent){currentTextLength+=hiddenContainer.textContent.length;}
let markdownContainer=box.querySelector('.markdownContainer');function htmlToVNode(element,key=0){if(element.nodeType===Node.TEXT_NODE){return element.textContent;}
else if(element.nodeType===Node.ELEMENT_NODE){const elemNode=element;const tagName=elemNode.tagName.toLowerCase();const properties={key};Array.from(elemNode.attributes).forEach(attr=>{properties[attr.name]=attr.value;});if(tagName==='input'||tagName==='textarea'){properties.value=elemNode.value;}
let childNodes=Array.from(elemNode.childNodes).map((child,idx)=>htmlToVNode(child,key+'-'+idx));return h(tagName,properties,childNodes);}}
function renderMarkdown(){if(!markdownContainer.isConnected){return h('div',{class:'markdownContainer'},[]);}
const htmlContent=marked.parse(hiddenContainer.textContent);const tempDiv=document.createElement('div');tempDiv.innerHTML=htmlContent;let vnodes=Array.from(tempDiv.childNodes).map(htmlToVNode);return h('div',{class:'markdownContainer'},vnodes);}
if(!markdownContainer.dataset.projected){projector.append(markdownContainer,renderMarkdown);markdownContainer.dataset.projected='true';markdownContainer._maquetteRenderFn=renderMarkdown;}
if(hiddenContainer.dataset.newContent){delete hiddenContainer.dataset.newContent;projector.scheduleRender();try{if(updateScrollBtn){setTimeout(updateScrollBtn,0);}}
catch(e){console.error('scroll button error:',e);}}});pendingMarkdownUpdate=false;}
function arrangeChatImageGrid(){document.querySelectorAll('.chatImageBox').forEach(container=>{const imgs=Array.from(container.getElementsByClassName('chat-image'));imgs.forEach(img=>img.style.display='block');const count=Math.min(imgs.length,10);const root=Math.sqrt(count);const cols=Number.isInteger(root)?root:3;container.style.gridTemplateColumns=`repeat(${cols}, 1fr)`;});}
function enableImageClickToFullSize(){let overlay=document.getElementById('imageOverlay');if(!overlay){overlay=document.createElement('div');overlay.id='imageOverlay';overlay.addEventListener('click',()=>{overlay.style.display='none';overlay.querySelector('img').src='';});const fullImg=document.createElement('img');overlay.appendChild(fullImg);document.body.appendChild(overlay);}
const fullImg=overlay.querySelector('img');document.querySelectorAll('.chat-image').forEach(thumb=>{const imgThumb=thumb;imgThumb.removeEventListener('click',imgThumb._openHandler);imgThumb._openHandler=()=>{fullImg.src=imgThumb.src;overlay.style.display='flex';};imgThumb.addEventListener('click',imgThumb._openHandler);});}
async function addKoahAd(){try{const koahSDK=window.koah;if(!koahSDK){console.log('Koah SDK not available');logStat('koah.ineligible');return;}
const oldMessages=getFullChatHistoryObject();let lastUserMessage='';let lastAssistantMessage='';for(let i=oldMessages.length-1;i>=0;i--){if(oldMessages[i].role==='assistant'&&!lastAssistantMessage){lastAssistantMessage=oldMessages[i].content;}
else if(oldMessages[i].role==='user'&&!lastUserMessage){lastUserMessage=oldMessages[i].content;break;}}
if(!lastUserMessage||!lastAssistantMessage){console.log('No valid prompt/answer pair for Koah ad');logStat('koah.ineligible');return;}
console.log('Processing Koah ad with prompt:',lastUserMessage,'and answer:',lastAssistantMessage);const convo=document.getElementById('convo');let adDiv=document.createElement('div');if(convo){adDiv.className='adsbykoah';convo.appendChild(adDiv);}
else{console.error('convo not found');logStat('koah.error');return;}
koahSDK.process(lastUserMessage,lastAssistantMessage,'suffix',{onFill:()=>{console.log('Koah ad served successfully');adDiv.classList.add('koah-ad-filled');logStat('koah.filled');},onNoFill:()=>{console.log('No Koah ad available');logStat('koah.nofill');},conversationId:currentChatUUID});}
catch(e){console.log('Koah ad error:',e);logStat('koah.error');}}
const AUDIBLE_QUOTE_ICON=`<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#FF9900"><path d="M6.5 10c-.223 0-.437.034-.65.065.069-.232.14-.468.254-.68.114-.308.292-.575.469-.844.148-.291.409-.488.601-.737.201-.242.475-.403.692-.604.213-.21.492-.315.714-.463.232-.133.434-.28.65-.35l.539-.222.474-.197-.485-1.938-.597.144c-.191.048-.424.104-.689.171-.271.05-.56.187-.882.312-.318.142-.686.238-1.028.466-.344.218-.741.4-1.091.692-.339.301-.748.562-1.05.945-.33.358-.656.734-.909 1.162-.293.408-.492.856-.702 1.299-.19.443-.343.896-.468 1.336-.237.882-.343 1.72-.384 2.437-.034.718-.014 1.315.028 1.747.015.204.043.402.063.539l.025.168.026-.006A4.5 4.5 0 1 0 6.5 10zm11 0c-.223 0-.437.034-.65.065.069-.232.14-.468.254-.68.114-.308.292-.575.469-.844.148-.291.409-.488.601-.737.201-.242.475-.403.692-.604.213-.21.492-.315.714-.463.232-.133.434-.28.65-.35l.539-.222.474-.197-.485-1.938-.597.144c-.191.048-.424.104-.689.171-.271.05-.56.187-.882.312-.317.143-.686.238-1.028.467-.344.218-.741.4-1.091.692-.339.301-.748.562-1.05.944-.33.358-.656.734-.909 1.162-.293.408-.492.856-.702 1.299-.19.443-.343.896-.468 1.336-.237.882-.343 1.72-.384 2.437-.034.718-.014 1.315.028 1.747.015.204.043.402.063.539l.025.168.026-.006A4.5 4.5 0 1 0 17.5 10z"/></svg>`;const AUDIBLE_LOGO_ICON=`<svg viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="#ffffff"><path d="m129.8 96.1.2-.1c3.5-2.2 4.1-7.1 1.2-10.1-5.8-6.1-16.3-14.5-31.7-16.2-25.1-2.8-42 14.8-45.8 19.2-.4.5-.5 1.3 0 1.8.5.7 1.5.8 2.1.2 4.2-3.6 14.4-11.1 29-11.7 18.1-.7 30.9 9.8 36.7 15.8 2.2 2.3 5.6 2.8 8.3 1.1z"></path><path d="M148.8 82.8c3.7-2.2 4.4-7.2 1.5-10.4-8.5-9.5-27.3-26-55.6-26.4-34.4-.3-55.2 23.4-59.7 29-.4.6-.5 1.3-.1 1.9.6.8 1.8.9 2.5.2C42.9 71.5 62.2 54.3 91 56c25.7 1.6 42.1 17.2 49 25.3 2.2 2.7 5.9 3.3 8.8 1.5z"></path><path d="m22 88.8 65.2 54.3c4.4 3.7 10.8 3.8 15.3.2L170 90.7" style="fill:none;stroke:#ffffff;stroke-width:12;stroke-linecap:round;stroke-miterlimit:10"></path><path d="M109.6 106.9c3.6-2.2 4-7.3.7-10-2.9-2.3-6.8-4.7-11.9-5.7-13.4-2.6-23.6 6.4-26.4 9.2-.5.5-.6 1.2-.3 1.7.4.8 1.4 1 2.1.6 2.4-1.5 6.4-3.4 11.5-3.5 7.8-.2 13.7 3.9 17 7 2 1.8 5 2.1 7.3.7z"/></svg>`;function sanitizeAdUrl(rawUrl){if(!rawUrl)
return null;try{const urlToCheck=rawUrl.startsWith('http://')||rawUrl.startsWith('https://')?rawUrl:`https://${rawUrl}`;const parsedUrl=new URL(urlToCheck);if(parsedUrl.protocol==='http:'||parsedUrl.protocol==='https:'){return parsedUrl.toString();}
else{console.log('Prorata: Invalid URL protocol, skipping CTA link');}}
catch(e){console.log('Prorata: Invalid URL format, skipping CTA link',e);}
return null;}
function isAudibleAd(ad){const adName=ad.adName?.toLowerCase()||'';return!!ad.adPullQuote||adName.includes('audible');}
function renderAudibleAd(ad){const headlineParts=[];if(ad.adPullQuote)
headlineParts.push(ad.adPullQuote);if(ad.adHeadline)
headlineParts.push(ad.adHeadline);const headline=headlineParts.join(' - ');const adText=ad.adText||'';const sanitizedUrl=sanitizeAdUrl(ad.adUrl);const adContent=`
        <div class="prorata-ad-header">
            <span>Sponsored</span>
            <span>${escapeHtml(ad.adName || 'Audible Studios')}</span>
        </div>
        <div class="prorata-ad-audible">
            ${ad.adImage ? `<img class="audible-book-cover"src="${escapeHtml(ad.adImage)}"alt="${escapeHtml(ad.adCTA || 'Book cover')}">` : ''}
            <div class="prorata-ad-audible-content">
                ${headline ? `<h4 class="prorata-ad-audible-headline"><span class="prorata-ad-audible-quote-icon">${AUDIBLE_QUOTE_ICON}</span>${escapeHtml(headline)}</h4>` : ''}
                ${adText ? `<p class="prorata-ad-audible-text">${escapeHtml(adText)}</p>` : ''}
                ${ad.adCTA && sanitizedUrl ? `<span class="prorata-ad-audible-cta"><span class="prorata-ad-audible-logo">${AUDIBLE_LOGO_ICON}</span><span>${escapeHtml(ad.adCTA)}</span></span>` : ''}
            </div>
        </div>
    `;if(sanitizedUrl){return`<a href="${escapeHtml(sanitizedUrl)}" target="_blank" rel="noopener noreferrer" class="prorata-ad-link">${adContent}</a>`;}
return adContent;}
function renderStandardProrataAd(ad){let adText='';if(ad.adHeadline)
adText+=`<strong>${escapeHtml(ad.adHeadline)}</strong>`;if(ad.adText)
adText+=`${adText ? ' - ' : ''}${escapeHtml(ad.adText)}`;const sanitizedUrl=sanitizeAdUrl(ad.adUrl);const ctaHtml=(ad.adCTA&&sanitizedUrl)?`<br><span class="prorata-ad-cta-text">${escapeHtml(ad.adCTA)}</span>`:'';const adContent=`
        <div class="prorata-ad-header">
            <span>Sponsored</span>
            <span>${escapeHtml(ad.adName || 'Advertiser')}</span>
        </div>
        ${ad.adImage ? `<img src="${escapeHtml(ad.adImage)}"alt="${escapeHtml(ad.adCTA || 'Ad')}"loading="lazy">` : ''}
        <p class="prorata-ad-content">${adText}${ctaHtml}</p>
    `;if(sanitizedUrl){return`<a href="${escapeHtml(sanitizedUrl)}" target="_blank" rel="noopener noreferrer" class="prorata-ad-link">${adContent}</a>`;}
return adContent;}
async function addProrataAd(){try{const oldMessages=getFullChatHistoryObject();let lastUserMessage='';let lastAssistantMessage='';for(let i=oldMessages.length-1;i>=0;i--){if(oldMessages[i].role==='assistant'&&!lastAssistantMessage){lastAssistantMessage=oldMessages[i].content;}
else if(oldMessages[i].role==='user'&&!lastUserMessage){lastUserMessage=oldMessages[i].content;break;}}
if(!lastUserMessage||!lastAssistantMessage){console.log('Prorata: No valid prompt/answer pair');logStat('prorata.ineligible');return;}
const convo=document.getElementById('convo');if(!convo){console.error('Prorata: convo element not found');logStat('prorata.ineligible');return;}
const outputBoxes=convo.querySelectorAll('.outputBox');const targetOutputBox=outputBoxes[outputBoxes.length-1];if(!targetOutputBox){console.error('Prorata: No output box found');logStat('prorata.ineligible');return;}
console.log('Prorata: Fetching ad with prompt length:',lastUserMessage.length,'answer length:',lastAssistantMessage.length);const response=await fetch('https://tp-srch-api.gist.ai/v2/search',{method:'POST',headers:{'Publisher-ID':'e54140f9-ea82-492a-b146-51763a3825d5','Publisher-Key':'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzbHVnIjoiZTU0MTQwZjktZWE4Mi00OTJhLWIxNDYtNTE3NjNhMzgyNWQ1Iiwic3ViIjoicHVibGlzaGVyOmU1NDE0MGY5LWVhODItNDkyYS1iMTQ2LTUxNzYzYTM4MjVkNSIsImlhdCI6MTc2MjkwOTA3NiwiaXNzIjoicHJ0LWFkcy1tYW5hZ2VtZW50LXNlcnZpY2UifQ.tMXmVp4g1WVBMgQGMo6NRbjiL-NExqOtYEZ_b1-NSbY','Content-Type':'application/json'},body:JSON.stringify({prompt:lastUserMessage,answer:lastAssistantMessage,ad_type:['text/image','text'],geo:'US'})});if(!response.ok){const statusText=response.statusText||'Unknown';let responseBody='';try{responseBody=await response.text();}
catch(e){}
console.log('Prorata: API returned non-OK status:',response.status,statusText,responseBody);logStat('prorata.error',{type:'http_error',message:`HTTP ${response.status} ${statusText}: ${responseBody.substring(0, 200)}`});return;}
let data;try{data=await response.json();}
catch(parseError){const errMsg=parseError instanceof Error?parseError.message:String(parseError);console.log('Prorata: Failed to parse JSON response:',errMsg);logStat('prorata.error',{type:'parse_error',message:`JSON parse failed: ${errMsg}`});return;}
if(!data.selection?.[0]){console.log('Prorata: No ad returned');logStat('prorata.nofill');return;}
const ad=data.selection[0];console.log('Prorata: Ad returned -',ad.adName||'Unknown advertiser');if(!document.body.contains(targetOutputBox)){console.log('Prorata: Target output box no longer in DOM, skipping ad render');logStat('prorata.render_canceled');return;}
const adDiv=document.createElement('div');adDiv.className='prorata-ad';adDiv.innerHTML=isAudibleAd(ad)?renderAudibleAd(ad):renderStandardProrataAd(ad);if(document.body.contains(targetOutputBox)){targetOutputBox.appendChild(adDiv);console.log('Prorata: Ad successfully rendered');logStat('prorata.filled');}
else{console.log('Prorata: Target output box removed during ad preparation, ad not rendered');logStat('prorata.render_canceled');}}
catch(error){const errMsg=error instanceof Error?`${error.name}: ${error.message}`:String(error);const errStack=error instanceof Error&&error.stack?error.stack.substring(0,300):'';console.log('Prorata: Error loading ad (non-critical):',error);logStat('prorata.error',{type:'js_error',message:`${errMsg} | Stack: ${errStack}`});}}
let thradTurnNumber=0;function getThradUserId(){const realUserId=getUserId();if(realUserId!==null){return`user_${realUserId}`;}
const STORAGE_KEY='thrad_user_id';let odlUserId=localStorage.getItem(STORAGE_KEY);if(!odlUserId){odlUserId='user_'+uuidv4();localStorage.setItem(STORAGE_KEY,odlUserId);}
return odlUserId;}
function extractThradDomain(url){try{const parsed=new URL(url);return parsed.hostname.replace(/^www\./,'');}
catch{return'';}}
function sanitizeThradUrl(rawUrl){if(!rawUrl)
return null;try{const urlToCheck=rawUrl.startsWith('http://')||rawUrl.startsWith('https://')?rawUrl:`https://${rawUrl}`;const parsedUrl=new URL(urlToCheck);if(parsedUrl.protocol==='http:'||parsedUrl.protocol==='https:'){return parsedUrl.toString();}}
catch(e){console.log('Thrad: Invalid URL format',e);}
return null;}
function renderThradAd(bid){const sanitizedUrl=sanitizeThradUrl(bid.url);const adTextParts=[];if(bid.headline){const headlineHtml=sanitizedUrl?`<a class="thrad-ad-headline" href="${escapeHtml(sanitizedUrl)}" target="_blank" rel="noopener noreferrer">${escapeHtml(bid.headline)}</a>`:`<strong>${escapeHtml(bid.headline)}</strong>`;adTextParts.push(headlineHtml);}
if(bid.description){adTextParts.push(escapeHtml(bid.description));}
const adText=adTextParts.join('  ');const advertiserDisplay=bid.advertiser||(sanitizedUrl?extractThradDomain(sanitizedUrl):'Advertiser');return`
    <div class="thrad-ad-container">
      <div class="thrad-ad-header">
        ${bid.image_url ? `<img class="thrad-ad-icon"src="${escapeHtml(bid.image_url)}"alt="">` : ''}
        <span class="thrad-ad-advertiser">${escapeHtml(advertiserDisplay)}</span>
        <span class="thrad-ad-label">Sponsored</span>
      </div>
      <div class="thrad-ad-text">${adText}</div>
      ${bid.cta_text && sanitizedUrl ? `<a class="thrad-ad-cta"href="${escapeHtml(sanitizedUrl)}"target="_blank"rel="noopener noreferrer">${escapeHtml(bid.cta_text)}</a>` : ''}
    </div>
  `;}
async function addThradAd(){try{const oldMessages=getFullChatHistoryObject();const thradMessages=[];const now=new Date();for(let i=0;i<oldMessages.length;i++){const msg=oldMessages[i];if(msg.role==='user'||msg.role==='assistant'){thradMessages.push({role:msg.role,content:msg.content,timestamp:new Date(now.getTime()-(oldMessages.length-i)*30000).toISOString()});}}
if(thradMessages.length<2){console.log('Thrad: Not enough messages for ad request');logStat('thrad.ineligible');return;}
const convo=document.getElementById('convo');if(!convo){console.error('Thrad: convo element not found');logStat('thrad.ineligible');return;}
const outputBoxes=convo.querySelectorAll('.outputBox');const targetOutputBox=outputBoxes[outputBoxes.length-1];if(!targetOutputBox){console.error('Thrad: No output box found');logStat('thrad.ineligible');return;}
const requestBody={userId:getThradUserId(),chatId:currentChatUUID,messages:thradMessages,turn_number:thradTurnNumber};if(THRAD_DEBUG_MODE){requestBody.production=false;console.log('Thrad: DEBUG MODE - sending with production: false');}
console.log('Thrad: Sending bid request',requestBody);const response=await fetch(THRAD_ENDPOINT,{method:'POST',headers:{'thrad-api-key':THRAD_API_KEY,'Content-Type':'application/json'},body:JSON.stringify(requestBody)});thradTurnNumber++;if(!response.ok){console.log('Thrad: HTTP error',response.status);logStat('thrad.error',{type:'http_error',message:`HTTP ${response.status}`});return;}
const data=await response.json();console.log('Thrad: Received response',data);if(data.status==='error'){console.log('Thrad: API error',data.message,data.error);logStat('thrad.error',{type:'api_error',message:data.message});return;}
const bid=data.data?.bid;if(!bid){console.log('Thrad: No bid returned');logStat('thrad.nofill');return;}
if(!document.body.contains(targetOutputBox)){console.log('Thrad: Target output box no longer in DOM, skipping ad render');logStat('thrad.render_canceled');return;}
if(bid.image_url){try{const img=new Image();img.src=bid.image_url;await img.decode();}
catch(e){console.log('Thrad: Image preload failed, continuing without image');}}
if(document.body.contains(targetOutputBox)){const adWrapper=document.createElement('div');adWrapper.innerHTML=renderThradAd(bid);const adContainer=adWrapper.firstElementChild;if(adContainer){targetOutputBox.insertAdjacentElement('afterend',adContainer);}
console.log('Thrad: Ad successfully rendered');logStat('thrad.filled');}
else{console.log('Thrad: Target output box removed during ad preparation, ad not rendered');logStat('thrad.render_canceled');}}
catch(error){const errMsg=error instanceof Error?`${error.name}: ${error.message}`:String(error);const errStack=error instanceof Error&&error.stack?error.stack.substring(0,300):'';console.log('Thrad: Error loading ad (non-critical):',error);logStat('thrad.error',{type:'js_error',message:`${errMsg} | Stack: ${errStack}`});}}
function escapeHtml(unsafe){if(!unsafe)
return'';return unsafe.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');}
function adjustTextareaHeight(textarea){if(!textarea)
return;textarea.style.height="1px";const computedHeight=textarea.scrollHeight;const computedStyle=window.getComputedStyle(textarea);const paddingHeight=parseInt(computedStyle.paddingTop,10)+
parseInt(computedStyle.paddingBottom,10);const textHeight=computedHeight-paddingHeight;textarea.style.height=textHeight+"px";}
function optimizeChatPromptBox(chatboxWrapper){const textarea=chatboxWrapper.querySelector('textarea');if(!textarea)
return;textarea.addEventListener('input',()=>adjustTextareaHeight(textarea));if(!currentlyLoadingChat){adjustTextareaHeight(textarea);}
else{textarea.style.height="auto";setTimeout(()=>adjustTextareaHeight(textarea),0);setTimeout(()=>adjustTextareaHeight(textarea),100);}}
function generateUniqueAdId(){const adBoxes=document.querySelectorAll(".chat-ad-container");if(adBoxes.length!==0){const newId=parseInt(adBoxes[adBoxes.length-1].id.split("ad-box-")[1],10)+1;return`ad-box-${newId}`;}
else{return'ad-box-0';}}
function newAdSlot(container){if(characterEnabled)
return;const newAd=document.createElement("div");newAd.setAttribute('data-freestar-ad','__320x50 __970x90');newAd.setAttribute('align','center');newAd.setAttribute('style','overflow: hidden;');const adBoxId=generateUniqueAdId();newAd.setAttribute('id',adBoxId);newAd.classList.add("chat-ad-container");const comment=document.createComment('Tag ID: adBoxId');container.append(comment);container.append(newAd);window.freestar.queue.push(function(){console.log('Pushing new ad slot to freestar queue');window.freestar.newAdSlots?.({placementName:'deepai.org_chat_dynamic',slotId:adBoxId});});};async function chatSubmit(summaryMessage,searchMessage,contentsCheck,editedBox=null){chatRunning=true;try{nudgeUserLogin();}
catch(e){console.log('error nudging user to login',e);}
var search_flag=false;let messageText='';const form_data=new FormData();if(summaryMessage){messageText=summaryMessage;form_data.append('summary','summary');}
else if(searchMessage){messageText=searchMessage;form_data.append('online','online');form_data.append('search','search');}
else{const persistentChatbox=document.getElementById('persistentChatbox');messageText=persistentChatbox?persistentChatbox.value.trim():'';if(editedBox){const textarea=editedBox.querySelector('textarea');if(textarea){messageText=textarea.value.trim();}}
if(contentsCheck&&!messageText){console.log('No message to send');return;}
if(messageText&&!editedBox){const newBox=newChatBox(messageText);newBox.style.visibility='visible';newBox.style.display='block';newBox.style.opacity='1';const convo=document.getElementById('convo');convo.append(newBox);optimizeChatPromptBox(newBox);}
if(persistentChatbox){persistentChatbox.value='';persistentChatbox.style.height='auto';persistentChatbox.dispatchEvent(new Event('input',{bubbles:true}));}}
let attachmentUUIDs=getCurrentAttachmentUUIDs();if(editedBox&&attachmentUUIDs.length===0){const storedUUIDs=editedBox.getAttribute('data-attachment-uuids');if(storedUUIDs){try{attachmentUUIDs=JSON.parse(storedUUIDs);}
catch(e){console.error('Failed to parse attachment UUIDs from editedBox:',e);}}}
clearAttachments();if(attachmentUUIDs.length>0&&!editedBox){const allWrappers=document.querySelectorAll('.chatbox-wrapper');const lastWrapper=allWrappers[allWrappers.length-1];if(lastWrapper){lastWrapper.setAttribute('data-attachment-uuids',JSON.stringify(attachmentUUIDs));renderMessageAttachments(attachmentUUIDs).then(attachmentsEl=>{if(attachmentsEl){const optionsBox=lastWrapper.querySelector('.chatoptionsBox');if(optionsBox){optionsBox.insertAdjacentElement('beforebegin',attachmentsEl);}
else{lastWrapper.appendChild(attachmentsEl);}}}).catch(err=>{console.error('Failed to render attachments:',err);});}}
try{saveChatHistory();}
catch(e){console.log("Error saving chat history after user message processing",e);}
chatModifiedSinceLoad=true;const convo=document.getElementById('convo');const thinkingIndicator=showThinkingIndicator();const chatHistory=getChatHistoryObject();if(summaryMessage||searchMessage){chatHistory.push({"role":"user","content":messageText});}
form_data.append('chat_style',chat_style);form_data.append('chatHistory',JSON.stringify(chatHistory));const selectedMode=sessionStorage.getItem("selectedChatMode")||"standard";form_data.append('model',selectedMode);form_data.append('hacker_is_stinky','very_stinky');form_data.append('enabled_tools',JSON.stringify(['image_generator','image_editor']));const allAttachmentUUIDs=getAllConversationAttachmentUUIDs();if(allAttachmentUUIDs.length>0){form_data.append('attachment_uuids',JSON.stringify(allAttachmentUUIDs));}
if(!summaryMessage&&(selectedMode==='online'||selectedMode==='onlinegenius')){search_flag=true;}
const tryitApiKey=generateTryitApiKey();const chatSubmitElem=document.getElementById("chatSubmitButton");const chatStopElem=document.getElementById("chatStopButton");if(document.getElementById("chatEditSubmitButton")!==null){const editSubmitBtn=document.getElementById("chatEditSubmitButton");editSubmitBtn.disabled=true;editSubmitBtn.style.cssText="background: white; color: #101010;";}
let reader,response;try{abortController=new AbortController();const abortSignal=abortController.signal;chatStopElem.style.cssText="display: block;";chatSubmitElem.style.cssText="display: none;";response=await fetch(app_base_url+"/hacking_is_a_serious_crime",{credentials:'include',method:'POST',body:form_data,signal:abortSignal,headers:{'api-key':tryitApiKey}});reader=response.body.getReader();}
catch(e){console.log("Caught error in chat fetch",e);chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;removeThinkingIndicator();if(e.name!=='AbortError'){toast("errorpopup");}
return;}
if(response.status>299){if(document.getElementById("chatEditSubmitButton")!==null){const editSubmitBtn=document.getElementById("chatEditSubmitButton");editSubmitBtn.disabled=false;editSubmitBtn.style.cssText="background: #8F37FF; color: white;";}
chatSubmitElem.style.cssText="display: block;";chatStopElem.style.cssText="display: none;";removeThinkingIndicator();const{value,done}=await reader.read();const decoder=new TextDecoder("utf-8");const json=JSON.parse(decoder.decode(value));if(json.status==="anonymous try it exceeded"){openSignup();chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status==="signed in try-it quota exceeded"){openSubscription();chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status==="model only available to paid users"){openSubscription();chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status==="pro user out of credits"){openOutOfCredits(json.credits_remaining);chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status==="Only paid accounts can use genius"){openSubscription();chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status&&json.status.includes("Api-Key")){toast("errorpopup","Authentication error. Please check your API key.");chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
if(json.status==="Please login to an account"){openSignup();chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;}
toast("errorpopup");chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;return;throw new Error("Unknown error");}
let outputBox=newOutputBox();removeThinkingIndicator();if(search_flag){const loadingPlaceholder=createWebSearchLoadingPlaceholder();const markdownContainer=outputBox.querySelector('.markdownContainer');outputBox.insertBefore(loadingPlaceholder,markdownContainer);outputBox.dataset.hasResults='true';}
convo.append(outputBox);arrangeChatImageGrid();enableImageClickToFullSize();let hiddenTextContainer=outputBox.querySelector('.hiddenTextContainer');let uint8ArraySoFar=new Uint8Array(0);let responseSoFar="";let responseText="";let responseJSON=null;let outputBuffer="";isCurrentlyStreaming=true;try{while(true){const{value,done}=await reader.read();if(done){const tempStyle=document.getElementById('temp-chatbox-style');if(tempStyle)
tempStyle.remove();updateMarkDown();break;}
uint8ArraySoFar=concatUint8Array(uint8ArraySoFar,value);responseSoFar=Utf8ArrayToStr(uint8ArraySoFar);if(responseSoFar.includes('\u001C')){const parts=responseSoFar.split('\u001C');responseText=parts[0];const fsPayload=parts[1];if(fsPayload&&outputBox){try{const handled=await maybeHandleImageTool(fsPayload,outputBox);if(handled){chatStopElem.style.cssText="display: none;";chatSubmitElem.style.cssText="display: block;";chatRunning=false;isCurrentlyStreaming=false;return;}}
catch{}}
responseJSON=fsPayload;}
else{responseText=responseSoFar;}
let textToInsert=responseText.substring(outputBuffer.length,responseText.length);const wordsAndSpaces=textToInsert.split(/(\s+)/);for(let i=0;i<wordsAndSpaces.length;i++){const wordOrSpace=wordsAndSpaces[i];outputBuffer+=wordOrSpace;const textAsHtml=document.createTextNode(wordOrSpace);hiddenTextContainer.appendChild(textAsHtml);hiddenTextContainer.dataset.newContent='true';const contentGrowthThreshold=100;if(!pendingMarkdownUpdate){pendingMarkdownUpdate=true;setTimeout(()=>{updateMarkDown();},10);}}}
console.log('Response fully received, has JSON?',Boolean(responseJSON));if(responseJSON){try{const loadingPlaceholder=outputBox.querySelector('.results-loading');if(loadingPlaceholder){loadingPlaceholder.remove();}
outputBox.append(drawResults(JSON.parse(responseJSON)));outputBox.dataset.hasResults='true';}
catch(e){console.error('something went wrong creating or appending the resultsContainer from a JSON message',e,responseJSON);}}
else{const loadingPlaceholder=outputBox.querySelector('.results-loading');if(loadingPlaceholder)
loadingPlaceholder.remove();outputBox.removeAttribute('data-has-results');}}
catch(e){if(e.name!=='AbortError'){outputBox?.querySelector('.results-loading')?.remove();const hidden=outputBox?.querySelector('.hiddenTextContainer');if(hidden){hidden.dataset.newContent='true';hidden.textContent=(hidden.textContent||'')+'\n';}
try{updateMarkDown();}
catch{}
console.log("Error in reading chat response",e);toast("errorpopup");}}
finally{try{saveChatHistory();}
catch(e){console.log("Error saving chat history after response was received",e);}
isCurrentlyStreaming=false;}
if(!user_paid_for_no_ads){try{const country=geoData?.country_code2;logStat('ads.global_opportunity',country?{breakdown:country}:undefined);if(contextualAdProvider==='koah'){logStat('koah.opportunity');addKoahAd();}
else if(contextualAdProvider==='prorata'){logStat('prorata.opportunity');addProrataAd();}
else if(contextualAdProvider==='thrad'){logStat('thrad.opportunity');addThradAd();}}
catch(e){console.log('error adding contextual ad',e);}}
if(document.getElementById("chatEditSubmitButton")!==null){const editSubmitBtn=document.getElementById("chatEditSubmitButton");editSubmitBtn.disabled=false;editSubmitBtn.style.cssText="background: #8F37FF; color: white;";}
chatSubmitElem.style.cssText="display: block;";chatStopElem.style.cssText="display: none;";chatRunning=false;if(document.querySelectorAll('.chatbox-wrapper').length===1){setTimeout(()=>displayMyChatSessions(),2000);}
const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.focus();}}
function chatStop(){if(abortController){abortController.abort();abortController=null;}
if(imageAbortController){try{imageAbortController.abort();}
catch{}
imageAbortController=null;}
const convo=document.getElementById('convo');const boxes=convo?.querySelectorAll('.outputBox');const last=boxes&&boxes[boxes.length-1];last?.querySelector('.results-loading')?.remove();if(last)
last.removeAttribute('data-has-results');const hidden=last?.querySelector('.hiddenTextContainer');if(hidden){hidden.dataset.newContent='true';hidden.textContent=(hidden.textContent||'')+'\n';}
try{updateMarkDown();}
catch{}
removeThinkingIndicator();document.getElementById("chatStopButton")?.style&&(document.getElementById("chatStopButton").style.display="none");document.getElementById("chatSubmitButton")?.style&&(document.getElementById("chatSubmitButton").style.display="block");isCurrentlyStreaming=false;chatRunning=false;try{saveChatHistory();}
catch(e){console.log("Error saving chat history when stopping response generation",e);}}
try{const chatbox_text=sessionStorage.getItem("homepage_chatbox_text");if(chatbox_text){sessionStorage.removeItem("homepage_chatbox_text");const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.value=chatbox_text;persistentChatbox.dispatchEvent(new Event('input',{bubbles:true}));persistentChatbox.focus();setTimeout(()=>{chatSubmit('','',true);},100);}}}
catch(e){console.log("Error handling homepage chat text from sessionStorage:",e);}
async function summarizeSubmit(text){try{toast('summarypopup');const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.textContent='';persistentChatbox.dispatchEvent(new Event('input',{bubbles:true}));}
const convo=document.getElementById('convo');if(convo){convo.scrollTop=convo.scrollHeight;}
await chatSubmit(text);if(persistentChatbox){persistentChatbox.focus();}}
catch(e){console.log("Error in summarization:",e);toast("errorpopup","Error summarizing text");}}
function chatReSubmit(editedElement){let editedBox=editedElement;if(!editedBox){editedBox=document.querySelector('.chatbox-wrapper[data-edited="true"]');}
if(!editedBox){console.warn("No edited box found for resubmit");return;}
delete editedBox.dataset.edited;let nextElement=editedBox.nextElementSibling;while(nextElement){const elementToRemove=nextElement;nextElement=nextElement.nextElementSibling;elementToRemove.remove();}
chatSubmit('','',true,editedBox);}
function getTextFromDiv(div){let text='';const hiddenContainer=div.querySelector('.hiddenTextContainer');if(hiddenContainer){Array.from(hiddenContainer.childNodes).forEach(child=>{if(child.nodeType===Node.TEXT_NODE){text+=child.textContent;}});}
else{Array.from(div.childNodes).forEach(child=>{if(child.nodeType===Node.TEXT_NODE){text+=child.textContent;}});}
return text;}
function getJSONFromDiv(div){const box=div.closest('.outputBox')||div;const imgJson=box.dataset.generatedImage;if(imgJson)
return imgJson;const expandedSourceCards=div.querySelectorAll('.expanded-source-card');if(expandedSourceCards.length>0){return JSON.stringify(Array.from(expandedSourceCards).map((card)=>{const titleElem=card.querySelector('.expanded-title');const snippetElem=card.querySelector('.expanded-snippet');const url=card.href||card.getAttribute('href')||'';const aiSnippets=card.dataset.aiSnippets||'';return{aiSnippets:aiSnippets,description:snippetElem?snippetElem.textContent:'',title:titleElem?titleElem.textContent:'',url:url};}));}
const compactSourceCards=div.querySelectorAll('.compact-sources-grid .compact-source-card');if(compactSourceCards.length>0){const payload=Array.from(compactSourceCards).map(card=>({aiSnippets:"",description:"",title:card.querySelector('.source-title')?.textContent||"",url:card.href}));return JSON.stringify(payload);}
const searchResults=div.querySelectorAll('.resultsContainer .resultDiv');if(searchResults.length>0){return JSON.stringify(Array.from(searchResults).slice(0,maxChips).map((resultDiv)=>({aiSnippets:resultDiv.dataset.aiSnippets,title:resultDiv.querySelector('.title').textContent,url:resultDiv.querySelector('.url').getAttribute('href')})));}
return"";}
function uuidv4(){const s=[];const hexDigits="0123456789abcdef";for(let i=0;i<36;i++){s[i]=hexDigits.substr(Math.floor(Math.random()*0x10),1);}
s[14]="4";s[19]=hexDigits.substr((parseInt(s[19],16)&0x3)|0x8,1);s[8]=s[13]=s[18]=s[23]="-";return s.join("");}
let currentChatUUID=uuidv4();let chatRunning=false;const scrollBtn=document.getElementById('scrollToBottomButton');const compose=document.querySelector('.persistent-compose-area');let updateScrollBtn=null;if(scrollBtn&&compose){new ResizeObserver(([e])=>{const height=e.borderBoxSize?.[0]?.blockSize??e.contentRect.height;document.documentElement.style.setProperty('--compose-h',`${Math.round(height)}px`);}).observe(compose);if(!user_paid_for_no_ads&&!characterEnabled)
document.body.classList.add('shows-ads');updateScrollBtn=()=>{const{scrollTop,scrollHeight,clientHeight}=document.documentElement;scrollBtn.style.display=scrollHeight-scrollTop-clientHeight<80?'none':'flex';};let timeout;window.addEventListener('scroll',()=>{clearTimeout(timeout);timeout=setTimeout(updateScrollBtn,50);});updateScrollBtn();scrollBtn.onclick=()=>window.scrollTo({top:document.documentElement.scrollHeight,behavior:'smooth'});}
async function saveChatHistory(){const chatHistory=getFullChatHistoryObject();if(!chatHistory||chatHistory.length===0){console.log("No messages to save, skipping saveChatHistory");return;}
if(currentlyLoadingChat&&!chatModifiedSinceLoad){console.log("Chat loaded but not modified, skipping saveChatHistory");return;}
document.querySelectorAll('.chatbox-wrapper.empty-box').forEach(wrapper=>{wrapper.style.visibility='visible';wrapper.style.opacity='0';});const uuid=currentChatUUID;const title="";const form=new FormData();form.append("uuid",uuid);form.append("title",title);form.append("chat_style",chat_style);form.append("messages",JSON.stringify(chatHistory));const response=await fetch(app_base_url+"/save_chat_session",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("saveChatHistory response",data);try{saveSessionUUIDToLocalStorage(currentChatUUID);}
catch(e){console.log("error saving session uuid to localStorage",e);}}
async function getChatHistory(uuidToFetch){const response=await fetch(app_base_url+"/get_chat_session?uuid="+uuidToFetch,{credentials:'include',method:"GET"});const data=await response.json();console.log("getChatHistory response",data);return data;}
async function deleteAllChatHistory(){let existingUUIDs=getChatSessionUUIDsFromLocalStorage();const form=new FormData();form.append("my_known_uuids",JSON.stringify(existingUUIDs));const response=await fetch(app_base_url+"/delete_all_chat_history",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("deleteAllChatHistory response",data);window.location.reload();}
async function deleteChatHistoryEntry(uuidToDelete){const form=new FormData();form.append("uuid",uuidToDelete);const response=await fetch(app_base_url+"/delete_chat_session",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("deleteChatHistoryEntry response",data);if(uuidToDelete===currentChatUUID){window.location.reload();}
else{const item=document.querySelector(`.chat-history-item-wrapper[data-session-id="${uuidToDelete}"]`);if(item){item.remove();}}}
async function reportCharacter(){const reason=prompt("Please provide a reason for reporting this character. Note that we are unable to change the character's features and/or text, or generate new characters from here, and this field is intended for reporting inappropriate characters.");if(!reason){alert("You must provide a reason to report the character.");return;}
const form=new FormData();form.append("reason",reason);if(characterEnabled){form.append("character_url",chat_style);}
form.append("chat_history",JSON.stringify(getFullChatHistoryObject()));try{const response=await fetch(app_base_url+"/report_character",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("reportCharacter response",data);if(data.status==="Success"){alert("Thank you for cooperation. This character has been reported.");}
else{alert("Error reporting character. Please try again.");}}
catch(error){console.error("Error reporting character:",error);alert("An error occurred while reporting the character. Please try again.");}}
async function renameChatHistoryEntry(uuid,title){const form=new FormData();form.append("uuid",uuid);form.append("title",title);const response=await fetch(app_base_url+"/rename_chat_session",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("renameChatHistoryEntry response",data);}
function clearChat(){const elementsToRemove=document.querySelectorAll(".chatbox-wrapper, .outputBox, .chat-ad-container, "+".adsbykoah");elementsToRemove.forEach(element=>{detachMaquetteProjectors(element);element.remove();});chatBoxUneditedText={};const convo=document.getElementById('convo');if(convo){convo.style.minHeight='';}}
function displayChatHistory(chatHistory){const convo=document.getElementById('convo');const originalScrollBehavior=getComputedStyle(convo).scrollBehavior;convo.style.setProperty('scroll-behavior','auto','important');convo.classList.add('no-scroll-animation');currentlyLoadingChat=true;chatModifiedSinceLoad=false;document.querySelectorAll('.header-slide-element').forEach(el=>el.classList.remove('header-slide-hidden'));convo.classList.remove('reduced-gradient');convo.style.opacity="0";clearChat();for(const message of chatHistory.messages){if(message.role==="user"){if(message.content.trim()!==""){const newBox=newChatBox(message.content);newBox.style.visibility='visible';newBox.style.display='block';newBox.style.opacity='1';if(message.attachment_uuids&&message.attachment_uuids.length>0){newBox.setAttribute('data-attachment-uuids',JSON.stringify(message.attachment_uuids));}
convo.appendChild(newBox);optimizeChatPromptBox(newBox);if(message.attachments&&message.attachments.length>0){const attachmentsEl=renderMessageAttachmentsFromData(message.attachments);if(attachmentsEl){const optionsBox=newBox.querySelector('.chatoptionsBox');if(optionsBox){optionsBox.insertAdjacentElement('beforebegin',attachmentsEl);}
else{newBox.appendChild(attachmentsEl);}}}
else if(message.attachment_uuids&&message.attachment_uuids.length>0){renderMessageAttachments(message.attachment_uuids).then(attachmentsEl=>{if(attachmentsEl){const optionsBox=newBox.querySelector('.chatoptionsBox');if(optionsBox){optionsBox.insertAdjacentElement('beforebegin',attachmentsEl);}
else{newBox.appendChild(attachmentsEl);}
enableImageClickToFullSize();}}).catch(err=>{console.error('Failed to render attachments:',err);});}}}
else if(message.role==="assistant"){const outputBox=newOutputBox(message.content);convo.appendChild(outputBox);}
else{console.log("unknown message role",message.role);}}
const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox){persistentChatbox.value='';persistentChatbox.style.height='auto';persistentChatbox.dispatchEvent(new Event('input',{bubbles:true}));}
updateMarkDown();enableImageClickToFullSize();setTimeout(()=>{document.querySelectorAll('.chatbox-wrapper, .outputBox').forEach(box=>{box.style.visibility='visible';box.style.display='block';box.style.opacity='1';});convo.style.opacity="1";if(persistentChatbox){persistentChatbox.focus();}
convo.style.scrollBehavior=originalScrollBehavior;convo.classList.remove('no-scroll-animation');setTimeout(()=>{currentlyLoadingChat=false;document.querySelectorAll('.chatbox-wrapper, .outputBox').forEach(box=>{box.style.visibility='visible';box.style.display='block';box.style.opacity='1';});},300);},150);}
function saveSessionUUIDToLocalStorage(uuidToAdd){let existingUUIDs=localStorage.getItem("chatSessionUUIDs");if(existingUUIDs===null){existingUUIDs=[];}
else{try{existingUUIDs=JSON.parse(existingUUIDs);}
catch(e){console.log("error parsing existingUUIDs",e);existingUUIDs=[];}}
existingUUIDs.push(uuidToAdd);existingUUIDs=[...new Set(existingUUIDs)];localStorage.setItem("chatSessionUUIDs",JSON.stringify(existingUUIDs));}
function getChatSessionUUIDsFromLocalStorage(){let existingUUIDs=localStorage.getItem("chatSessionUUIDs");if(existingUUIDs===null){existingUUIDs=[];}
else{try{existingUUIDs=JSON.parse(existingUUIDs);}
catch(e){console.log("error parsing existingUUIDs",e);existingUUIDs=[];}}
return existingUUIDs;}
async function getMyChatSessionsAndConvertAnonymousSessions(){let existingUUIDs=getChatSessionUUIDsFromLocalStorage();const form=new FormData();form.append("my_known_uuids",JSON.stringify(existingUUIDs));const response=await fetch(app_base_url+"/get_my_chat_sessions_and_convert_anonymous_sessions",{credentials:'include',method:"POST",body:form});const data=await response.json();console.log("getMyChatSessionsAndConvertAnonymousSessions response",data);try{if(data.session_uuids_to_forget&&Array.isArray(data.session_uuids_to_forget)){let updatedUUIDs=existingUUIDs.filter(uuid=>!data.session_uuids_to_forget.includes(uuid));localStorage.setItem("chatSessionUUIDs",JSON.stringify(updatedUUIDs));let numRemoved=existingUUIDs.length-updatedUUIDs.length;console.log(`Removed ${numRemoved} session_uuids_to_forget from localStorage`);}}
catch(e){console.log('error removing session_uuids_to_forget from localStorage',e);}
return data;}
let confirmModalRoot,confirmTitleEl,confirmDescEl,confirmInputEl;let confirmYesBtn,confirmCancelBtn,confirmActionCallback=null,requiredConfirmText=null;function openConfirmModal({title,desc,requireText,confirmLabel,onConfirm}){if(!confirmModalRoot)
return;confirmActionCallback=onConfirm;requiredConfirmText=requireText||null;confirmTitleEl.textContent=title;confirmDescEl.innerHTML=desc;confirmInputEl.value="";confirmInputEl.style.display=requireText?"block":"none";confirmYesBtn.textContent=confirmLabel||"Delete";confirmYesBtn.disabled=!!requireText;confirmModalRoot.classList.add('visible');}
function closeConfirmModal(){confirmModalRoot.classList.remove('visible');confirmActionCallback=null;requiredConfirmText=null;confirmYesBtn.disabled=false;}
function setupGlobalContextMenu(){if(window.__globalContextMenu)
return;const sidebarContent=document.querySelector('.sidebar-content');const menu=document.createElement('div');menu.classList.add('chat-history-context-menu');menu.style.display='none';menu.innerHTML=`
    <button class="history-rename-btn">Rename</button>
    <button class="history-delete-btn">Delete</button>
  `;document.body.appendChild(menu);window.__globalContextMenu=menu;menu.querySelector('.history-rename-btn').addEventListener('click',()=>{const activeItem=document.querySelector('.chat-history-item.menu-open');if(activeItem)
startInlineRename(activeItem);closeGlobalContextMenu();});menu.querySelector('.history-delete-btn').addEventListener('click',()=>{const activeItem=document.querySelector('.chat-history-item.menu-open');if(activeItem)
confirmDeleteSingle(activeItem.closest('.chat-history-item-wrapper').dataset.sessionId);closeGlobalContextMenu();});document.addEventListener('click',(evt)=>{if(menu.style.display==='block'&&!menu.contains(evt.target))
closeGlobalContextMenu();});}
function openGlobalContextMenu(rect){const menu=window.__globalContextMenu;if(!menu)
return;menu.style.position='fixed';menu.style.top=rect.top+'px';menu.style.left=rect.left+'px';menu.style.zIndex='6';menu.style.display='block';const sidebarContent=document.querySelector('.sidebar-content');if(sidebarContent)
sidebarContent.classList.add('no-scroll');}
function closeGlobalContextMenu(){const menu=window.__globalContextMenu;if(!menu||menu.style.display==='none')
return;menu.style.display='none';const sidebarContent=document.querySelector('.sidebar-content');if(sidebarContent)
sidebarContent.classList.remove('no-scroll');document.querySelectorAll('.chat-history-item.menu-open').forEach(it=>it.classList.remove('menu-open'));}
function startInlineRename(activeItemEl){activeItemEl.classList.add('rename-open');const labelSpan=activeItemEl.querySelector('.chat-history-label');if(!labelSpan)
return;const originalText=labelSpan.textContent||'';const input=document.createElement('input');input.type='text';input.value=originalText;input.className='inline-rename-input';activeItemEl.replaceChild(input,labelSpan);input.focus();input.select();let renameDone=false;function keydownHandler(e){if(e.key==='Enter')
finalize();else if(e.key==='Escape')
revert();}
function blurHandler(){finalize();}
input.addEventListener('keydown',keydownHandler);input.addEventListener('blur',blurHandler);const revert=()=>{if(renameDone)
return;renameDone=true;input.removeEventListener('keydown',keydownHandler);input.removeEventListener('blur',blurHandler);labelSpan.textContent=originalText;if(input.parentNode===activeItemEl){activeItemEl.replaceChild(labelSpan,input);}
activeItemEl.classList.remove('rename-open');};const finalize=async()=>{if(renameDone)
return;renameDone=true;input.removeEventListener('keydown',keydownHandler);input.removeEventListener('blur',blurHandler);const newTitle=input.value.trim();if(!newTitle){revert();return;}
const sessionId=activeItemEl.closest('.chat-history-item-wrapper').dataset.sessionId;try{await renameChatHistoryEntry(sessionId,newTitle);labelSpan.textContent=newTitle;if(input.parentNode===activeItemEl){activeItemEl.replaceChild(labelSpan,input);}}
catch{revert();return;}
activeItemEl.classList.remove('rename-open');};}
function confirmDeleteSingle(sessionId){openConfirmModal({title:"Delete Chat",desc:"Are you sure you want to delete this chat?<br/>This cannot be undone.",onConfirm:async()=>{await deleteChatHistoryEntry(sessionId);}});}
function confirmDeleteAll(){openConfirmModal({title:"Delete Chat History",desc:"This action <b>cannot</b> be undone. This will permanently delete all chat history. Please type <b>delete-all-chat-history</b> to confirm.",requireText:"delete-all-chat-history",confirmLabel:"Delete All",onConfirm:async()=>{await deleteAllChatHistory();}});}
async function displayMyChatSessions(){const data=await getMyChatSessionsAndConvertAnonymousSessions();let mySessions=data.sessions||[];mySessions.sort((a,b)=>new Date(b.updated_at).getTime()-new Date(a.updated_at).getTime());const groups={};mySessions.forEach(s=>{const date=new Date(s.updated_at||new Date());const label=categorizeSessionByDate(date);groups[label]=groups[label]||[];groups[label].push(s);});const historyList=document.getElementById('chatHistoryList');historyList.innerHTML='';for(const label of Object.keys(groups)){const heading=document.createElement('div');heading.classList.add('history-heading-label');heading.textContent=label;historyList.appendChild(heading);groups[label].forEach(session=>{const row=createChatHistoryItem(session);historyList.appendChild(row);});}
let found=Object.values(groups).some(arr=>arr.some(s=>s.uuid===currentChatUUID));if(!found&&currentChatUUID){const newRow=createChatHistoryItem({uuid:currentChatUUID,title:'New Chat',updated_at:new Date().toISOString(),chat_style:''});newRow.classList.add('new-chat');let newChatLabel=Array.from(historyList.querySelectorAll('.history-heading-label')).find(lbl=>lbl.textContent==='Today');if(!newChatLabel){newChatLabel=document.createElement('div');newChatLabel.classList.add('history-heading-label');newChatLabel.textContent='Today';historyList.insertBefore(newChatLabel,historyList.firstChild);}
historyList.insertBefore(newRow,newChatLabel.nextSibling);}
const firstLabel=historyList.querySelector('.history-heading-label');if(firstLabel){firstLabel.style.marginTop='0';}
updateCurrentChatHighlight();}
function createChatHistoryItem(session){const wrap=document.createElement('div');wrap.classList.add('chat-history-item-wrapper');wrap.dataset.sessionId=session.uuid;const item=document.createElement('div');item.classList.add('chat-history-item');const labelSpan=document.createElement('span');labelSpan.classList.add('chat-history-label');labelSpan.textContent=session.title||'Untitled Chat';item.appendChild(labelSpan);const dots=document.createElement('div');dots.classList.add('chat-history-dots');dots.textContent='';item.appendChild(dots);wrap.appendChild(item);item.addEventListener('click',async()=>{if(session.uuid===currentChatUUID){return;}
if(session.chat_style&&session.chat_style!==chat_style){sessionStorage.setItem('redirect_chat_id',session.uuid);let redirectUrl;if(session.chat_style==="chat"){redirectUrl="/chat";}
else{redirectUrl=`/chat/${session.chat_style}`;}
window.location.href=redirectUrl;return;}
currentChatUUID=session.uuid;clearChat();const chatData=await getChatHistory(session.uuid);displayChatHistory(chatData);updateMarkDown();updateCurrentChatHighlight();const historyList=document.getElementById('chatHistoryList');let todayLabel=Array.from(historyList.querySelectorAll('.history-heading-label')).find(lbl=>lbl.textContent==='Today');if(todayLabel){const nextSibling=todayLabel.nextElementSibling;if(nextSibling&&nextSibling.classList.contains('history-heading-label')){todayLabel.remove();const firstLabel=historyList.querySelector('.history-heading-label');if(firstLabel){firstLabel.style.marginTop='0';}}}});dots.addEventListener('click',(e)=>{e.stopPropagation();closeGlobalContextMenu();item.classList.add('menu-open');openGlobalContextMenu(dots.getBoundingClientRect());});return wrap;}
function checkUrlForChatId(){const chatId=sessionStorage.getItem('redirect_chat_id');if(chatId){sessionStorage.removeItem('redirect_chat_id');setTimeout(async()=>{try{currentChatUUID=chatId;const chatData=await getChatHistory(chatId);currentlyLoadingChat=true;displayChatHistory(chatData);updateMarkDown();updateCurrentChatHighlight();document.body.classList.remove('loading-chat-history');}
catch(error){console.error("Error loading redirected chat:",error);document.body.classList.remove('loading-chat-history');const convo=document.getElementById('convo');if(convo)
convo.style.opacity="1";}},100);}}
function updateCurrentChatHighlight(){document.querySelectorAll('.chat-history-item-wrapper').forEach(w=>{const wrapper=w;const sid=wrapper.dataset.sessionId;const item=wrapper.querySelector('.chat-history-item');if(wrapper.classList.contains('new-chat')&&sid!==currentChatUUID)
wrapper.remove();sid===currentChatUUID?item.classList.add('current-chat'):item.classList.remove('current-chat','active');});}
function categorizeSessionByDate(dateObj){const now=new Date(),daysDiff=(now.getTime()-dateObj.getTime())/(1000*60*60*24);if(daysDiff<1)
return'Today';if(daysDiff<2)
return'Yesterday';if(daysDiff<7)
return'Previous 7 Days';if(daysDiff<30)
return'Previous 30 Days';const m=["January","February","March","April","May","June","July","August","September","October","November","December"];return m[dateObj.getMonth()]+" "+dateObj.getFullYear();}
async function save_user_sees_ads_value(){let user_sees_ads=false;if(typeof window.fsprebid==='object'){user_sees_ads=true;}
console.log('user_sees_ads: ',user_sees_ads);const url=app_base_url+'/set_user_sees_ads';const form=new FormData();form.append('user_sees_ads',user_sees_ads+"");const apiResult=await fetch(url,{method:'POST',body:form,credentials:'include'});if(!apiResult.ok){throw apiResult;}}
setTimeout(save_user_sees_ads_value,10000);let mediaRecorder;let recordedChunks=[];let isRecording=false;const micIconHTML='<img src="/static/images/mic.svg" alt="Mic Icon" class="mic-icon">';async function handleRecording(){if(!isRecording){await startRecording();}
else{stopRecording();}}
async function startRecording(){recordedChunks=[];try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRecorder=new MediaRecorder(stream);mediaRecorder.ondataavailable=(event)=>{if(event.data.size>0){recordedChunks.push(event.data);}};mediaRecorder.onstop=async()=>{await handleRecordingStop(stream);};mediaRecorder.start();updateButtonForRecording();isRecording=true;}
catch(err){console.error('Mic access error or unsupported browser:',err);toast("errorpopup","Mic access error or unsupported browser.");}}
async function handleRecordingStop(stream){const blob=new Blob(recordedChunks,{type:mediaRecorder.mimeType||'audio/webm'});const recordButton=document.getElementById('recordButton');recordButton.classList.remove('recording');recordButton.classList.add('text');recordButton.innerHTML='Processing...';try{const form=new FormData();form.append('voiceRecording',blob,'myFunRecording.webm');const tryitApiKey=generateTryitApiKey();const response=await fetch(app_base_url+"/speech_to_text",{credentials:'include',method:"POST",body:form,headers:{'api-key':tryitApiKey,},});if(!response.ok){throw new Error('Server error: '+response.statusText);}
const result=await response.json();const persistentChatbox=document.getElementById('persistentChatbox');if(persistentChatbox&&result.text){const currentText=persistentChatbox.value;persistentChatbox.value=currentText+result.text;persistentChatbox.style.height='auto';persistentChatbox.style.height=persistentChatbox.scrollHeight+'px';persistentChatbox.dispatchEvent(new Event('input',{bubbles:true}));persistentChatbox.focus();}}
catch(err){console.error('Upload error:',err);toast("errorpopup","An error occurred during upload or processing.");}
finally{resetButtonAfterProcessing();stream.getTracks().forEach((track)=>track.stop());}}
function stopRecording(){const recordButton=document.getElementById('recordButton');if(mediaRecorder&&mediaRecorder.state!=='inactive'){mediaRecorder.stop();}
recordButton.classList.remove('recording','text');recordButton.innerHTML=micIconHTML;isRecording=false;}
function updateButtonForRecording(){const recordButton=document.getElementById('recordButton');recordButton.classList.add('recording','text');recordButton.innerHTML='';setTimeout(()=>{recordButton.innerHTML='<span class="fade-in">Stop Recording</span>';const fadeInElement=recordButton.querySelector('.fade-in');setTimeout(()=>{fadeInElement.classList.add('show');},10);},100);}
function resetButtonAfterProcessing(){const recordButton=document.getElementById('recordButton');setTimeout(()=>{recordButton.innerHTML=micIconHTML;recordButton.classList.remove('text');},300);}
function generateTryitApiKey(){let myrandomstr=Math.round((Math.random()*100000000000))+"";const myhashfunction=function(){for(var a=[],b=0;64>b;)
a[b]=0|4294967296*Math.sin(++b%Math.PI);return function(c){var d,e,f,g=[d=1732584193,e=4023233417,~d,~e],h=[],l=unescape(encodeURI(c))+"\u0080",k=l.length;c=--k/4+2|15;for(h[--c]=8*k;~k;)
h[k>>2]|=l.charCodeAt(k)<<8*k--;for(b=l=0;b<c;b+=16){for(k=g;64>l;k=[f=k[3],d+((f=k[0]+[d&e|~d&f,f&d|~f&e,d^e^f,e^(d|~f)][k=l>>4]+a[l]+~~h[b|[l,5*l+1,3*l+5,7*l][k]&15])<<(k=[7,12,17,22,5,9,14,20,4,11,16,23,6,10,15,21][4*k+l++%4])|f>>>-k),d,e])
d=k[1]|0,e=k[2];for(l=4;l;)
g[--l]+=k[l];}
for(c="";32>l;)
c+=(g[l>>3]>>4*(1^l++)&15).toString(16);return c.split("").reverse().join("");};}();const tryitApiKey='tryit-'+myrandomstr+'-'+myhashfunction(navigator.userAgent+myhashfunction(navigator.userAgent+myhashfunction(navigator.userAgent+myrandomstr+'hackers_become_a_little_stinkier_every_time_they_hack')));return tryitApiKey;}
(function(){if(!sessionStorage.getItem("selectedChatMode")){const defaultModel=ModelConfig.getDefaultModel();sessionStorage.setItem("selectedChatMode",defaultModel);}
ModelConfig.initializeModelPicker({menuId:'chatModeMenu',triggerBtnId:'chatModeDropdownButton',currentLabelId:'currentChatModeLabel',onSelect:(model)=>{updateModelChipSelection(model);}});if(characterEnabled){const dropdownContainer=document.querySelector('.chat-mode-dropdown-container');if(dropdownContainer){dropdownContainer.style.display='none';}}
function refreshChatModeMenu(){ModelConfig.initializeModelPicker({menuId:'chatModeMenu',triggerBtnId:'chatModeDropdownButton',currentLabelId:'currentChatModeLabel',onSelect:(model)=>{updateModelChipSelection(model);}});if(!characterEnabled){initializeModelChips();}};function updateModelChipSelection(model){const modelChips=document.querySelectorAll('.chat-model-chip');modelChips.forEach(chip=>{const chipModel=chip.getAttribute('data-model');if(chipModel===model){chip.classList.add('selected');}
else{chip.classList.remove('selected');}});}
function initializeModelChips(){const modelChips=document.querySelectorAll('.chat-model-chip');const currentModel=sessionStorage.getItem("selectedChatMode")||"standard";const userHasPro=user_object?.userprofile2?.user_can_use_genius_mode||false;modelChips.forEach(chip=>{const model=chip.getAttribute('data-model');const isLocked=chip.getAttribute('data-locked')==='true';if(!model)
return;if(model===currentModel){chip.classList.add('selected');}
if(isLocked){if(userHasPro){const lockIcon=chip.querySelector('.lock-icon');if(lockIcon){lockIcon.remove();}
chip.classList.remove('locked');}
else{chip.classList.add('locked');}}
chip.addEventListener('click',(e)=>{e.preventDefault();if(isLocked&&!userHasPro){openSubscription();return;}
modelChips.forEach(c=>c.classList.remove('selected'));chip.classList.add('selected');sessionStorage.setItem("selectedChatMode",model);const currentLabel=document.getElementById('currentChatModeLabel');if(currentLabel){const chipText=chip.querySelector('span')?.textContent||model;currentLabel.textContent=chipText;}});});}
if(!characterEnabled){initializeModelChips();}
function refreshChatModeMenuIfPro(){const userHasPro=user_object?.userprofile2?.user_can_use_genius_mode||false;if(userHasPro){refreshChatModeMenu();}}
onAfterAuthStatusCheck(refreshChatModeMenu);window.refreshChatModeMenu=refreshChatModeMenu;window.refreshChatModeMenuIfPro=refreshChatModeMenuIfPro;})();function getTextWidth(text,font){const canvas=document.createElement('canvas');const context=canvas.getContext('2d');context.font=font;return context.measureText(text).width;}
let chatModifiedSinceLoad=false;let currentlyLoadingChat=false;function initPersistentChatbox(){const persistentChatbox=document.getElementById('persistentChatbox');const chatboxContainer=document.querySelector('.persistent-compose-area');if(!persistentChatbox)
return;const convo=document.getElementById('convo');let chatboxWidth,chatboxHeight,font;function updateChatboxDimensions(){const currentValue=persistentChatbox.value;const currentHeight=persistentChatbox.style.height;const wasExpanded=chatboxContainer.classList.contains('expanded');persistentChatbox.value='';persistentChatbox.style.height='auto';chatboxContainer.classList.remove('expanded');const computedStyle=getComputedStyle(persistentChatbox);font=`${computedStyle.fontSize} ${computedStyle.fontFamily}`;chatboxWidth=persistentChatbox.clientWidth-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight);if(chatboxHeight===undefined){chatboxHeight=persistentChatbox.scrollHeight-parseFloat(computedStyle.paddingTop);}
persistentChatbox.value=currentValue;persistentChatbox.style.height=currentHeight;if(wasExpanded){chatboxContainer.classList.add('expanded');}}
updateChatboxDimensions();function handleResize(){persistentChatbox.style.height='auto';const currHeight=persistentChatbox.scrollHeight-parseFloat(getComputedStyle(persistentChatbox).paddingTop);const currWidth=getTextWidth(persistentChatbox.value,font);if(currHeight>chatboxHeight){chatboxContainer.classList.add('expanded');convo.style.paddingBottom='220px';document.querySelector('.fs-sticky-footer')?.classList?.add('fs-sticky-shifted');document.querySelector('.fs-sticky-parent')?.classList?.add('fs-sticky-shifted');}
else if(currHeight<=chatboxHeight&&currWidth<chatboxWidth){chatboxContainer.classList.remove('expanded');convo.style.paddingBottom='170px';document.querySelector('.fs-sticky-footer')?.classList?.remove('fs-sticky-shifted');document.querySelector('.fs-sticky-parent')?.classList?.remove('fs-sticky-shifted');}
const attachmentsContainer=document.getElementById('chatAttachmentsContainer');const hasAttachments=attachmentsContainer&&attachmentsContainer.children.length>0;const heightAdjustment=hasAttachments?3:0;persistentChatbox.style.height=(persistentChatbox.scrollHeight+heightAdjustment)+'px';}
if(typeof ResizeObserver!=='undefined'){let lastWidth=0;const resizeObserver=new ResizeObserver((entries)=>{for(const entry of entries){const width=entry.contentRect.width;if(width!==lastWidth){lastWidth=width;window.requestAnimationFrame(()=>{updateChatboxDimensions();handleResize();});}}});resizeObserver.observe(persistentChatbox);}
else{}
persistentChatbox.addEventListener('input',handleResize);const dropdown=document.getElementById('chatModeDropdownButton');if(dropdown){dropdown.classList.toggle('compact',persistentChatbox.value.trim().length>0);persistentChatbox.addEventListener('input',function(){dropdown.classList.toggle('compact',this.value.trim().length>0&&!chatboxContainer.classList.contains('expanded'));});}
persistentChatbox.style.height=persistentChatbox.scrollHeight+'px';const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||('ontouchstart'in window)||(navigator.maxTouchPoints&&navigator.maxTouchPoints>0);if(!isMobile){persistentChatbox.focus();}}
function initEventDelegation(){const persistentChatbox=document.getElementById('persistentChatbox');const chatSubmitButton=document.getElementById('chatSubmitButton');if(persistentChatbox&&chatSubmitButton){chatSubmitButton.disabled=!persistentChatbox.value.trim();persistentChatbox.addEventListener('input',function(){chatSubmitButton.disabled=!this.value.trim();});const ime=setupIMEHandlers(persistentChatbox);persistentChatbox.addEventListener('keydown',function(e){if(ime.isComposing()||ime.compositionJustEnded()){return;}
if(e.key==='Enter'&&!e.shiftKey){const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(isMobile){return;}
e.preventDefault();const chatSubmitElem=document.getElementById("chatSubmitButton");const chatStopElem=document.getElementById("chatStopButton");const isThinking=chatStopElem.style.display==="block"||chatSubmitElem.style.display==="none";if(!chatSubmitButton.disabled&&!isCurrentlyStreaming&&!isThinking){chatSubmit('','',true);}}});}
document.addEventListener('input',function(event){const target=event.target;if(target.classList.contains('chatbox')&&target.closest('.chatbox-wrapper[data-edited]')){const wrapper=target.closest('.chatbox-wrapper');const saveButton=wrapper.querySelector('.chatEditSubmitButton');if(saveButton){const currentText=target.value.trim();const originalText=chatBoxUneditedText[wrapper.id]||'';saveButton.disabled=!currentText||currentText===originalText.trim();}}});}
window.addEventListener('resize',function(){document.querySelectorAll('.chatbox-wrapper textarea.chatbox').forEach(textarea=>{adjustTextareaHeight(textarea);});});const standardThinkingWords=["Thinking","Pondering","Considering","Processing","Reflecting","Analyzing","Contemplating","Calculating","Working","Reviewing"];const geniusThinkingWords=["Ratiocinating","Excogitating","Lucubrating","Cogitating","Noesizing","Cerebrating","Ideating","Intellecting","Discursing","Apperceiving"];function showThinkingIndicator(){const selectedMode=sessionStorage.getItem("selectedChatMode")||"standard";const wordList=selectedMode==="supergenius"?geniusThinkingWords:standardThinkingWords;const randomIndex=Math.floor(Math.random()*wordList.length);const thinkingWord=wordList[randomIndex];const thinkingIndicator=document.createElement('div');thinkingIndicator.className='thinking-indicator';thinkingIndicator.innerHTML=`<span class="thinking-text">${thinkingWord}</span><span class="thinking-dots"></span>`;const convo=document.getElementById('convo');convo.appendChild(thinkingIndicator);requestAnimationFrame(()=>{convo.style.minHeight='';const rect=thinkingIndicator.getBoundingClientRect();if(rect.top>0){const convoCurrentHeight=convo.scrollHeight;const elementHeight=rect.height;const minResponseHeight=150;const neededHeight=convoCurrentHeight+elementHeight+minResponseHeight;convo.style.minHeight=`${neededHeight}px`;}
thinkingIndicator.scrollIntoView({behavior:'smooth',block:'start',inline:'nearest'});});return thinkingIndicator;}
function removeThinkingIndicator(){const indicator=document.querySelector('.thinking-indicator');if(indicator){indicator.remove();}}
(()=>{const layoutContainer=document.getElementById("layoutContainer");const sidebarOverlay=document.getElementById("sidebarOverlay");const sidebarToggle=document.getElementById("sidebarToggle");const sidebarHeader=document.querySelector(".sidebar-header");function getSavedSidebarState(){if(window.innerWidth>=1200){try{const savedState=localStorage.getItem('sidebarState');return(savedState==='open'||savedState==='closed')?savedState:null;}
catch(e){console.log('Error reading sidebar state',e);}}
return null;}
function saveSidebarState(isOpen){if(window.innerWidth>=1200){try{localStorage.setItem('sidebarState',isOpen?'open':'closed');}
catch(e){console.log('Error saving sidebar state',e);}}}
function setSidebarState(open){if(layoutContainer){layoutContainer.classList.toggle('sidebar-open',open);}
if(sidebarOverlay&&window.innerWidth<1200){sidebarOverlay.classList.toggle('active',open);}}
function toggleSidebar(){const isOpen=layoutContainer?layoutContainer.classList.contains("sidebar-open"):false;const newState=!isOpen;saveSidebarState(newState);setSidebarState(newState);}
function initSidebar(){const savedState=getSavedSidebarState();if(savedState){setSidebarState(savedState==='open');}
else{setSidebarState(window.innerWidth>=1200);}}
initSidebar();window.addEventListener("resize",function(){if(window.innerWidth<1200){setSidebarState(false);return;}
const savedState=getSavedSidebarState();if(savedState){setSidebarState(savedState==='open');}
else{setSidebarState(true);}});if(sidebarToggle){sidebarToggle.addEventListener("click",toggleSidebar);}
if(sidebarHeader){sidebarHeader.addEventListener("click",toggleSidebar);}
if(sidebarOverlay){sidebarOverlay.addEventListener("click",()=>setSidebarState(false));}
confirmModalRoot=document.getElementById('confirm-modal-root');confirmTitleEl=document.getElementById('confirm-title');confirmDescEl=document.getElementById('confirm-desc');confirmInputEl=document.getElementById('confirm-input');confirmYesBtn=document.getElementById('confirm-yes-btn');confirmCancelBtn=document.getElementById('confirm-cancel-btn');if(confirmCancelBtn){confirmCancelBtn.addEventListener('click',closeConfirmModal);}
if(confirmYesBtn){confirmYesBtn.addEventListener('click',()=>{if(confirmActionCallback)
confirmActionCallback();closeConfirmModal();});}
if(confirmInputEl){confirmInputEl.addEventListener('input',()=>{if(!requiredConfirmText||!confirmInputEl)
return;if(confirmYesBtn){confirmYesBtn.disabled=(confirmInputEl.value.trim()!==requiredConfirmText);}});}
if(confirmModalRoot){confirmModalRoot.addEventListener('click',(e)=>{if(e.target===confirmModalRoot){closeConfirmModal();}});}
window.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&confirmModalRoot&&confirmModalRoot.classList.contains('visible')){closeConfirmModal();}});const deleteAllBtn=document.querySelector('.delete-all-history-button');if(deleteAllBtn){deleteAllBtn.addEventListener('click',confirmDeleteAll);}
const searchInput=document.getElementById('chatHistorySearchInput');const searchIcon=document.getElementById('chatHistorySearchIcon');const searchClearBtn=document.getElementById('chatHistorySearchClear');const historyListEl=document.getElementById('chatHistoryList');const searchStatusEl=document.getElementById('chatHistorySearchStatus');let searchTimeout=null;let currentSearchQuery='';let isSearching=false;let queuedSearch=null;async function performChatHistorySearch(query){if(isSearching){queuedSearch=query;return;}
isSearching=true;try{if(searchInput)
searchInput.classList.add('searching');if(searchIcon)
searchIcon.style.display='none';if(searchClearBtn){searchClearBtn.style.display='none';searchClearBtn.innerHTML='<div class="search-spinner"></div>';searchClearBtn.style.display='flex';searchClearBtn.disabled=true;}
const sessionIds=[];if(historyListEl){const allItems=historyListEl.querySelectorAll('.chat-history-item-wrapper');allItems.forEach(item=>{const sessionId=item.dataset.sessionId;if(sessionId){sessionIds.push(sessionId);}});}
const form=new FormData();form.append('query',query);form.append('session_ids',JSON.stringify(sessionIds));const response=await fetch(app_base_url+'/search_chat_history',{credentials:'include',method:'POST',body:form});if(!response.ok){throw new Error('Search failed');}
const results=await response.json();if(queuedSearch){const nextQuery=queuedSearch;queuedSearch=null;isSearching=false;performChatHistorySearch(nextQuery);}
else{displaySearchResults(results);}}
catch(error){console.error('Search error:',error);resetSearch();}
finally{isSearching=false;if(searchInput)
searchInput.classList.remove('searching');if(searchClearBtn){searchClearBtn.disabled=false;searchClearBtn.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>';}
if(searchInput&&searchInput.value.trim()){if(searchIcon)
searchIcon.style.display='none';if(searchClearBtn)
searchClearBtn.style.display='flex';}
else{if(searchIcon)
searchIcon.style.display='flex';if(searchClearBtn)
searchClearBtn.style.display='none';}
if(queuedSearch){const nextQuery=queuedSearch;queuedSearch=null;performChatHistorySearch(nextQuery);}}}
function displaySearchResults(results){if(!historyListEl)
return;const allItems=historyListEl.querySelectorAll('.chat-history-item-wrapper');const allHeadings=historyListEl.querySelectorAll('.history-heading-label');allItems.forEach(item=>item.classList.add('search-hidden'));allHeadings.forEach(heading=>heading.classList.add('search-hidden'));if(results.session_ids&&results.session_ids.length>0){const matchedHeadings=new Set();results.session_ids.forEach(sessionId=>{const item=historyListEl.querySelector(`.chat-history-item-wrapper[data-session-id="${sessionId}"]`);if(item){item.classList.remove('search-hidden');let prevSibling=item.previousElementSibling;while(prevSibling){if(prevSibling.classList.contains('history-heading-label')){matchedHeadings.add(prevSibling);break;}
prevSibling=prevSibling.previousElementSibling;}}});matchedHeadings.forEach(heading=>{heading.classList.remove('search-hidden');});const existingFirst=historyListEl.querySelector('.first-visible');if(existingFirst)
existingFirst.classList.remove('first-visible');const firstVisible=historyListEl.querySelector('.history-heading-label:not(.search-hidden), .chat-history-item-wrapper:not(.search-hidden)');if(firstVisible)
firstVisible.classList.add('first-visible');historyListEl.style.display='block';if(searchStatusEl)
searchStatusEl.textContent='';}
else{historyListEl.style.display='block';if(searchStatusEl)
searchStatusEl.textContent='No matching chats found';}}
function resetSearch(){if(!historyListEl)
return;const allItems=historyListEl.querySelectorAll('.chat-history-item-wrapper');const allHeadings=historyListEl.querySelectorAll('.history-heading-label');allItems.forEach(item=>item.classList.remove('search-hidden'));allHeadings.forEach(heading=>heading.classList.remove('search-hidden'));const firstVisible=historyListEl.querySelector('.first-visible');if(firstVisible)
firstVisible.classList.remove('first-visible');historyListEl.style.display='block';if(searchStatusEl)
searchStatusEl.textContent='';if(searchInput)
searchInput.value='';currentSearchQuery='';queuedSearch=null;if(searchIcon)
searchIcon.style.display='flex';if(searchClearBtn)
searchClearBtn.style.display='none';}
if(searchInput){searchInput.addEventListener('keypress',(e)=>{if(e.key==='Enter'){e.preventDefault();const query=searchInput.value.trim();if(query){currentSearchQuery=query;performChatHistorySearch(query);}
else{resetSearch();}}});searchInput.addEventListener('input',(e)=>{if(searchTimeout){clearTimeout(searchTimeout);}
const query=searchInput.value.trim();if(query){if(searchIcon)
searchIcon.style.display='none';if(searchClearBtn)
searchClearBtn.style.display='flex';}
else{if(searchIcon)
searchIcon.style.display='flex';if(searchClearBtn)
searchClearBtn.style.display='none';}
if(!query&&currentSearchQuery){resetSearch();}
else if(query){searchTimeout=setTimeout(()=>{currentSearchQuery=query;performChatHistorySearch(query);},300);}});}
if(searchClearBtn){searchClearBtn.addEventListener('click',()=>{resetSearch();if(searchInput)
searchInput.focus();});}
setupGlobalContextMenu();displayMyChatSessions();onAfterAuthStatusCheck(displayMyChatSessions);let lastScrollTop=0;const mobileBreakpoint=1200;const scrollThreshold=10;function handleVisibility(){const currentScrollTop=window.pageYOffset||document.documentElement.scrollTop;const isMobile=window.innerWidth<mobileBreakpoint;if(isMobile){if(currentScrollTop>lastScrollTop&&currentScrollTop>scrollThreshold){document.body.classList.add('buttons-hidden');}
else if(currentScrollTop<lastScrollTop||currentScrollTop<=scrollThreshold){document.body.classList.remove('buttons-hidden');}}
else{document.body.classList.remove('buttons-hidden');}
lastScrollTop=Math.max(0,currentScrollTop);}
window.addEventListener('scroll',handleVisibility,{passive:true});window.addEventListener('resize',handleVisibility);handleVisibility();setTimeout(()=>{if(layoutContainer){layoutContainer.classList.add('ready-for-animation');}},100);initPersistentChatbox();initEventDelegation();checkUrlForChatId();const recordButton=document.getElementById('recordButton');if(recordButton){recordButton.addEventListener('click',()=>{handleRecording();});}})();try{const convo=document.getElementById('convo');if(!user_paid_for_no_ads&&!characterEnabled){document.querySelectorAll('.new-chat-button-container, .sidebar-toggle-container, .sidebar-overlay').forEach(e=>e.style.setProperty('top','178px','important'));document.querySelectorAll('.chat-sidebar').forEach(e=>e.style.setProperty('top','167px','important'));if(convo){convo.style.paddingBottom='170px';}}
if(convo){convo.style.paddingBottom='138px';}}
catch(e){console.log('error adding margin to the bottom of the conversation when ads are showing',e);}
if(typeof freestarAdsLoaded!=='undefined'&&freestarAdsLoaded){(function(){const TARGET_ELEMENT_CLASS='persistent-compose-area';const CHECK_INTERVAL_MS=500;const MOVE_OFFSET_PX=-80;const MOVED_ATTRIBUTE='data-obstruction-moved';const ORIGINAL_TRANSFORM_ATTRIBUTE='data-original-transform';const ORIGINAL_ZINDEX_ATTRIBUTE='data-original-zindex';const TARGET_Z_INDEX=2147483647;const OBSTRUCTION_Z_INDEX_REDUCTION=1000;const movedElements=new WeakSet();const processedElements=new WeakMap();function hasMovedAncestor(element){let current=element.parentElement;while(current&&current!==document.body){if(current.hasAttribute(MOVED_ATTRIBUTE)){return true;}
current=current.parentElement;}
return false;}
function hasMovedDescendant(element){const movedDescendants=element.querySelectorAll(`[${MOVED_ATTRIBUTE}]`);return movedDescendants.length>0;}
function getComputedTransform(element){const transform=window.getComputedStyle(element).transform;return transform==='none'?'':transform;}
function ensureStackingContext(element){const style=window.getComputedStyle(element);const createsStackingContext=style.position!=='static'||style.opacity!=='1'||style.transform!=='none'||style.filter!=='none'||style.perspective!=='none'||style.clipPath!=='none'||style.mask!=='none'||style.isolation==='isolate'||style.mixBlendMode!=='normal'||style.willChange==='transform'||style.willChange==='opacity';if(!createsStackingContext){if(!element.hasAttribute('data-forced-stacking-context')){element.style.position='relative';element.setAttribute('data-forced-stacking-context','true');}}}
function adjustZIndex(element,targetElement){if(!element.hasAttribute(ORIGINAL_ZINDEX_ATTRIBUTE)){const originalZIndex=element.style.zIndex||'';element.setAttribute(ORIGINAL_ZINDEX_ATTRIBUTE,originalZIndex);}
const computedZIndex=window.getComputedStyle(element).zIndex;let currentZIndex=computedZIndex==='auto'?0:parseInt(computedZIndex,10);const newZIndex=Math.max(currentZIndex-OBSTRUCTION_Z_INDEX_REDUCTION,1);element.style.zIndex=newZIndex.toString();ensureStackingContext(element);processedElements.set(element,{originalZIndex:element.getAttribute(ORIGINAL_ZINDEX_ATTRIBUTE)||'',newZIndex:newZIndex});}
function setupTargetZIndex(targetElement){if(targetElement.hasAttribute('data-zindex-boosted')){return;}
const originalZIndex=targetElement.style.zIndex||'';targetElement.setAttribute('data-original-target-zindex',originalZIndex);targetElement.style.zIndex=TARGET_Z_INDEX.toString();ensureStackingContext(targetElement);targetElement.setAttribute('data-zindex-boosted','true');console.log(`Boosted .${TARGET_ELEMENT_CLASS} z-index to ${TARGET_Z_INDEX}`);}
function applyTransformSafely(element,targetElement){if(!element.hasAttribute(ORIGINAL_TRANSFORM_ATTRIBUTE)){const originalTransform=element.style.transform||'';element.setAttribute(ORIGINAL_TRANSFORM_ATTRIBUTE,originalTransform);}
const computedTransform=getComputedTransform(element);if(computedTransform&&computedTransform!=='none'){const temp=document.createElement('div');temp.style.transform=computedTransform;temp.style.transform+=` translateY(${MOVE_OFFSET_PX}px)`;element.style.transform=temp.style.transform;}
else{const originalTransform=element.getAttribute(ORIGINAL_TRANSFORM_ATTRIBUTE)||'';element.style.transform=originalTransform?`${originalTransform} translateY(${MOVE_OFFSET_PX}px)`:`translateY(${MOVE_OFFSET_PX}px)`;}
adjustZIndex(element,targetElement);element.setAttribute(MOVED_ATTRIBUTE,'true');movedElements.add(element);}
function isElementSafeToMove(element,targetElement){if(element.hasAttribute(MOVED_ATTRIBUTE)||movedElements.has(element)){return false;}
if(element===targetElement){return false;}
if(element.contains(targetElement)){return false;}
if(targetElement.contains(element)){return false;}
if(hasMovedAncestor(element)){return false;}
if(hasMovedDescendant(element)){return false;}
return true;}
function checkAndMoveObstructingElements(){if(user_paid_for_no_ads===true){return;}
if(characterEnabled){return;}
const targetElement=document.querySelector(`.${TARGET_ELEMENT_CLASS}`);if(!targetElement){return;}
setupTargetZIndex(targetElement);const rect=targetElement.getBoundingClientRect();const centerX=rect.left+rect.width/2;const centerY=rect.top+rect.height/2;if(centerX<0||centerY<0||centerX>window.innerWidth||centerY>window.innerHeight){return;}
const elementAtCenter=document.elementFromPoint(centerX,centerY);if(!elementAtCenter||elementAtCenter===document.documentElement||elementAtCenter===document.body){return;}
const isTargetOrDescendant=targetElement===elementAtCenter||targetElement.contains(elementAtCenter);if(!isTargetOrDescendant){let elementToMove=null;let currentElement=elementAtCenter;while(currentElement&&currentElement.parentElement){if(currentElement.parentElement===document.body){if(isElementSafeToMove(currentElement,targetElement)){elementToMove=currentElement;}
break;}
if(currentElement.parentElement===document.documentElement){break;}
currentElement=currentElement.parentElement;}
if(elementToMove){try{applyTransformSafely(elementToMove,targetElement);console.log(`Moved element with new z-index:`,elementToMove);}
catch(e){console.error('Error moving element:',e);}}}}
function resetObstructionMoves(){const movedElementsList=document.querySelectorAll(`[${MOVED_ATTRIBUTE}]`);movedElementsList.forEach(element=>{const originalTransform=element.getAttribute(ORIGINAL_TRANSFORM_ATTRIBUTE)||'';element.style.transform=originalTransform;element.removeAttribute(MOVED_ATTRIBUTE);element.removeAttribute(ORIGINAL_TRANSFORM_ATTRIBUTE);const originalZIndex=element.getAttribute(ORIGINAL_ZINDEX_ATTRIBUTE)||'';element.style.zIndex=originalZIndex;element.removeAttribute(ORIGINAL_ZINDEX_ATTRIBUTE);if(element.hasAttribute('data-forced-stacking-context')){element.style.position='';element.removeAttribute('data-forced-stacking-context');}});const targetElement=document.querySelector(`.${TARGET_ELEMENT_CLASS}`);if(targetElement&&targetElement.hasAttribute('data-zindex-boosted')){const originalZIndex=targetElement.getAttribute('data-original-target-zindex')||'';targetElement.style.zIndex=originalZIndex;targetElement.removeAttribute('data-zindex-boosted');targetElement.removeAttribute('data-original-target-zindex');if(targetElement.hasAttribute('data-forced-stacking-context')){targetElement.style.position='';targetElement.removeAttribute('data-forced-stacking-context');}}
console.log(`Reset ${movedElementsList.length} moved elements and target z-index`);};function debugObstructionZIndex(){const targetElement=document.querySelector(`.${TARGET_ELEMENT_CLASS}`);if(!targetElement){console.log('Target element not found');return;}
console.log('Target element z-index:',window.getComputedStyle(targetElement).zIndex);const movedElementsList=document.querySelectorAll(`[${MOVED_ATTRIBUTE}]`);movedElementsList.forEach((element,index)=>{console.log(`Moved element ${index}:`,{element:element,zIndex:window.getComputedStyle(element).zIndex,originalZIndex:element.getAttribute(ORIGINAL_ZINDEX_ATTRIBUTE),transform:element.style.transform});});};console.log(`Starting safe obstruction check for .${TARGET_ELEMENT_CLASS} every ${CHECK_INTERVAL_MS}ms.`);const intervalId=setInterval(checkAndMoveObstructingElements,CHECK_INTERVAL_MS);function stopObstructionCheck(){clearInterval(intervalId);console.log("Stopped obstruction check.");};})();}
else{console.log('Skipping footer move logic - Freestar ads not loaded');}
(async function checkCharactersEnabled(){if(userIsLoggedIn()){try{const response=await fetch(app_base_url+'/check_characters_enabled',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json',}});const data=await response.json();if(data.enabled){const link=document.getElementById('characters-link');if(link){link.style.display='';}}}
catch(err){console.error('Error checking characters enabled:',err);}}})();;</script>

        
	</body>
</html>
